{"data":{"site":{"siteMetadata":{"title":"Takumon Blog","author":"Takuto Inoue"}},"markdownRemark":{"html":"<h2 id=\"なにこれ\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p><a href=\"https://www.gatsbyjs.org/\">Gatsby</a>でブログを作っていて、機能拡張とともにテンプレートが肥大化してきたので、下記図の青枠単位でコンポーネント分割しました。\nあわせてCSS Moduleも採用しました。そのときのメモです。</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e268a820b4389e53b5daaae36cbe0f2e/f9cd1/page.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 94.99036608863199%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAAELklEQVQ4y22U/VMbRRzG86/5k2IdrANltE6ronWkLeVFnXGY1ulICx2loUAJTilkCARoSdr6wpuA8lKIvJSSlPBuiwcU4fJ+uUvubncfv7kE6nTMzCeb3dt98nxf9myuvA7/aH5zdOi9lsOxwibZe+oH2fP+DXnk7E15sLhe9hQ3yoPnm+WRMof825cOeeQb4opDHv3OIY/VEnUO+fdGx8EfLQ6ls849bRt6o34PJ0thvluKjfyruPf2dXScuIau/OvoL7qMzXMfw6i8CFSVAVcvAbWEnbhNtBIuorcUGK7AdFP9mm34zrr01LmMoHuJN1/bFuUlu+JiqSzOX9gXlysl0VcbEO5av3DfIL73i+46v+i5RTQERHcjjc1Ei5952tfwY/PGsk0A0m4SGF8BfzAFbO6p2AvriKUBWQV2FeBlhgSwT+N2hMw9BNZf0loc2IkSEbBQCuj3IWgDDGlzG1h6FuY9/QYUVYUSj1iYugqmJ5HSFCSTCRg0T9Hz3gGdntM/cA2ASTBGX/AtsYygKW3tAGt/xfj9YQZNSyFOmxMJBaqqQVGSUFImEikGVWdIJHW4+xmiMQ2maRIMnAtLcGqRZwU3JWDrb433Dho4OPgHOzs72N3do40cr3/ovCUYiVE+wDNiECIr+PhYkByubMb5vSGTXKlEEklFsUZN02AYRg4dSZUc/moiElWRTqcsl0cOc4JM2iCHz6WEFXIiEadDGrS0ATWVhkEHyAGROSKgG0D3QCZkyi8z/s8hs3I4vcR53wisvB3G01B0gFIGLiydnCCOBSNRDbqeJoeZsPEqh5wxKbM3FAOfDwqkUwo0XQHj1AcwcphWvkgOnOnoHbJc/SezWYczSyRIVZJyi3x+WWD6KcfiCsfcMxNzywzzxEyAYTrAMUtrPr8J1y/A8hZ1xguB1ecW7MU+MPiYBBl7JTjjpxs0DUw+ASYWqNnnBUHzhSxTtD7qy4QmEE0IikogHAMhGNWKWspyaB4LBtYFDKqsqYWt8LJhGkgnQjBTMWtN6BqC6+ZRqEew7NwqCs8Jgi+tZ4rCwKiyjJKdyTZMEqRboqt074QJnZo8sCZeb8+cIF290GFKCoeAaFjnU7MGRiYNTPgMjM/oGJwSeDAB/DQJPKLRS/w8Th2xoCMcMSCHcoR1lqQ+D0f0oO3+Kbc0V9CAP4vsfO5DO3zEzEd2zH5qR/1pD26ecaDhXCfufuGEs8SF5gsezNfUY7HuJp7csmPRQbTa2WpPI/qauoO2sXcaJRRWwCgq5/oH5TDPEJ+UQ3x+CYHiGviKv4WvtBqrldVY+aoGK1U14HX0bmwi7hAdRE8Zw0AlJm83BW3deS7J+6YL3rfauDevDZ4TRH47vCdpLLiL9oJ2OAtb0XPaia6zTng/a8OjkjY8LCUq6PfXRFUbG6zuRNcVd/BfVZUjbmu0ymkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"分割した結果\"\n        title=\"\"\n        src=\"/static/e268a820b4389e53b5daaae36cbe0f2e/42603/page.png\"\n        srcset=\"/static/e268a820b4389e53b5daaae36cbe0f2e/f931c/page.png 200w,\n/static/e268a820b4389e53b5daaae36cbe0f2e/e8031/page.png 400w,\n/static/e268a820b4389e53b5daaae36cbe0f2e/42603/page.png 800w,\n/static/e268a820b4389e53b5daaae36cbe0f2e/f9cd1/page.png 1038w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2 id=\"cssをコンポーネントスコープにする方法\"><a href=\"#css%E3%82%92%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%97%E3%81%AB%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CSSをコンポーネントスコープにする方法</h2>\n<p>コンポーネントを分割する際、CSSもあわせて分割が必要です。その場合、グローバルスコープだとスタイルがコンポーネントに限定されなくなってしまうので、コンポーネントスコープにする必要があります。Gatsbyはコンポーネントスコープの実現方法が3つ用意されています。</p>\n<ul>\n<li><a href=\"https://www.gatsbyjs.org/docs/css-modules/\">CSS Modules</a></li>\n<li><a href=\"https://www.gatsbyjs.org/docs/glamor/\">Using CSS-in-JS library Glamor</a></li>\n<li><a href=\"https://www.gatsbyjs.org/docs/styled-components/\">Using CSS-in-JS library styled components</a></li>\n</ul>\n<p>僕はスタイルをHTMLやJSの中に書くのを躊躇してしまう人（古い時代の人）なので、スタイルをCSSファイルに書けるCSS Moduleを採用しました。\n流行はStyled Componentsなんでしょうか?</p>\n<h3 id=\"css-module\"><a href=\"#css-module\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CSS Module</h3>\n<p>CSSファイルのクラス名、アニメーション名をローカルスコープで使えるようにする仕組みです。\nCSSファイルは通常のCSSと同じ文法で書くことができて、ICSSまたはInteroperable CSSと呼ばれる形式にコンパイルすることでローカルスコープを実現します。\nJavaScriptファイルでCSS Moduleを使う場合、ローカル変数名をつけてインポートし、DOMのクラス名には<code class=\"language-text\">変数名.クラス名</code>のように指定します。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> styles <span class=\"token keyword\">from</span> <span class=\"token string\">\"./style.css\"</span><span class=\"token punctuation\">;</span>\n\nelement<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token string\">'&lt;div class=\"'</span> <span class=\"token operator\">+</span> styles<span class=\"token punctuation\">.</span>className <span class=\"token operator\">+</span> <span class=\"token string\">'\">'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>参考：<a href=\"https://github.com/css-modules/css-modules\">公式ページ</a></p>\n<h3 id=\"gatsbyでcss-module\"><a href=\"#gatsby%E3%81%A7css-module\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>GatsbyでCSS Module</h3>\n<p>CSSファイル名を<code class=\"language-text\">XXX.module.css</code>のようにしてコンポーネントでインポートするだけでCSS Moduleが使えます。<br />\n<br /></p>\n<p>例えば下記のようなCSSがあるとしたら</p>\n<div class=\"gatsby-code-title\">src/components/container.module.css</div>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.container</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> 3rem auto<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">max-width</span><span class=\"token punctuation\">:</span> 600px<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>JavaScriptでこのように読み込みます。</p>\n<div class=\"gatsby-code-title\">src/components/container.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">import</span> styles <span class=\"token keyword\">from</span> <span class=\"token string\">\"./container.module.css\"</span>\n</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> children <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span>container<span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"コンポーネント分割\"><a href=\"#%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E5%88%86%E5%89%B2\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>コンポーネント分割</h2>\n<p>CSSがコンポーネントスコープにできたところで、ようやくコンポーネントを分割できるようになります。\n純粋にReactの作法に従って分割します(Gatsbyは特に関係ありません)。<br>\nここでは、テンプレートから記事部分を分割するケースについて説明しましょう。<br></p>\n<p><strong>テンプレート(分割前)</strong></p>\n<div class=\"gatsby-code-title\">src/templates/blog-post.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> styles <span class=\"token keyword\">from</span> <span class=\"token string\">'blog-post.module.css'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">BlogPostTemplate</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> post <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>markdownRemark\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">&lt;</span>Layout<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>h1 className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span>blogTitle<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>Takumon Blog<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token operator\">&lt;</span>article<span class=\"token operator\">></span>\n</span><span class=\"gatsby-highlight-code-line\">          <span class=\"token operator\">&lt;</span>h1 className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span>postTitle<span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n</span><span class=\"gatsby-highlight-code-line\">          <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span>postContent<span class=\"token punctuation\">}</span> dangerouslySetInnerHTML<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> __html<span class=\"token punctuation\">:</span> post<span class=\"token punctuation\">.</span>html <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n</span><span class=\"gatsby-highlight-code-line\">        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>article<span class=\"token operator\">></span>\n</span>      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Layout<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> BlogPostTemplate\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> pageQuery <span class=\"token operator\">=</span> graphql<span class=\"token template-string\"><span class=\"token string\">`\n  query($slug: String!) {\n    markdownRemark(fields: { slug: { eq: $slug } }) {\n      html\n      frontmatter {\n        title\n      }\n    }\n  }\n`</span></span></code></pre></div>\n<div class=\"gatsby-code-title\">src/templates/blog-post.module.css</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">.</span>blogTitle <span class=\"token punctuation\">{</span>\n  color<span class=\"token punctuation\">:</span> red\n<span class=\"token punctuation\">}</span>\n\n<span class=\"gatsby-highlight-code-line\"><span class=\"token punctuation\">.</span>postTitle <span class=\"token punctuation\">{</span>\n</span><span class=\"gatsby-highlight-code-line\">  color<span class=\"token punctuation\">:</span> blue<span class=\"token punctuation\">;</span>\n</span><span class=\"gatsby-highlight-code-line\"><span class=\"token punctuation\">}</span>\n</span><span class=\"gatsby-highlight-code-line\">\n</span><span class=\"gatsby-highlight-code-line\"><span class=\"token punctuation\">.</span>postContent <span class=\"token punctuation\">{</span>\n</span><span class=\"gatsby-highlight-code-line\">  color<span class=\"token punctuation\">:</span> green<span class=\"token punctuation\">;</span>\n</span><span class=\"gatsby-highlight-code-line\"><span class=\"token punctuation\">}</span>\n</span></code></pre></div>\n<hr>\n<p>分割後は下記のようになります。\nなお分割したコンポーネントに記事情報を渡すための属性を定義します。ここではpostという属性名にしています。<br>\nテンプレートにて記事コンポーネントのpost属性に記事情報を指定すると、\n記事コンポーネントでは<code class=\"language-text\">this.props.post</code>で受け取れるようになります。</p>\n<p><strong>テンプレート(分割後)</strong></p>\n<div class=\"gatsby-code-title\">src/templates/blog-post.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> styles <span class=\"token keyword\">from</span> <span class=\"token string\">'blog-post.module.css'</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">import</span> Post <span class=\"token keyword\">from</span> <span class=\"token string\">'../components/post'</span><span class=\"token punctuation\">;</span>\n</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">BlogPostTemplate</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> post <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>markdownRemark\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">&lt;</span>Layout<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>h1 className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span>blogTitle<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>Takumon Blog<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token operator\">&lt;</span>Post post<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n</span>      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Layout<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> BlogPostTemplate\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> pageQuery <span class=\"token operator\">=</span> graphql<span class=\"token template-string\"><span class=\"token string\">`\n  query($slug: String!) {\n    markdownRemark(fields: { slug: { eq: $slug } }) {\n      html\n      frontmatter {\n        title\n      }\n    }\n  }\n`</span></span></code></pre></div>\n<div class=\"gatsby-code-title\">src/templates/blog-post.module.css</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">.</span>blogTitle <span class=\"token punctuation\">{</span>\n  color<span class=\"token punctuation\">:</span> red\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p><strong>記事コンポーネント</strong></p>\n<div class=\"gatsby-code-title\">src/components/post.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">import</span> styles <span class=\"token keyword\">from</span> <span class=\"token string\">'post.module.css'</span><span class=\"token punctuation\">;</span>\n</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Post</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">const</span> post <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">;</span>\n</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">&lt;</span>article<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>h1 className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span>postTitle<span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span>postContent<span class=\"token punctuation\">}</span> dangerouslySetInnerHTML<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> __html<span class=\"token punctuation\">:</span> post<span class=\"token punctuation\">.</span>html <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>article<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Post</code></pre></div>\n<div class=\"gatsby-code-title\">src/components/post.module.css</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">.</span>postTitle <span class=\"token punctuation\">{</span>\n  color<span class=\"token punctuation\">:</span> blue<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">.</span>postContent <span class=\"token punctuation\">{</span>\n  color<span class=\"token punctuation\">:</span> green<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<hr>\n<p>なお分割したことにより<code class=\"language-text\">src/components/post.module.css</code>が「記事に対するスタイル」ということは自明になるので、クラス名をより簡潔にできます。</p>\n<p><strong>記事コンポーネント(CSSリファクタリング後)</strong></p>\n<div class=\"gatsby-code-title\">src/components/post.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> styles <span class=\"token keyword\">from</span> <span class=\"token string\">'post.module.css'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Post</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> post <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">&lt;</span>article<span class=\"token operator\">></span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token operator\">&lt;</span>h1 className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n</span><span class=\"gatsby-highlight-code-line\">        <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">}</span> dangerouslySetInnerHTML<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> __html<span class=\"token punctuation\">:</span> post<span class=\"token punctuation\">.</span>html <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n</span>      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>article<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Post</code></pre></div>\n<div class=\"gatsby-code-title\">src/components/post.module.css</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"gatsby-highlight-code-line\"><span class=\"token punctuation\">.</span>title <span class=\"token punctuation\">{</span>\n</span>  color<span class=\"token punctuation\">:</span> blue<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"gatsby-highlight-code-line\"><span class=\"token punctuation\">.</span>content <span class=\"token punctuation\">{</span>\n</span>  color<span class=\"token punctuation\">:</span> green<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>以上の手順を繰り返すことで、コンポーネントを細かく分割できます。</p>\n<h2 id=\"まとめ\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>コンポーネントを細かく分割することで、再利用性が向上し、画面レイアウトを組みやすくなりました。\nReactのWebアプリケーションの場合は、Reduxのステート用コールバック関数の受け渡しなどで複雑になりますが、\nGatsbyのような静的Webサイトの場合、単純な分割だけで事足りるかなーと。\n分割設計については<a href=\"https://www.amazon.co.jp/Atomic-Design-%E5%A0%85%E7%89%A2%E3%81%A7%E4%BD%BF%E3%81%84%E3%82%84%E3%81%99%E3%81%84UI%E3%82%92%E5%8A%B9%E7%8E%87%E8%89%AF%E3%81%8F%E8%A8%AD%E8%A8%88%E3%81%99%E3%82%8B-%E4%BA%94%E8%97%A4-%E4%BD%91%E5%85%B8/dp/477419705X\">Atomic Design ~堅牢で使いやすいUIを効率良く設計する</a>を参考にしたいところです。まだ読んでない...🍅</p>","headingsDetail":[{"id":"なにこれ","value":"なにこれ","depth":2,"parents":[]},{"id":"cssをコンポーネントスコープにする方法","value":"CSSをコンポーネントスコープにする方法","depth":2,"parents":[]},{"id":"css-module","value":"CSS Module","depth":3,"parents":[{"id":"cssをコンポーネントスコープにする方法","value":"CSSをコンポーネントスコープにする方法","depth":2}]},{"id":"gatsbyでcss-module","value":"GatsbyでCSS Module","depth":3,"parents":[{"id":"cssをコンポーネントスコープにする方法","value":"CSSをコンポーネントスコープにする方法","depth":2}]},{"id":"コンポーネント分割","value":"コンポーネント分割","depth":2,"parents":[]},{"id":"まとめ","value":"まとめ","depth":2,"parents":[]}],"fields":{"title":"Gatsbyにおけるコンポーネント分割とCSS Module","excerpt":"なにこれGatsbyでブログを作っていて、機能拡張とともにテンプレートが肥大化してきたので、下記図の青枠単位でコンポーネント分割しました。あわせてCSS Moduleも採用しました。そのときのメモです。CSSをコンポーネントスコープにする方...","date":"2018-10-14T07:00:00.000Z","tags":["Gatsby","React","CSSModules"],"thumbnail":"thumbnail/2018/gatsby-css-modules.png"}}},"pageContext":{"slug":"/2018/10/14/","relatedPosts":[{"html":"<h2 id=\"なにこれ\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p>下記の<a href=\"https://www.gatsbyjs.org/blog/2018-11-11-introducing-gatsby-themes/\">記事</a>を読んで、\n実験的に追加されたGatsby themeで何ができるのか<a href=\"chrome://flags/#enable-ephemeral-flash-permission\">サンプル</a>作って試してみました。そのときのメモです。</p>\n<blockquote class=\"twitter-tweet\" data-lang=\"ja\"><p lang=\"en\" dir=\"ltr\">Excited to talk a bit about something I&#39;ve been working on a lot lately<br><br>Introducing <a href=\"https://twitter.com/gatsbyjs?ref_src=twsrc%5Etfw\">@gatsbyjs</a> Themes <a href=\"https://t.co/ysDITHlbsV\">https://t.co/ysDITHlbsV</a></p>&mdash; :party-corgi: (@chrisbiscardi) <a href=\"https://twitter.com/chrisbiscardi/status/1062426813840814080?ref_src=twsrc%5Etfw\">2018年11月13日</a></blockquote>\n<h2 id=\"gatsby-themeはどんな問題を解決してくれるか\"><a href=\"#gatsby-theme%E3%81%AF%E3%81%A9%E3%82%93%E3%81%AA%E5%95%8F%E9%A1%8C%E3%82%92%E8%A7%A3%E6%B1%BA%E3%81%97%E3%81%A6%E3%81%8F%E3%82%8C%E3%82%8B%E3%81%8B\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gatsby themeはどんな問題を解決してくれるか</h2>\n<p>Gatsbyはスキャフォールド機能があって初期導入が非常に簡単です。最小構成のものから、かなりデザインが作り込まれたものまで65個(2018/11/24現在)のスキャフォールドが存在し、<a href=\"https://www.gatsbyjs.org/starters/?v=2\">Gatsby Starter</a>から好きなものを選べます。<br>\nただし初期導入後はスキャフォールドのアップデートに追従できませんし、途中で別のものに変更することも容易ではありません。変更できたとしても実質作り直しと同じくらい改修が必要でしょう。（スキャフォールドなんであたりまえですが...）\nテーマを容易に変更できるようなWordPressなどに比べると拡張性の面で劣っています。<br>\nGatsby themeはこれらの問題を解決するための機能です。</p>\n<h2 id=\"gatsby-themeの概要\"><a href=\"#gatsby-theme%E3%81%AE%E6%A6%82%E8%A6%81\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gatsby themeの概要</h2>\n<ul>\n<li>\n<p>テーマでは下記を定義でき、Gatsbyの資産の大部分をコンテンツから切り離してnpmパッケージとして管理できます。</p>\n<ul>\n<li>依存関係（package.json）</li>\n<li>設定ファイル（gatsby-config.js）</li>\n<li>ページ（blog-post.jsやindex.jsなど）</li>\n<li>コンポーネント（Bio.jsやLayout.jsなど）</li>\n</ul>\n</li>\n<li>コンテンツ側は、今までのように<code class=\"language-text\">package.json</code>で大量のGatsbyプラグインの依存関係を定義したり、<code class=\"language-text\">gatsby-config.js</code>で大量のプラグイン設定を定義する必要がなくなります、使用テーマの宣言とコンテンツの定義だけで、Webサイトを構築できます。</li>\n<li>テーマの設定は引数を許容するので、コンテンツ側から指定した値を設定値に反映できます。</li>\n<li>テーマで用意しているページやコンポーネントは、コンテンツ側で上書きでき、別途追加作成も可能です。　※現時点では若干自力実装が必要ですが...</li>\n</ul>\n<h2 id=\"gatsby-themeの作り方\"><a href=\"#gatsby-theme%E3%81%AE%E4%BD%9C%E3%82%8A%E6%96%B9\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gatsby themeの作り方</h2>\n<p>ここでは2種類のテーマと3種類のブログを作ります。<br>\n<small>※ソースは<a href=\"https://github.com/Takumon/my-gatsby-theme-sample\">GitHub</a>参照</small></p>\n<h3 id=\"1-とりあえずテーマを作る\"><a href=\"#1-%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E3%83%86%E3%83%BC%E3%83%9E%E3%82%92%E4%BD%9C%E3%82%8B\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. とりあえずテーマを作る</h3>\n<p><a href=\"https://github.com/gatsbyjs/gatsby-starter-blog\">gatsby-starter-blog</a>を最小限の修正でテーマ化します。<br>\n<small>※<a href=\"https://github.com/Takumon/my-gatsby-theme-sample/tree/master/themes/gatsby-blog-theme\">ソース</a>、<a href=\"https://github.com/Takumon/my-gatsby-theme-sample/commit/10b68c4f3ad5158973952432da2b4d518570f53d\">参考コミット</a></small></p>\n<h4 id=\"1-1-設定ファイルgatsby-configjs修正\"><a href=\"#1-1-%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%ABgatsby-configjs%E4%BF%AE%E6%AD%A3\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-1. 設定ファイル(gatsby-config.js)修正</h4>\n<p>コンテンツ側のルートパスを受け取り、それを元にファイルパスを組み立てるようにします。</p>\n<div class=\"gatsby-code-title\">gatsby-config.jsの一部</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">// ユーザ側からルートディレクトリを指定して、それをもとに設定の中でパスを組み立てる</span>\n</span><span class=\"gatsby-highlight-code-line\">module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> root <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n</span>  <span class=\"token comment\">// ･･･</span>\n  plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      resolve<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`gatsby-source-filesystem`</span></span><span class=\"token punctuation\">,</span>\n      options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token comment\">// ページはコンテンツ側の資産を読み込む</span>\n</span><span class=\"gatsby-highlight-code-line\">        path<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`src/pages`</span></span><span class=\"token punctuation\">,</span>\n</span>        name<span class=\"token punctuation\">:</span> <span class=\"token string\">'pages'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      resolve<span class=\"token punctuation\">:</span> <span class=\"token string\">'gatsby-plugin-typography'</span><span class=\"token punctuation\">,</span>\n      options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token comment\">// typographyはテーマで用意した資産を使うのでrootからの相対パスを指定する</span>\n</span><span class=\"gatsby-highlight-code-line\">        pathToConfigModule<span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">relative</span><span class=\"token punctuation\">(</span>\n</span><span class=\"gatsby-highlight-code-line\">          root<span class=\"token punctuation\">,</span>\n</span><span class=\"gatsby-highlight-code-line\">          require<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./src/utils/typography'</span><span class=\"token punctuation\">)</span>\n</span><span class=\"gatsby-highlight-code-line\">        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n</span>      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">// ページとして、テーマで用意した資産を読み込む</span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">{</span>\n</span><span class=\"gatsby-highlight-code-line\">      resolve<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`gatsby-plugin-page-creator`</span></span><span class=\"token punctuation\">,</span>\n</span><span class=\"gatsby-highlight-code-line\">      options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n</span><span class=\"gatsby-highlight-code-line\">        path<span class=\"token punctuation\">:</span> require<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`./src/pages`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n</span><span class=\"gatsby-highlight-code-line\">      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n</span>  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h4 id=\"1-2-ファイルパス設定ユーティリティwith-theme-pathjs作成\"><a href=\"#1-2-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%83%91%E3%82%B9%E8%A8%AD%E5%AE%9A%E3%83%A6%E3%83%BC%E3%83%86%E3%82%A3%E3%83%AA%E3%83%86%E3%82%A3with-theme-pathjs%E4%BD%9C%E6%88%90\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-2. ファイルパス設定ユーティリティ(with-theme-path.js)作成</h4>\n<p>パス指定時に、コンテンツ側資産を優先的に使い、無ければテーマ側資産を使うようするユーティリティを作成します。※自力で実装します。</p>\n<div class=\"gatsby-code-title\">with-theme-path.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">/**\n * テーマで用意したページをユーザが上書き可能にするためのファイルパス解決ユーティリティ\n *\n * 指定した相対パスから\n * 1. ユーザが作成したファイルのパスを返却する\n * 2. ユーザが作成したファイルがなければテーマで用意しているパスを返却する\n * 3. テーマでもファイルを用意していない場合、指定した相対パスをそのまま返却する\n */</span>\nmodule<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> relativePath <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> pathResolvedPath <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>relativePath<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">let</span> finalPath <span class=\"token operator\">=</span> pathResolvedPath\n\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ファイル読み込み時にユーザが作成したファイルがあるかチェック</span>\n    require<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>pathResolvedPath<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// 1. ユーザが作成したファイルのパスを返却する</span>\n    finalPath <span class=\"token operator\">=</span> pathResolvedPath\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 2. ユーザが作成したファイルがなければテーマで用意しているパスを返却する</span>\n      finalPath <span class=\"token operator\">=</span> require<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>relativePath<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 3. テーマでもファイルを用意していない場合、指定した相対パスをそのまま返却する</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">return</span> relativePath\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> finalPath\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4 id=\"1-3-gatsby-nodejs修正\"><a href=\"#1-3-gatsby-nodejs%E4%BF%AE%E6%AD%A3\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-3. gatsby-node.js修正</h4>\n<p>先ほど作ったwith-theme-pash.jsを使ってページを読み込むようにします。\nまたnpmパッケージ公開用のビルド設定を追加します。\n※ここらへんも自力実装です。</p>\n<div class=\"gatsby-code-title\">gatsby-node.jsの一部</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">const</span> withThemePath <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./with-theme-path'</span><span class=\"token punctuation\">)</span>\n</span>\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">createPages</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> graphql<span class=\"token punctuation\">,</span> actions <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createPage <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> actions\n\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">// withThemePathを使って、ユーザが作成したページまたはテーマで用意しているページを読み込む</span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">const</span> blogPost <span class=\"token operator\">=</span> <span class=\"token function\">withThemePath</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./src/templates/blog-post.js'</span><span class=\"token punctuation\">)</span>\n</span>    <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>\n        <span class=\"token comment\">// ･･･</span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ･･･</span>\n\n<span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">/*\n</span><span class=\"gatsby-highlight-code-line\"> * Gatsbyテーマのビルド方法をwebpackに設定しています。\n</span><span class=\"gatsby-highlight-code-line\"> * NPMモジュールの公開時は、(1)事前コンパイルするか、(2)コンパイル方法の設定追加 どちらかが必要です。\n</span><span class=\"gatsby-highlight-code-line\"> * Gatsbyテーマの場合(2)が可能なので、ここで設定しています。\n</span><span class=\"gatsby-highlight-code-line\"> */</span>\n</span><span class=\"gatsby-highlight-code-line\">exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onCreateWebpackConfig</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> stage<span class=\"token punctuation\">,</span> loaders<span class=\"token punctuation\">,</span> actions <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n</span><span class=\"gatsby-highlight-code-line\">  actions<span class=\"token punctuation\">.</span><span class=\"token function\">setWebpackConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n</span><span class=\"gatsby-highlight-code-line\">    module<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n</span><span class=\"gatsby-highlight-code-line\">      rules<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n</span><span class=\"gatsby-highlight-code-line\">        <span class=\"token punctuation\">{</span>\n</span><span class=\"gatsby-highlight-code-line\">          test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.js$/</span><span class=\"token punctuation\">,</span>\n</span><span class=\"gatsby-highlight-code-line\">          include<span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">dirname</span><span class=\"token punctuation\">(</span>require<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'gatsby-blog-theme'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n</span><span class=\"gatsby-highlight-code-line\">          use<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>loaders<span class=\"token punctuation\">.</span><span class=\"token function\">js</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n</span><span class=\"gatsby-highlight-code-line\">        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n</span><span class=\"gatsby-highlight-code-line\">      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</span><span class=\"gatsby-highlight-code-line\"><span class=\"token punctuation\">}</span>\n</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">// ユーザがsrc/pages未作成の場合にエラーになるのを防ぐため、無ければ作成する</span>\n</span><span class=\"gatsby-highlight-code-line\">exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onPreBootstrap</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> store <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> program <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> store<span class=\"token punctuation\">.</span><span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> dir <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>program<span class=\"token punctuation\">.</span>directory<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/src/pages`</span></span>\n</span><span class=\"gatsby-highlight-code-line\">\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>fs<span class=\"token punctuation\">.</span><span class=\"token function\">existsSync</span><span class=\"token punctuation\">(</span>dir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n</span><span class=\"gatsby-highlight-code-line\">    fs<span class=\"token punctuation\">.</span><span class=\"token function\">mkdirSync</span><span class=\"token punctuation\">(</span>dir<span class=\"token punctuation\">)</span>\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span>\n</span><span class=\"gatsby-highlight-code-line\"><span class=\"token punctuation\">}</span>\n</span></code></pre></div>\n<h4 id=\"1-4-indexjs作成\"><a href=\"#1-4-indexjs%E4%BD%9C%E6%88%90\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-4. index.js作成</h4>\n<p>npmパッケージ公開用に空のindex.jsを作成します。</p>\n<h4 id=\"1-5-srccomponentslayoutjs修正\"><a href=\"#1-5-srccomponentslayoutjs%E4%BF%AE%E6%AD%A3\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1-5. src/components/Layout.js修正</h4>\n<p>ESLintエラーを解消すための設定を追加します。</p>\n<div class=\"gatsby-code-title\">src/components/Layout.jsの一部</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">/* eslint-disable */</span>\n</span><span class=\"token comment\">// 冒頭に上記コメントを追加</span></code></pre></div>\n<br>\n<p>これでテーマ化完了です。</p>\n<h3 id=\"2-とりあえずテーマを使ってみる\"><a href=\"#2-%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E3%83%86%E3%83%BC%E3%83%9E%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. とりあえずテーマを使ってみる</h3>\n<p>前手順で作ったテーマを使って最小構成でブログを作ります。<br>\n<small><a href=\"https://github.com/Takumon/my-gatsby-theme-sample/tree/master/ui-surfaces/blog-minimal\">ソース</a>、<a href=\"https://github.com/Takumon/my-gatsby-theme-sample/commit/72b955f8d82dfca2ff009c477e72f53386e4a6a7\">参考コミット</a></small></p>\n<h4 id=\"2-1-設定ファイルgatsby-configjs作成\"><a href=\"#2-1-%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%ABgatsby-configjs%E4%BD%9C%E6%88%90\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-1. 設定ファイル(gatsby-config.js)作成</h4>\n<p>ここがGatsby themeにおいて肝となる機能で、\n<code class=\"language-text\">__experimentalThemes</code>プロパティで使用テーマを指定できます。\nここでは使用テーマに前手順で作った<code class=\"language-text\">gatsby-blog-theme</code>を指定します。\nその際、<code class=\"language-text\">gatsby-blog-theme</code>は設定引数としてルートディレクトリをとるので、それも指定します。※ここはGatsby側でよしなりやってくれます。</p>\n<div class=\"gatsby-code-title\">gatsby-config.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// テーマを指定する</span>\n  __experimentalThemes<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// テーマにgatsby-blog-themeを指定する</span>\n      resolve<span class=\"token punctuation\">:</span> <span class=\"token string\">\"gatsby-blog-theme\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// テーマgatsby-blog-themeではrootをオプションで受け取る想定なので本ブログのルートフォルダを指定する</span>\n      options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> root<span class=\"token punctuation\">:</span> __dirname <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h4 id=\"2-2-packagejson作成\"><a href=\"#2-2-packagejson%E4%BD%9C%E6%88%90\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-2. package.json作成</h4>\n<p><code class=\"language-text\">gatsby</code>と<code class=\"language-text\">gatsby-blog-theme</code>を依存関係に指定するだけの簡単なpackage.jsonを作成します。</p>\n<div class=\"gatsby-code-title\">package.json</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"blog-minimal\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"scripts\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"develop\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"gatsby develop\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"build\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"gatsby build\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token string\">\"dependencies\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token string\">\"gatsby\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"^2.0.19\"</span><span class=\"token punctuation\">,</span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token string\">\"gatsby-blog-theme\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"*\"</span>\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span>\n</span><span class=\"token punctuation\">}</span></code></pre></div>\n<h4 id=\"2-3-srcpages配下に記事作成\"><a href=\"#2-3-srcpages%E9%85%8D%E4%B8%8B%E3%81%AB%E8%A8%98%E4%BA%8B%E4%BD%9C%E6%88%90\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-3. src/pages配下に記事作成</h4>\n<p>文字通り、テキトーにマークダウンファイルの記事を作成します。</p>\n<h4 id=\"2-4-srcassetsgatsby-iconpng配置\"><a href=\"#2-4-srcassetsgatsby-iconpng%E9%85%8D%E7%BD%AE\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-4. src/assets/gatsby-icon.png配置</h4>\n<p>本編とはあまり関係無い修正ですが、テーマからコンテンツ側のアイコン資産読み込みを期待しているので、これがないとエラーで落ちます。　※工夫次第でこれも「なければテーマ側の資産を使う」ようにはできるのでしょうが本記事ではそこまで触れていません。</p>\n<h4 id=\"2-5-動作確認\"><a href=\"#2-5-%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2-5. 動作確認</h4>\n<p>この状態でブログを起動すると、下記のような画面が表示できます。</p>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 92.2029702970297%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsSAAALEgHS3X78AAACDElEQVQ4y6WUS2/aQBSFWUI3XXXZVbvnT6ZLhMQSSiVEhRACCWF3BaIiiEaAG6ou0kVxTAikBgZqGydgYHw6M8GEFOgjXOlonvp0z9xr+14+f/b19asX5ru370eyJJN8Pk8kSSKVSoVks1kSDAZJIBAgfr9/PTIF1vLm7MyTr/Kx3FeUBrTLDrrda6iXGnr9G/w0DJDxBBcX36Aon9FUFDF6Oj9vCbVaX1D91MDpaRW1Wg0+6rpXuA/K5B4r32Kx6HKaJMk0k8kgHo8jlUohHA6jXq8jnU4jFAqBn3ElEgkUCgXYtn2fBaVwXXejDbBcLlN+mb0fSqUSYrEY2Bui0WgIaDKZFJZyuRyKxaIA8diGCeByuRTASCRCT07eIBqNCti/hAfZnm+AWueKttttNJtNyLL8kMHalmeNbkG2wV5sLPc0lfb1oUDwC4QQjEYjTCZjTC1TyLansEwD9tQSa4N1wnzuPM7QceYCeFb8QJtnVdEyqqpC0zSoLGOtN4Cqm/h+Y6D9w4DK1BmYYjSsKZjD/ZZd3jZsY7VaYeXZ41bZweqA9lr2gGybPnoX/L7a1R+LYs4pZYI2dqBbi51KHtLBDEdkTPXBEPqQYGrfsseegxVspz3+FhvgbDajvIp3d7dwHAeWZfG9pwPX3/Le5v2feKiy67KePT448HpvYZ8YrLEdbf3XWDAtj9UvlSU0bJbmFAoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"blog-mininal\"\n        title=\"\"\n        src=\"/static/22a88b15fab002ed304462e5cacf619a/42603/blog-minimal.png\"\n        srcset=\"/static/22a88b15fab002ed304462e5cacf619a/f931c/blog-minimal.png 200w,\n/static/22a88b15fab002ed304462e5cacf619a/e8031/blog-minimal.png 400w,\n/static/22a88b15fab002ed304462e5cacf619a/42603/blog-minimal.png 800w,\n/static/22a88b15fab002ed304462e5cacf619a/a35e6/blog-minimal.png 808w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  </p>\n<p>従来のGatsbyであれば、一覧用ページ、記事詳細ページ、その他コンポーネントなどなど非常に多くの資産を必要としますが、\nテーマを使えば、ほぼgatsby-node.jsとpackage.jsonだけでブログが完成します。<br>\nまたテーマ側がアップデートした場合も依存パッケージのバージョンを上げればいいだけなので常に最新のテーマを適用できます。</p>\n<h3 id=\"3-テーマのページを上書きしてみる\"><a href=\"#3-%E3%83%86%E3%83%BC%E3%83%9E%E3%81%AE%E3%83%9A%E3%83%BC%E3%82%B8%E3%82%92%E4%B8%8A%E6%9B%B8%E3%81%8D%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. テーマのページを上書きしてみる</h3>\n<p>最小構成のブログにページを追加してテーマで用意しているページを上書きします。<br>\n<small><a href=\"https://github.com/Takumon/my-gatsby-theme-sample/tree/master/ui-surfaces/blog-override-page\">ソース</a>、<a href=\"https://github.com/Takumon/my-gatsby-theme-sample/commit/7a09088d774035f3cbf370730e7af9ac6869849b\">参考コミット</a></small></p>\n<h4 id=\"3-1-記事詳細ページ作成\"><a href=\"#3-1-%E8%A8%98%E4%BA%8B%E8%A9%B3%E7%B4%B0%E3%83%9A%E3%83%BC%E3%82%B8%E4%BD%9C%E6%88%90\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3-1. 記事詳細ページ作成</h4>\n<p>ページはテーマと同じ相対パスに配置します。with-theme-pathによりコンテンツ側のページが優先的に読み込まれます。</p>\n<div class=\"gatsby-code-title\">src/templates/blog-post.jsの一部</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">// 上書きページではテーマで用意しているコンポーネントを使用できる</span>\n</span><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">import</span> Bio <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby-blog-theme/src/components/Bio'</span>\n</span><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">import</span> Layout <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby-blog-theme/src/components/Layout'</span>\n</span><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> rhythm<span class=\"token punctuation\">,</span> scale <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby-blog-theme/src/utils/typography'</span>\n</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">BlogPostTemplate</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// テーマのblog-post.jsと同じ実装</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4 id=\"3-2-動作確認\"><a href=\"#3-2-%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3-2. 動作確認</h4>\n<p>これでブログを立ち上げると、記事詳細のページが差し替わっているのが確認できます。</p>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 92.3172242874845%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsSAAALEgHS3X78AAACBklEQVQ4y6VT227aQBD1p/Ylgrymr/xUVSG1IgmkKUEgCi1QcYvBdhAmLvjGHXv3ZNZgy45o67QjHc3sePdo5sxYen/x7sfV1YXz8cPnX6ViaX5zcz0vFArzYrEY+FwuN89ms4TM/DJ7eYqTyGSEP36Tqg/lSbv9Har6hOlUh/ZEXp9h9mxgYZp4lGXU63XcFr/iy0MF5VoDjUYTjfsSmneEZhPVagWV8j3lv0E6eJ4KMsd1mGVZ3DRNblk2XyxMbts2D833GfcZ4yxMMF8kOY4HzsSZTPJ9XxOEo9GItVotdDod9Ho9DAYD9Pt9MMbw2ujd0cfi8Cx5nhcQDodDpus6xuMxut0uarUa8vk8VqtVRJIGEaEsy4xIhQ8qE5UK7bbbbaKqv1lEKITY7/fY7XYgGaILIg7bTkMaEdJDJtqjoYCGA9d1A2w2G9CdfyMUFR4OBwj/+vGbW6YVYaqqYjKZQNO0hHZpEN6NCEk7tlwuBXFCs7eQJSokC1g8z0/dXkgUL0AizY57+LPNZEXDer0OqjQMI4C5WMB1HIKNJQ3JsS3yTgCbYrEV8W4kGkBAWL39xBq1Cv3HOhRFIai0k49QpgZGzy6Gug155mA0s6EYbhA7yzX82AYkNAxbFuUnNBI5fh7nNkAQquFi89PvmQT/Lc5ZvML0k/jTHtJQxqdWPYL/v3gBZgFX0n6srxwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"blog-override-page\"\n        title=\"\"\n        src=\"/static/58fc204037ec56de00a4acbd0d2ef3f5/42603/blog-override-page.png\"\n        srcset=\"/static/58fc204037ec56de00a4acbd0d2ef3f5/f931c/blog-override-page.png 200w,\n/static/58fc204037ec56de00a4acbd0d2ef3f5/e8031/blog-override-page.png 400w,\n/static/58fc204037ec56de00a4acbd0d2ef3f5/42603/blog-override-page.png 800w,\n/static/58fc204037ec56de00a4acbd0d2ef3f5/1fe39/blog-override-page.png 807w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  </p>\n<h3 id=\"4-コンポーネント差し替え可能なテーマを作る\"><a href=\"#4-%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E5%B7%AE%E3%81%97%E6%9B%BF%E3%81%88%E5%8F%AF%E8%83%BD%E3%81%AA%E3%83%86%E3%83%BC%E3%83%9E%E3%82%92%E4%BD%9C%E3%82%8B\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. コンポーネント差し替え可能なテーマを作る</h3>\n<p>今まで作ったテーマでは、ページで使うコンポーネントだけをを差し替えるようなことはできません。\nここではコンポーネントだけを差し替えられるようなテーマを作ります。<br>\n<small><a href=\"https://github.com/Takumon/my-gatsby-theme-sample/tree/master/themes/gatsby-blog-component-replacement-theme\">ソース</a>、<a href=\"https://github.com/Takumon/my-gatsby-theme-sample/commit/c9a14eb985ffcbc7c639ae82512c8a507ad149e1\">参考コミット</a></small></p>\n<h4 id=\"4-1-gatsby-nodejs修正\"><a href=\"#4-1-gatsby-nodejs%E4%BF%AE%E6%AD%A3\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4-1. gatsby-node.js修正</h4>\n<p>gatsby-node.jsでコンポーネントだけ差し替えられるようにします。このときコンテンツ側の差し替え資産配置場所を決めます。\nここでは<code class=\"language-text\">src/components/gatsby-blog-component-replacement-theme--component</code>を指定しています。\nまたエイリアスを設定して<code class=\"language-text\">gatsby-blog-component-replacement-theme--component/コンポーネント名</code>でimportできるようにしています。\n※これも自力実装です。</p>\n<div class=\"gatsby-code-title\">gatsby-node.jsの一部</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">// テーマ差し替え用フォルダを指定して</span>\n</span><span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">// ユーザがフォルダ配下にコンポーネントを配置している場合、テーマで用意したものと差し替えるようにする</span>\n</span><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">const</span> <span class=\"token constant\">THEME_PREFIX</span> <span class=\"token operator\">=</span> <span class=\"token string\">'gatsby-blog-component-replacement-theme--component'</span>\n</span><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">const</span> <span class=\"token constant\">RELATIVE_DIR_PATH_OF_REPLACEMENT_COMPONETS</span> <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`./src/components/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">THEME_PREFIX</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span>\n</span>\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onCreateWebpackConfig</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> actions<span class=\"token punctuation\">,</span> store <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// ユーザが作成したコンポーネント読み込んで</span>\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// エイリアスを作成する</span>\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> userComponents <span class=\"token operator\">=</span> fs\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">.</span><span class=\"token function\">readdirSync</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token constant\">RELATIVE_DIR_PATH_OF_REPLACEMENT_COMPONETS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span>\n</span><span class=\"gatsby-highlight-code-line\">      <span class=\"token punctuation\">(</span>acc<span class=\"token punctuation\">,</span> componentName<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n</span><span class=\"gatsby-highlight-code-line\">        <span class=\"token operator\">...</span>acc<span class=\"token punctuation\">,</span>\n</span><span class=\"gatsby-highlight-code-line\">        <span class=\"token punctuation\">[</span><span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">THEME_PREFIX</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>componentName<span class=\"token punctuation\">.</span><span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> componentName<span class=\"token punctuation\">.</span><span class=\"token function\">lastIndexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>\n</span><span class=\"gatsby-highlight-code-line\">          <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">RELATIVE_DIR_PATH_OF_REPLACEMENT_COMPONETS</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>componentName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span>\n</span>        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// エイリアス設定でユーザが作成したコンポーネントを先に定義することで</span>\n  <span class=\"token comment\">// ユーザが作成したコンポーネントを優先的に読み込むようにする</span>\n  actions<span class=\"token punctuation\">.</span><span class=\"token function\">setWebpackConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    resolve<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      alias<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>userComponents<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">[</span><span class=\"token constant\">THEME_PREFIX</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'./src/components'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n\n<span class=\"token comment\">// ユーザがsrc/pages未作成の場合にエラーになるのを防ぐため、無ければ作成する</span>\n<span class=\"token comment\">// RELATIVE_DIR_PATH_OF_REPLACEMENT_COMPONETSも同様</span>\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onPreBootstrap</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> store <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> program <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> store<span class=\"token punctuation\">.</span><span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> pageDir <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>program<span class=\"token punctuation\">.</span>directory<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/src/pages/`</span></span>\n  <span class=\"token keyword\">const</span> componentDir <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>program<span class=\"token punctuation\">.</span>directory<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/src/components/`</span></span>\n  <span class=\"token keyword\">const</span> replaceComponentDir <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>componentDir<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">THEME_PREFIX</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/`</span></span>\n\n  <span class=\"token function\">mkdir</span><span class=\"token punctuation\">(</span>pageDir<span class=\"token punctuation\">)</span>\n  <span class=\"token function\">mkdir</span><span class=\"token punctuation\">(</span>componentDir<span class=\"token punctuation\">)</span>\n  <span class=\"token function\">mkdir</span><span class=\"token punctuation\">(</span>replaceComponentDir<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">mkdir</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>fs<span class=\"token punctuation\">.</span><span class=\"token function\">existsSync</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    fs<span class=\"token punctuation\">.</span><span class=\"token function\">mkdirSync</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4 id=\"4-2-ページ修正\"><a href=\"#4-2-%E3%83%9A%E3%83%BC%E3%82%B8%E4%BF%AE%E6%AD%A3\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4-2. ページ修正</h4>\n<p>各ページのimport文を上記で指定したエイリアスに修正します。</p>\n<div class=\"gatsby-code-title\">src/pages/404.jsの一部</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// コンポーネント読み込みはgatsby-node.jsで指定したファイルパスから読み込む</span>\n<span class=\"token keyword\">import</span> Layout <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby-blog-component-replacement-theme--component/Layout'</span></code></pre></div>\n<div class=\"gatsby-code-title\">src/pages/index.jsの一部</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// コンポーネント読み込みはgatsby-node.jsで指定したファイルパスから読み込む</span>\n<span class=\"token keyword\">import</span> Bio <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby-blog-component-replacement-theme--component/Bio'</span>\n<span class=\"token keyword\">import</span> Layout <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby-blog-component-replacement-theme--component/Layout'</span></code></pre></div>\n<div class=\"gatsby-code-title\">src/templates/blog-post.jsの一部</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// コンポーネント読み込みはgatsby-node.jsで指定したファイルパスから読み込む</span>\n<span class=\"token keyword\">import</span> Bio <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby-blog-component-replacement-theme--component/Bio'</span>\n<span class=\"token keyword\">import</span> Layout <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby-blog-component-replacement-theme--component/Layout'</span></code></pre></div>\n<h3 id=\"5-コンポーネントを差し替えてみる\"><a href=\"#5-%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E3%82%92%E5%B7%AE%E3%81%97%E6%9B%BF%E3%81%88%E3%81%A6%E3%81%BF%E3%82%8B\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. コンポーネントを差し替えてみる</h3>\n<p>前手順で作ったテーマを使い、コンポーネントのみを差し替えてみます。<br>\n<small><a href=\"https://github.com/Takumon/my-gatsby-theme-sample/tree/master/ui-surfaces/blog-component-replacement\">ソース</a>、<a href=\"https://github.com/Takumon/my-gatsby-theme-sample/commit/c9a14eb985ffcbc7c639ae82512c8a507ad149e1\">参考コミット</a></small></p>\n<h4 id=\"5-1-コンポーネント作成\"><a href=\"#5-1-%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E4%BD%9C%E6%88%90\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5-1. コンポーネント作成</h4>\n<p>src/components/gatsby-blog-component-replacement-theme--component/Bio.jsを作成します。</p>\n<div class=\"gatsby-code-title\">src/components/gatsby-blog-component-replacement-theme--component/Bio.jsの一部</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 上書きするコンポーネントからもテーマ資産は使える</span>\n<span class=\"token keyword\">import</span> profilePic <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby-blog-component-replacement-theme/src/components/profile-pic.jpg'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> rhythm <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby-blog-component-replacement-theme/src/utils/typography'</span>\n\n<span class=\"token comment\">// テーマ側で指定したフォルダ配下にテーマ資産と同名でコンポーネントを作成して上書きする</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Bio</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// ･･･</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4 id=\"5-2-動作確認\"><a href=\"#5-2-%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5-2. 動作確認</h4>\n<p>これでブログを立ち上げると、記事一覧ページでBioコンポーネントだけ差し替わっていることが確認できます。</p>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 92.3172242874845%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsSAAALEgHS3X78AAACBklEQVQ4y6VT227aQBD1p/Ylgrymr/xUVSG1IgmkKUEgCi1QcYvBdhAmLvjGHXv3ZNZgy45o67QjHc3sePdo5sxYen/x7sfV1YXz8cPnX6ViaX5zcz0vFArzYrEY+FwuN89ms4TM/DJ7eYqTyGSEP36Tqg/lSbv9Har6hOlUh/ZEXp9h9mxgYZp4lGXU63XcFr/iy0MF5VoDjUYTjfsSmneEZhPVagWV8j3lv0E6eJ4KMsd1mGVZ3DRNblk2XyxMbts2D833GfcZ4yxMMF8kOY4HzsSZTPJ9XxOEo9GItVotdDod9Ho9DAYD9Pt9MMbw2ujd0cfi8Cx5nhcQDodDpus6xuMxut0uarUa8vk8VqtVRJIGEaEsy4xIhQ8qE5UK7bbbbaKqv1lEKITY7/fY7XYgGaILIg7bTkMaEdJDJtqjoYCGA9d1A2w2G9CdfyMUFR4OBwj/+vGbW6YVYaqqYjKZQNO0hHZpEN6NCEk7tlwuBXFCs7eQJSokC1g8z0/dXkgUL0AizY57+LPNZEXDer0OqjQMI4C5WMB1HIKNJQ3JsS3yTgCbYrEV8W4kGkBAWL39xBq1Cv3HOhRFIai0k49QpgZGzy6Gug155mA0s6EYbhA7yzX82AYkNAxbFuUnNBI5fh7nNkAQquFi89PvmQT/Lc5ZvML0k/jTHtJQxqdWPYL/v3gBZgFX0n6srxwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"blog-override-page\"\n        title=\"\"\n        src=\"/static/58fc204037ec56de00a4acbd0d2ef3f5/42603/blog-override-page.png\"\n        srcset=\"/static/58fc204037ec56de00a4acbd0d2ef3f5/f931c/blog-override-page.png 200w,\n/static/58fc204037ec56de00a4acbd0d2ef3f5/e8031/blog-override-page.png 400w,\n/static/58fc204037ec56de00a4acbd0d2ef3f5/42603/blog-override-page.png 800w,\n/static/58fc204037ec56de00a4acbd0d2ef3f5/1fe39/blog-override-page.png 807w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  </p>\n<h2 id=\"まとめ\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>Gatsby themeは発展途上の機能なので、パス設定などは自力でやる必要があります。ただこれらについても積極的に開発が行われているようです。\n将来的にはGatsby Starterのように全テーマ一覧が開設されて、すきなテーマを選べる、かつ気軽に変更できる、かつ気軽にコンテンツ側でカスタマイズできるみたいなことを期待しています🍅</p>\n<h2 id=\"参考\"><a href=\"#%E5%8F%82%E8%80%83\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li>\n<p><a href=\"https://www.gatsbyjs.org/blog/2018-11-11-introd%20ucing-gatsby-themes/\">Gatsby theme | Gatsby blog</a></p>\n<ul>\n<li><a href=\"https://github.com/ChristopherBiscardi\">ChristopherBiscardi</a>さんが書いたGastby themeの紹介ブログです。</li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://github.com/ChristopherBiscardi/gatsby-theme-examples\">gatsby-theme-examples | GitHub</a></p>\n<ul>\n<li><a href=\"https://github.com/gatsbyjs/gatsby-starter-blog\">Gatsby-starter-blog</a>をtheme化したサンプルです。</li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://www.npmjs.com/package/gatsby-theme-blog\">gatsby-theme-blog | npm</a></p>\n<ul>\n<li>上記サンプルのthemeがnpmライブラリとして公開されています。</li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://spectrum.chat/gatsby-themes\">gatsby-themes | spectrum</a></p>\n<ul>\n<li>最新情報はspectrumで入手できます。</li>\n</ul>\n</li>\n</ul>","fields":{"slug":"/2018/11/24/","title":"Gatsby themeを使ってみる","date":"2018-11-24T23:40:00.000+09:00","excerpt":"なにこれ下記の記事を読んで、実験的に追加されたGatsby themeで何ができるのかサンプル作って試してみました。そのときのメモです。Gatsby themeはどんな問題を解決してくれるかGatsbyはスキャフォールド機能があって初期導入...","tags":["Gatsby","Gatsby theme"],"keywords":["Gatsby"],"thumbnail":"thumbnail/2018/gatsby-theme.png"}},{"html":"<h2 id=\"なにこれ\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p>GatsbyでWebサイトを作るときに、ブログや職種紹介など2種類以上のマークダウンファイルを管理する場合があると思います。通常だとMarkdownRemarkNodeの<code class=\"language-text\">fileAbsolutePath</code>でしか両者のマークダウンファイルを見分ける術がありませんが、ここではもっとスマートなやり方を紹介します。簡単に言うとFileNodeの<code class=\"language-text\">sourceInstanceName</code>をMarkdownRemarkNodeに引き継ぐことにより、GraphQLのfilterで簡単に区別できるという方法です。</p>\n<h2 id=\"実装方法\"><a href=\"#%E5%AE%9F%E8%A3%85%E6%96%B9%E6%B3%95\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>実装方法</h2>\n<h3 id=\"step1-マークダウンファイルのflenodeでsourceinstancenameを定義\"><a href=\"#step1-%E3%83%9E%E3%83%BC%E3%82%AF%E3%83%80%E3%82%A6%E3%83%B3%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AEflenode%E3%81%A7sourceinstancename%E3%82%92%E5%AE%9A%E7%BE%A9\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step1. マークダウンファイルのFleNodeでsourceInstanceNameを定義</h3>\n<p>マークダウンファイルの読み込み設定はgatsby-config.jsで以下のようにします。\n<code class=\"language-text\">name</code>を付けることでマークダウンファイルのFileNodeにおいて<code class=\"language-text\">sourceInstanceName</code>が設定できます。</p>\n<div class=\"gatsby-code-title\">gatsby-config.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* (中略) */</span>\n\n  plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token comment\">/* (中略) */</span>\n\n    <span class=\"token punctuation\">{</span>\n      resolve<span class=\"token punctuation\">:</span> <span class=\"token string\">'gatsby-source-filesystem'</span><span class=\"token punctuation\">,</span>\n      options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token comment\">// オプションでname(FileNodeにおけるsourceInstanceName)を指定</span>\n</span><span class=\"gatsby-highlight-code-line\">        name<span class=\"token punctuation\">:</span> <span class=\"token string\">'posts'</span><span class=\"token punctuation\">,</span>\n</span>        path<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>__dirname<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/content/posts`</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      resolve<span class=\"token punctuation\">:</span> <span class=\"token string\">'gatsby-source-filesystem'</span><span class=\"token punctuation\">,</span>\n      options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token comment\">// オプションでname(FileNodeにおけるsourceInstanceName)を指定</span>\n</span><span class=\"gatsby-highlight-code-line\">        name<span class=\"token punctuation\">:</span> <span class=\"token string\">'jobs'</span><span class=\"token punctuation\">,</span>\n</span>        path<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>__dirname<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/content/jobs`</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'gatsby-transformer-remark'</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">/* (中略) */</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token comment\">/* (中略) */</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br/>\n<h3 id=\"step2-filenodeのnameをmarkdownfilenodeに引継ぐ\"><a href=\"#step2-filenode%E3%81%AEname%E3%82%92markdownfilenode%E3%81%AB%E5%BC%95%E7%B6%99%E3%81%90\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step2. FileNodeのnameをMarkdownFileNodeに引継ぐ</h3>\n<p>何もしないとFileNodeの<code class=\"language-text\">sourceInstanceName</code>はMarkdownRemarkNodeに引き継がれません。\nそのため<code class=\"language-text\">gatsby-node.js</code>で引継ぎ処理を実装します。</p>\n<div class=\"gatsby-code-title\">gatsby-node.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onCreateNode</span>  <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> node<span class=\"token punctuation\">,</span> boundActionCreators<span class=\"token punctuation\">,</span> getNode <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createNodeField <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> boundActionCreators\n\n  <span class=\"token comment\">// MarkdownRemarkNodeの場合のみ処処</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node <span class=\"token operator\">&amp;&amp;</span> node<span class=\"token punctuation\">.</span>internal <span class=\"token operator\">&amp;&amp;</span> node<span class=\"token punctuation\">.</span>internal<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'MarkdownRemark'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// 親のFileNodeを取得して</span>\n    <span class=\"token keyword\">const</span> parent <span class=\"token operator\">=</span> <span class=\"token function\">getNode</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>parent<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// gatsby-config.jsで設定したFileNodeのsourceInstanceNameを</span>\n    <span class=\"token comment\">// MarkdownRemarkのフィールドに引き継ぐ</span>\n    <span class=\"token comment\">// 名前はMarkdownRemarkの他プロパティとかぶらないようにcollectionとしている</span>\n    <span class=\"token function\">createNodeField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      node<span class=\"token punctuation\">,</span>\n      name<span class=\"token punctuation\">:</span> <span class=\"token string\">'collection'</span><span class=\"token punctuation\">,</span>\n      value<span class=\"token punctuation\">:</span> parent<span class=\"token punctuation\">.</span>sourceInstanceName<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br/>\n<h3 id=\"step3-graphqlでnameをもとにマークダウンを区別\"><a href=\"#step3-graphql%E3%81%A7name%E3%82%92%E3%82%82%E3%81%A8%E3%81%AB%E3%83%9E%E3%83%BC%E3%82%AF%E3%83%80%E3%82%A6%E3%83%B3%E3%82%92%E5%8C%BA%E5%88%A5\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step3. GraphQLでnameをもとにマークダウンを区別</h3>\n<p>GraphQLではcollectionフィールドで、それぞれを区別します。</p>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> <span class=\"token punctuation\">{</span>\n  allMarkdownRemark<span class=\"token punctuation\">(</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\"># collectionにて記事のNodeのみ抽出</span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token attr-name\">filter</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">fields</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">collection</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">eq</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"posts\"</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span>\n</span>  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    edges <span class=\"token punctuation\">{</span>\n      node <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\"># (中略)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<h2 id=\"まとめ\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>簡単ですがGatsbyで良く困る事例の1つを紹介しました。\nGatsbyは多くのフックポイントを設けているので、今回のよう、やろうと思えば結構いろんなことができます🍅</p>\n<h2 id=\"参考\"><a href=\"#%E5%8F%82%E8%80%83\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"https://github.com/gatsbyjs/gatsby/issues/1634\">Question: How do I query based on gatsby-source-filesystem name? · Issue #1634 · gatsbyjs/gatsby</a></li>\n</ul>","fields":{"slug":"/how-to-distinct-2-kinds-of-markdown-in-gatsby","title":"Gatsbyで2種類のマークダウンファイルの区別する方法","date":"2019-06-01T21:00:00.000-07:00","excerpt":"なにこれGatsbyでWebサイトを作るときに、ブログや職種紹介など2種類以上のマークダウンファイルを管理する場合があると思います。通常だとMarkdownRemarkNodeのfileAbsolutePathでしか両者のマークダウンファイ...","tags":["Gatsby"],"keywords":["Gatsby"],"thumbnail":"thumbnail/2019/06/how-to-distinct-2-kinds-of-markdown-in-gatsby.png"}},{"html":"<h2 id=\"なにこれ\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p>Gatsbyでは、gatsby-node.jsのcreatePagesで以下のようにページを作成できます。\nただルートページ（index.jsのページ）はGatsby側で生成されるので通常はContextが設定できません。\nしかし場合によってはルートページにContextを設定したい時もあるでしょう。\nそこで今回は、ルートページにContextを設定する方法をご紹介します。</p>\n<div class=\"gatsby-code-title\">gatsby-node.jsでページにContextを設定する方法（ルートページでは使えない）</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">createPages</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> actions <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* (中略) */</span>\n\n  actions<span class=\"token punctuation\">.</span><span class=\"token function\">createPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    path<span class=\"token punctuation\">:</span> node<span class=\"token punctuation\">.</span>fields<span class=\"token punctuation\">.</span>slug<span class=\"token punctuation\">,</span>\n    component<span class=\"token punctuation\">:</span> qiitaPost<span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">    context<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n</span><span class=\"gatsby-highlight-code-line\">      slug<span class=\"token punctuation\">:</span> node<span class=\"token punctuation\">.</span>fields<span class=\"token punctuation\">.</span>slug<span class=\"token punctuation\">,</span>\n</span><span class=\"gatsby-highlight-code-line\">      relatedPosts<span class=\"token punctuation\">,</span>\n</span><span class=\"gatsby-highlight-code-line\">      latestPosts<span class=\"token punctuation\">,</span>\n</span><span class=\"gatsby-highlight-code-line\">      <span class=\"token operator\">...</span><span class=\"token function\">previouseAndNext</span><span class=\"token punctuation\">(</span>posts<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n</span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">/* (中略) */</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"実装方法\"><a href=\"#%E5%AE%9F%E8%A3%85%E6%96%B9%E6%B3%95\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>実装方法</h2>\n<p>gatsby-node.jsでは<a href=\"https://www.gatsbyjs.org/docs/node-apis/#onCreatePage\"><code class=\"language-text\">onCreatePage</code></a>というAPIが用意されており、ページ生成時の処理を定義できます。これを使って以下のような処理を実行します。</p>\n<div class=\"gatsby-code-title\">gatsby-node.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onCreatePage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> page<span class=\"token punctuation\">,</span> actions <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createPage<span class=\"token punctuation\">,</span> deletePage <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> actions\n\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// ルートページの場合のみ処理継続</span>\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">.</span>path <span class=\"token operator\">===</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span>\n</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// いったんルートページを削除</span>\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">deletePage</span><span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span>\n</span>\n  <span class=\"token comment\">// pageオブジェクトをもとにルートページを再生成</span>\n  <span class=\"token function\">createPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>page<span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">    context<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n</span><span class=\"gatsby-highlight-code-line\">      <span class=\"token operator\">...</span>page<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">,</span>\n</span><span class=\"gatsby-highlight-code-line\">      house<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`Gryffindor`</span></span><span class=\"token punctuation\">,</span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n</span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>やり方は原始的で、ルートページ生成されたときに一度削除して、ルートページを再生成します。\nこの時<code class=\"language-text\">createPage</code>の引数でContextを渡せば追加できます。</p>\n<p>ちなみに、<code class=\"language-text\">onCreatePage</code>で<code class=\"language-text\">craetePage</code>を呼び出すと無限ループになるのでは？と思うかもしれませんが、\n<code class=\"language-text\">onCratePage</code>はGatsby側で生成されたページの場合しか呼び出されないので、その心配はありません。<br/>\n以上です。🍅</p>\n<h2 id=\"参考\"><a href=\"#%E5%8F%82%E8%80%83\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"https://www.gatsbyjs.org/docs/creating-and-modifying-pages/#pass-context-to-pages\">Creating and Modifying Pages | GatsbyJS</a></li>\n</ul>","fields":{"slug":"/how-to-attach-context-to-root-page-in-gatsby","title":"GatsbyのルートページにContextを設定する方法","date":"2019-05-31T16:10:00.000+09:00","excerpt":"なにこれGatsbyでは、gatsby-node.jsのcreatePagesで以下のようにページを作成できます。ただルートページ（index.jsのページ）はGatsby側で生成されるので通常はContextが設定できません。しかし場合に...","tags":["Gatsby"],"keywords":["Gatsby"],"thumbnail":"thumbnail/2019/05/how-to-attach-context-to-root-page-in-gatsby.png"}},{"html":"<h2 id=\"なにこれ\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p>こんな感じで<a href=\"https://www.gatsbyjs.org/packages/gatsby-image/\">gatsby-image</a>の画像を表示したい。そんなコンポーネントの作成方法です。</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token keyword\">const</span> filename <span class=\"token operator\">=</span> <span class=\"token string\">'filepath/to/myimage.png'</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Image</span> <span class=\"token attr-name\">filename</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>filename<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span></code></pre></div>\n<br/>\n<p>gatsby-imageをちょっと知っている人ならわかると思うのですが、gatsby-imageで画像を表示するには、いちいちStaticQueryタグとGraphQLのクエリを定義する必要があって結構面倒です。そして<a href=\"https://www.gatsbyjs.org/packages/gatsby-image/\">公式ドキュメント</a>には画像のファイルパスをGraphQLのクエリにハードコードする方法しか載っておらず、<strong>Reactコンポーネントで画像ファイルパスを変数として扱う方法</strong>については記載がありません。\n<strong>そこで今回は、画像ファイルパスを渡せばgatsby-imageで画像を最適化して表示してくれるコンポーネントを作りました。</strong></p>\n<p>きっかけは、最近<a href=\"../\">自分のブログの記事一覧</a>のデザインを変えて、サムネイル画像を表示するようにしました。今までは体感速度がそれほど遅くないし、gatsby-imageは使い方が面倒くさそうだったので避けていました。たださすがに、50個以上のサムネイル画像を表示するようになると明らかに遅くなったので、gatsby-imageの導入を決めました。</p>\n<p>実際のソースコードは以下です。手っ取り早く実装方法を見たい方はコチラをご覧ください。</p>\n<p><a href=\"https://github.com/Takumon/blog/blob/master/src/components/image/index.js\">https://github.com/Takumon/blog/blob/master/src/components/image/index.js</a></p>\n<h2 id=\"実装\"><a href=\"#%E5%AE%9F%E8%A3%85\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>実装</h2>\n<h3 id=\"うまくいかない例\"><a href=\"#%E3%81%86%E3%81%BE%E3%81%8F%E3%81%84%E3%81%8B%E3%81%AA%E3%81%84%E4%BE%8B\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>うまくいかない例</h3>\n<p><a href=\"https://www.gatsbyjs.org/packages/gatsby-image/#how-to-use\">公式ドキュメント > How to use</a>ではGraphQLのクエリに画像ファイルパスをハードコードする方法が紹介されています。\nコレを参考にして、画像ファイルパスを変数として扱うには以下のようにすれば良さそうな気がします。</p>\n<div class=\"gatsby-code-title\">うまくいかない例</div>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> StaticQuery<span class=\"token punctuation\">,</span> graphql <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby'</span>\n<span class=\"token keyword\">import</span> Img <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby-image'</span>\n\n\n<span class=\"token comment\">// 画像ファイルパスをプロパティに取るようなコンポーネントを定義</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> filename <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n\n  <span class=\"token comment\">// ページじゃないコンポーネントでもGraphQLが使えるように</span>\n  <span class=\"token comment\">// StaticQueryタグを使う</span>\n  <span class=\"token operator\">&lt;</span>StaticQuery\n\n    <span class=\"token comment\">// GraphQLのクエリ引数にfilenameを指定！</span>\n    query<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>graphql<span class=\"token template-string\"><span class=\"token string\">`\n      query {\n        file(relativePath: { eq: \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>filename<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\" }) {\n          childImageSharp {\n            fixed(width: 800) {\n              ...GatsbyImageSharpFixed\n            }\n          }\n        }\n      }\n    `</span></span><span class=\"token punctuation\">}</span>\n\n    render<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// GraphQLでgatsby-image用の情報がdataに代入されているはず！</span>\n      <span class=\"token keyword\">const</span> fixed <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>file<span class=\"token punctuation\">.</span>childImageSharp<span class=\"token punctuation\">.</span>fixed\n\n      <span class=\"token comment\">// Imgタグでgatsby-imageで最適化された画像を表示する</span>\n      <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Img</span> <span class=\"token attr-name\">fixed</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>fixed<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<br/>\n<p>ただこれはうまく行きません。\nStaticQueryタグは文字通り「静的」であり、ビルド時に評価されるので、画面表示時に「動的」に変数を指定することはできないのです。またStaticQueryのクエリはテンプレートリテラルとして文字列補完をサポートしておらず、その結果ビルド時に以下のようなエラーになってしまいます。</p>\n<div class=\"gatsby-highlight\" data-language=\"txt\"><pre class=\"language-txt\"><code class=\"language-txt\">Error: BabelPluginRemoveGraphQL: String interpolations are not allowed in graphql fragments.\nIncluded fragments should be referenced as ...</code></pre></div>\n<br/>\n<h3 id=\"うまくいく例\"><a href=\"#%E3%81%86%E3%81%BE%E3%81%8F%E3%81%84%E3%81%8F%E4%BE%8B\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>うまくいく例</h3>\n<p>前述のうまくいかない例では、GraphQLのクエリで画像ファイルを特定しようとしていました。\n今回はコレを<strong>GraphQLのクエリですべての画像を取得して、描画時に画像ファイルを特定する</strong>ようにします。</p>\n<div class=\"gatsby-code-title\">うまくいく例</div>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> StaticQuery<span class=\"token punctuation\">,</span> graphql <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby'</span>\n<span class=\"token keyword\">import</span> Img <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby-image'</span>\n\n<span class=\"token comment\">// 画像ファイルパスをプロパティに取るようなコンポーネントを定義</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> filename <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n\n  <span class=\"token comment\">// ページじゃないコンポーネントでもGraphQLが使えるように</span>\n  <span class=\"token comment\">// StaticQueryタグを使う</span>\n  <span class=\"token operator\">&lt;</span>StaticQuery\n\n    <span class=\"token comment\">// GraphQLのクエリ引数には何も指定しない！</span>\n    query<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>graphql<span class=\"token template-string\"><span class=\"token string\">`\n      query {\n        images: allFile {\n          edges {\n            node {\n              relativePath\n              name\n              childImageSharp {\n                sizes(maxWidth: 800) {\n                  ...GatsbyImageSharpSizes\n                }\n              }\n            }\n          }\n        }\n      }\n    `</span></span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// 全画像情報がdataに代入されている</span>\n    render<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n      <span class=\"token comment\">// 指定した画像ファイルパス（コンポーネントのプロパティ）と</span>\n      <span class=\"token comment\">// 一致するgatsby-image用の情報を取得</span>\n      <span class=\"token keyword\">const</span> image <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>images<span class=\"token punctuation\">.</span>edges<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>n <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> n<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>relativePath<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>image<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span>\n      \n      <span class=\"token comment\">// Imgタグでgatsby-imageで最適化された画像を表示する</span>\n      <span class=\"token keyword\">const</span> imageSizes <span class=\"token operator\">=</span> image<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>childImageSharp<span class=\"token punctuation\">.</span>sizes\n      <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Img</span>　<span class=\"token attr-name\">sizes</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>imageSizes<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<br/>\n<p>これによってめんどくさい処理をコンポーネントに隠蔽できました。使う側は以下のように定義します。</p>\n<div class=\"gatsby-code-title\">コンポーネントの使用イメージ</div>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> Image <span class=\"token keyword\">from</span> <span class=\"token string\">'上記で作成したコンポーネントのパス'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> filename <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> filename <span class=\"token operator\">=</span> <span class=\"token string\">'filepath/to/myimage.png'</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Image</span> <span class=\"token attr-name\">filename</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>filename<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<br/>\n<h2 id=\"まとめ\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>今回はgatsby-imageを楽に使えるコンポーネントの作成方法を紹介しました。GraphQLのクエリですべての画像を取得するので、ビルドがちょっと遅くなります（実際のブラウザの表示には影響はありません）。それでも画像のファイルパスを変数として扱うことができるようになるし、実装が簡潔になるので、利便性は高いと言えるでしょう🍅</p>\n<h2 id=\"参考\"><a href=\"#%E5%8F%82%E8%80%83\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<p>実装は以下を参考にさせていただきました。ありがとうございます。</p>\n<ul>\n<li><a href=\"https://noahgilmore.com/blog/easy-gatsby-image-components/\">Easy Gatsby Image Components</a></li>\n<li><a href=\"https://qiita.com/tkkrr/items/34f384956fb968a30fe5\">Gatsby.jsの画像最適化プラグインgatsby-imageを触ってみてわかったこと。 - Qiita</a></li>\n<li><a href=\"https://github.com/gatsbyjs/gatsby/issues/2293\">Support Dynamic GraphQL Queries · Issue #2293 · gatsbyjs/gatsby</a></li>\n</ul>","fields":{"slug":"/simple-gatsby-image-wrapper","title":"パスを渡せばgatsby-imageで画像を表示してくれるコンポーネントの作成方法","date":"2019-05-13T19:00:00.000+09:00","excerpt":"なにこれこんな感じでgatsby-imageの画像を表示したい。そんなコンポーネントの作成方法です。  const filename = 'filepath/to/myimage.png'  return &#x3C;Image filen...","tags":["Gatsby","gatsy-image"],"keywords":["Gatsby"],"thumbnail":"thumbnail/2019/05/simple-gatsby-image-wrapper.png"}},{"html":"<h2 id=\"なにこれ\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p><a href=\"/wordcloud-with-kuromoji-d3cloud-nodejs\">前回記事</a>ではNode.jsでWordCloudを出力しました。\n今回は、<a href=\"https://github.com/Takumon/playbox2019/blob/master/node-kuromoji-d3cloud-sample/index.js\">前回のサンプル</a>をベースに自分のブログ（Gatsby製のブログ）にWordCloudを取り入れてみたので、その時の実装方法のメモです。</p>\n<p>※ソースコードは以下です。<br/>\n<a href=\"https://github.com/Takumon/blog/blob/master/gatsby-node.js\">https://github.com/Takumon/blog/blob/master/gatsby-node.js</a></p>\n<h2 id=\"wordcloudどんなかんじ？\"><a href=\"#wordcloud%E3%81%A9%E3%82%93%E3%81%AA%E3%81%8B%E3%82%93%E3%81%98%EF%BC%9F\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>WordCloudどんなかんじ？</h2>\n<p>(1)記事全文をインプットにしたものと、(2)記事のタグをインプットにしたものの2つを生成しました。<a href=\"./map\">全記事解析ページ</a>で見れます。</p>\n<h3 id=\"1記事全文をインプットにしたもの\"><a href=\"#1%E8%A8%98%E4%BA%8B%E5%85%A8%E6%96%87%E3%82%92%E3%82%A4%E3%83%B3%E3%83%97%E3%83%83%E3%83%88%E3%81%AB%E3%81%97%E3%81%9F%E3%82%82%E3%81%AE\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(1)記事全文をインプットにしたもの</h3>\n<p>キーワード以外にも、「登録」「実現」「まとめ」のような何回も使う表現がノイズとして混ざるのであまり満足度は高くありません。それでも「Gatsby」「React」が目立って表示されているので、形だけはWordCloudになっています。</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/de4be7280c02fcda494c51d41a9db86e/d9807/wordcloud-from-texts.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 52.480000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABcRAAAXEQHKJvM/AAACQ0lEQVQozxWSS2/cNhSF5//v8wO6aDYFCnTRJkA3TYHErWOPx/V4NNLoQT1JiSKpx8h208XXmwUhggLOPeeeb3d93Rhnj58mgnf4pce7Qd4Mg+m41h2mbSgGRTOMWFszukBwHVNwhGlkmReuc2C7vrJ7XT3L5HhxI6uzcu/RfUPrRbBqeYtSGvNE3O+p25ReL5R2pGgadJPS2o6xMyzesi0ru//WhS0Yrs4wFyJYlWRNzSlVZFlKXVSk6d+o8o68iriUjkqc38p/VSpsL4J9Id+GdZ2+O1xpp5mqc9iHPdPDX8Sq4v6iqO4/c36856Yt+KwyjkWNKVryPKfSMmjo6Kwm6s4YnYpgYPc2WbHcscmu1n/uMOeYJLMczjX6yz3Nwy2hembMjvjswt3jhcPTmfF4gz9/RdlAYhxdr/Hjd8HR8q2ucGZgH39ijb6gniTeJWLQJ0p1IjvteRSB/JKTHs/YJGFsDrwlN6xFTKVmlraW/Y/s1uuGC4HUaFSb8a9MvT3+wof4N354fMfvya/8fPiJHx/e8zH5kzQe6OsEpQtCpzDlM1pK8UMtkVt203XFeY2Whp1En8qR7vlInP9BlH8lkt095xH78oZPlz2nk+KQtWS1xqlISosJfc3cD0zLzG6TUiY/oSV6PfSUcoK0bJUg0gWqytOpknOTUDeWIIVY1VKOrRiIRajAC0arF/xeBZtvm+M6CjLzzGgHcdpIcxWTYOCsDLEGIw56GRi05sUoZi2sCrdWXG3CqxOO50XAfln4H6dQ3Q7nZ23oAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"wordcloud from texts\"\n        title=\"\"\n        src=\"/static/de4be7280c02fcda494c51d41a9db86e/42603/wordcloud-from-texts.png\"\n        srcset=\"/static/de4be7280c02fcda494c51d41a9db86e/f931c/wordcloud-from-texts.png 200w,\n/static/de4be7280c02fcda494c51d41a9db86e/e8031/wordcloud-from-texts.png 400w,\n/static/de4be7280c02fcda494c51d41a9db86e/42603/wordcloud-from-texts.png 800w,\n/static/de4be7280c02fcda494c51d41a9db86e/5b8b9/wordcloud-from-texts.png 1200w,\n/static/de4be7280c02fcda494c51d41a9db86e/c7ea5/wordcloud-from-texts.png 1600w,\n/static/de4be7280c02fcda494c51d41a9db86e/d9807/wordcloud-from-texts.png 1875w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    \n<br/></p>\n<h3 id=\"2記事のタグをインプットにしたもの\"><a href=\"#2%E8%A8%98%E4%BA%8B%E3%81%AE%E3%82%BF%E3%82%B0%E3%82%92%E3%82%A4%E3%83%B3%E3%83%97%E3%83%83%E3%83%88%E3%81%AB%E3%81%97%E3%81%9F%E3%82%82%E3%81%AE\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>(2)記事のタグをインプットにしたもの</h3>\n<p>上記を作ってみて満足いかなかったので、試しに記事のタグをインプットにしたものを作ってみたら、思いのほかそれっぽくなりました。自分の直感とも一致していているので、「どんなブログ書いてるの？」という質問の答えとして十分使えそうです。</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a2d86827695eec6552e7881612d06b66/d9807/wordcloud-from-tags.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 53.17333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABcRAAAXEQHKJvM/AAACY0lEQVQoz2WTW2/TQBCF8/9/Ak/wwFNBogIkWqBCFERRLylpkzSpE8dx7fjutde32PF+bFqEkBjpaLWzqzNn9swO0KGU4t/Yb/eZSXBLHNtQ1fS1oCk7ml3PRpb0Xfd0V6PftSh/AtuCwXabE1g2tczY1iky9hCBS1kWvF0cchU8YMQxNB6NaCnaHb4+y4RAFBW0LeQhLD6h2ppBVW5wjRW+OWM1vsaYXGGNb1lPPQ6mH3hzsWSkC96sHT7+2vB+5HJmRnybebw8M7mYe5h3c/Lh60fFg6TwSBYLiuwW2eqqurJ0a+y5rwmPNYnF4YXJizObZ19Nju483t04vLpac3Bxz9Ek4PnJiM4Z6f53DMqypDBNZHKNHy6xlnN8K2Rx43Pln3O2vuPSvmPo3DNyZjhhzMR2Md2IteGycAS/ZgYsj+n7joFMM/K5QRYPsTcxG9sh8jyClcR9MLiXBsnskvzbF4Ifp8iTE4rvP6hHQ/rTz/jff+K7gtZd0VWVVpikWpkgycfIqiSVEhGV2JOEWqsplxHV2KK+XpOOXRqtJpkPqYIptTUjWT3gODleICnqrTYlSbClwMumjMuK66xgqg/Pb31ths9yJVhaGZEb09sLemuESLXjuaFdjsjSXHckUc2WXg/RoMky5Ra5CrOxCtNEraJcxXamVhupbFFq+MqVkUr9RHWbWMmlpSoRqb6MVVwIta081clMPbJpWwZ7q5s/g7wPUXWkVg7d04Q3maCL1qg0hazRrUbk+t21oez4P/aE4b+o2l1Y502oyUK1z+lVf5GQbvv3jtrn+APFI55yhL8BmF02pml+TKcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"wordcloud from tags\"\n        title=\"\"\n        src=\"/static/a2d86827695eec6552e7881612d06b66/42603/wordcloud-from-tags.png\"\n        srcset=\"/static/a2d86827695eec6552e7881612d06b66/f931c/wordcloud-from-tags.png 200w,\n/static/a2d86827695eec6552e7881612d06b66/e8031/wordcloud-from-tags.png 400w,\n/static/a2d86827695eec6552e7881612d06b66/42603/wordcloud-from-tags.png 800w,\n/static/a2d86827695eec6552e7881612d06b66/5b8b9/wordcloud-from-tags.png 1200w,\n/static/a2d86827695eec6552e7881612d06b66/c7ea5/wordcloud-from-tags.png 1600w,\n/static/a2d86827695eec6552e7881612d06b66/d9807/wordcloud-from-tags.png 1875w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    \n<br/></p>\n<h2 id=\"処理概要\"><a href=\"#%E5%87%A6%E7%90%86%E6%A6%82%E8%A6%81\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>処理概要</h2>\n<p>Gatsbyを使う場合、画面に必要なデータはビルド時に生成するのがベーシックなやり方です。\nそのためSVG生成は、表示時のReactコンポーネントではなくビルド時の処理（gatsby-node.js）にて行いました。\nビルドはNode.jsの世界ですから、前回記事の<a href=\"https://github.com/Takumon/playbox2019/blob/master/node-kuromoji-d3cloud-sample/index.js\">Node.jsでWordCloudのSVG画像を出力するサンプル</a>が、ほぼそのまま使えるわけです。サンプルと、Gatsbyビルド処理のお作法（gatsby-node.jsの書き方）を考慮して以下のような手順でSVG画像のデータを生成します。</p>\n<ul>\n<li>\n<p>記事全文のWordCloud生成</p>\n<ul>\n<li>記事全文を取得 ☚Gatsbyビルド処理のお作法</li>\n<li>記事全文をインプットにkuromoji.jsで形態素解析</li>\n<li>解析結果をインプットにD3-Cloudでフォーマット</li>\n<li>解析結果をインプットにd3.jsでSVG文字列生成</li>\n<li>Gatsbyページ生成時にContextのプロパティとして渡す ☚Gatsbyビルド処理のお作法</li>\n</ul>\n</li>\n<li>\n<p>記事全タグのWordCloud生成</p>\n<ul>\n<li>記事全タグを取得 ☚Gatsbyビルド処理のお作法</li>\n<li>記事全タグをインプットにタグ出現回数を算出</li>\n<li>解析結果をインプットにD3-Cloudでフォーマット</li>\n<li>解析結果をインプットにd3.jsでSVG文字列生成</li>\n<li>Gatsbyページ生成時にContextのプロパティとして渡す ☚Gatsbyビルド処理のお作法</li>\n</ul>\n</li>\n</ul>\n<p>そして表示時にコンポーネントでSVGデータを取得し画面に表示します。</p>\n<h2 id=\"処理のチューニングポイント\"><a href=\"#%E5%87%A6%E7%90%86%E3%81%AE%E3%83%81%E3%83%A5%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>処理のチューニングポイント</h2>\n<p>WordCloudの品質を上げるために以下のようなチューニングを実施しました。</p>\n<ul>\n<li>\n<p>「Gatsby」[gatsby」などは同じ単語とみなしてカウントしています。</p>\n<ul>\n<li>文章中で前後文脈によって大文字小文字の差があるものは、同じ単語としてカウントしています。</li>\n<li>最終的にWordCloudに表示する単語は一番大文字の数が多い単語（「Gatsby」[gatsby」なら「Gatsby」）を採用するようにしました。</li>\n</ul>\n</li>\n<li>\n<p>記事全文は、マークダウンではなくHTMLをインプットにして、HTMLタグを除外、さらにpreタグは中身ごと除外してから形態素解析のインプットとして渡しています。</p>\n<ul>\n<li>マークダウンはリンク、スタイルなどメタ情報が多いため、いったんHTMLに変換したものからHTMLタグを抜くことで純粋な文書だけを抽出しています。</li>\n<li>またソースコードには同じような表現が多く含まれ、WordCloudの対象にするにはノイズが大きく、大事な単語であればソースコード外の文章中に出てくるという前提のもと、ソースコードはすべて除外しています</li>\n<li>「時」「場合」など言い回しとして何度も出てくる単語はWordCloudの情報にしても意味がないので除外しています。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"処理詳細（実装）\"><a href=\"#%E5%87%A6%E7%90%86%E8%A9%B3%E7%B4%B0%EF%BC%88%E5%AE%9F%E8%A3%85%EF%BC%89\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>処理詳細（実装）</h2>\n<p>ちょっと長いですが、\nソースコード中のコメントにて詳細を説明します。</p>\n<div class=\"gatsby-code-title\">gatsby-node.jsからWordCloud生成処理抜粋</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/** HTML形式の記事本文からHTMLタグを削除するために使う */</span>\n<span class=\"token keyword\">const</span> striptags <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'striptags'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">/** 仮想DOM d3.js D3-CloudはDOMがある前提なのでNode.js実行時でも正常動作するように仮想Canvasを使う */</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createCanvas <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">/** 仮想DOM d3.js D3-CloudはDOMがある前提なのでNode.js実行時でも正常動作するように仮想DOMを使う */</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">JSDOM</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'jsdom'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">/** 形態素解析のために使う */</span>\n<span class=\"token keyword\">const</span> kuromoji <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'kuromoji'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">/** WordCloudのSVG文字列作成用 */</span>\n<span class=\"token keyword\">const</span> d3 <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'d3'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">/** WordCloudのSVG文字列作成用 */</span>\n<span class=\"token keyword\">const</span> cloud <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'d3-cloud'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">/** createPageにてWordCloud生成処理を実装する */</span>\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">createPages</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> graphql<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> createPage <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">/** (略)ページコンポーネント呼び出し */</span>\n\n    <span class=\"token function\">graphql</span><span class=\"token punctuation\">(</span><span class=\"token comment\">/** (略)記事情報呼び出しクエリ */</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>result <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n      <span class=\"token comment\">/** (略)もろもろのページ作成 */</span>\n\n\n      <span class=\"token comment\">// WordCloud用データ加工処理</span>\n\n      <span class=\"token comment\">/** (略)resultから記事全文の配列(allPostHtmlTexts)を取得する処理 */</span>\n\n      <span class=\"token comment\">// 記事全文文字列取得</span>\n      <span class=\"token keyword\">const</span> allPostTexts <span class=\"token operator\">=</span> allPostHtmlTexts\n        <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>allHtmlTexts <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// HTML文字列からタグを除外</span>\n          <span class=\"token comment\">// ただしpreタグは、中身をWordCloud解析対象外とするためここではあえて残している</span>\n          <span class=\"token keyword\">const</span> stripedAllText <span class=\"token operator\">=</span> <span class=\"token function\">striptags</span><span class=\"token punctuation\">(</span>allHtmlTexts<span class=\"token punctuation\">,</span> <span class=\"token string\">'&lt;pre>'</span><span class=\"token punctuation\">)</span>\n\n          <span class=\"token comment\">// そのためpreタグとその中身を除外する。</span>\n          <span class=\"token comment\">// preタグの中見はソースコード。</span>\n          <span class=\"token comment\">// キーワードはソースコード外の文章中に記述していることを想定して</span>\n          <span class=\"token comment\">// WordCloudの対象から外す。</span>\n          <span class=\"token keyword\">return</span> <span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/&lt;pre[\\s\\S]+?>[\\s\\S]+?&lt;\\/pre>/g</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 改行でつなぐ</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span>\n      \n\n      <span class=\"token comment\">/** (略)resultから記事全タグの配列(allPostTags)を取得する処理 */</span>\n\n      <span class=\"token comment\">// 記事タグ取得</span>\n      <span class=\"token keyword\">const</span> tagDatas <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n      <span class=\"token comment\">// 記事全タグ情報からどのタグが何回出現するか算出</span>\n      allPostTags<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>tags <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        tags<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n          <span class=\"token keyword\">const</span> targetData <span class=\"token operator\">=</span> tagDatas<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>data <span class=\"token operator\">=></span> data<span class=\"token punctuation\">.</span>text <span class=\"token operator\">===</span> t<span class=\"token punctuation\">)</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>targetData<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            targetData<span class=\"token punctuation\">.</span>size <span class=\"token operator\">=</span> targetData<span class=\"token punctuation\">.</span>size <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n          <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            tagDatas<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n              text<span class=\"token punctuation\">:</span> t<span class=\"token punctuation\">,</span>\n              size<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n\n      <span class=\"token comment\">// タグ出現回数をインプットにWordCloud生成</span>\n      <span class=\"token comment\">// タグ情報の場合形態素解析せずとも単語ごとの出現回数が算出できるので</span>\n      <span class=\"token comment\">// 形態素解析はスキップしている</span>\n      <span class=\"token function\">createWordCloud</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        words<span class=\"token punctuation\">:</span> tagDatas<span class=\"token punctuation\">,</span>\n        w<span class=\"token punctuation\">:</span> <span class=\"token number\">1200</span><span class=\"token punctuation\">,</span>\n        h<span class=\"token punctuation\">:</span> <span class=\"token number\">630</span><span class=\"token punctuation\">,</span>\n        fontSizePow<span class=\"token punctuation\">:</span> <span class=\"token number\">0.8</span><span class=\"token punctuation\">,</span>\n        fontSizeZoom<span class=\"token punctuation\">:</span> <span class=\"token number\">18</span><span class=\"token punctuation\">,</span>\n        padding<span class=\"token punctuation\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>tagSvg <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// タグをインプットにしたSVGが出来上がる</span>\n\n        <span class=\"token comment\">// 記事全文文字列をインプットに単語出現回数を算出</span>\n        <span class=\"token function\">createWordCount</span><span class=\"token punctuation\">(</span>alltext<span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>data <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n            <span class=\"token comment\">// 記事全文の単語出現回数をインプットにWordCloud生成</span>\n            <span class=\"token keyword\">return</span> <span class=\"token function\">createWordCloud</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n              words<span class=\"token punctuation\">:</span> data<span class=\"token punctuation\">,</span>\n              w<span class=\"token punctuation\">:</span> <span class=\"token number\">1200</span><span class=\"token punctuation\">,</span>\n              h<span class=\"token punctuation\">:</span> <span class=\"token number\">630</span><span class=\"token punctuation\">,</span>\n              fontSizePow<span class=\"token punctuation\">:</span> <span class=\"token number\">0.6</span><span class=\"token punctuation\">,</span>\n              fontSizeZoom<span class=\"token punctuation\">:</span> <span class=\"token number\">3.1</span><span class=\"token punctuation\">,</span>\n              padding<span class=\"token punctuation\">:</span> <span class=\"token number\">0.2</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>textSvg <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 記事全文をインプットにしたSVGが出来上がる</span>\n\n            <span class=\"token comment\">// ページ生成時にSVGをContextのプロパティとして渡す</span>\n            <span class=\"token function\">createPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n              path<span class=\"token punctuation\">:</span> <span class=\"token string\">'/map/'</span><span class=\"token punctuation\">,</span>\n              component<span class=\"token punctuation\">:</span> postRelationMapPage<span class=\"token punctuation\">,</span>\n              context<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n                allPostRelations<span class=\"token punctuation\">,</span>\n                wordCloudText <span class=\"token punctuation\">:</span> textSvg<span class=\"token punctuation\">,</span>\n                wordCloudTag<span class=\"token punctuation\">:</span> tagSvg<span class=\"token punctuation\">,</span>\n              <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n            <span class=\"token comment\">// すべてのcreatePageを呼び終わったあとにresolveを呼んで処理終了</span>\n            <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'OK'</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/**\n * ２つの単語の大文字小文字の違いをカウントする\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">countDiff</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> a\n    <span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>charA<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> charA <span class=\"token operator\">===</span> b<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">?</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n\n<span class=\"token comment\">/**\n * 指定した文字列を形態素解析して単語ごとの出現回数を返す\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">createWordCount</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token comment\">// よく出る言い回しでWordCloudから除外したい単語を列挙  </span>\n  <span class=\"token keyword\">const</span> excludeWords <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'指定'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'時'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'追加'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">/** (略)除外したい単語 */</span>\n  <span class=\"token punctuation\">]</span>\n\n\n  <span class=\"token comment\">/** kuromoji.jsにバンドルされている辞書の格納場所 */</span>\n  <span class=\"token keyword\">const</span> <span class=\"token constant\">DIC_URL</span> <span class=\"token operator\">=</span> <span class=\"token string\">'node_modules/kuromoji/dict'</span>\n\n  <span class=\"token comment\">/** WordCloudでカウントする品詞（助詞・助動詞などは省く） */</span>\n  <span class=\"token keyword\">const</span> <span class=\"token constant\">TARGET_POS</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'名詞'</span><span class=\"token punctuation\">]</span>\n\n  <span class=\"token comment\">/** kuromoji.jsで該当プロパティの値が存在しない場合に設定されている値 */</span>\n  <span class=\"token keyword\">const</span> <span class=\"token constant\">NO_CONTENT</span> <span class=\"token operator\">=</span> <span class=\"token string\">'*'</span>\n\n  <span class=\"token comment\">// kuromoji.jsで形態素解析</span>\n  <span class=\"token comment\">// 単語ごとの出現回数を出力</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n    kuromoji<span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> dicPath<span class=\"token punctuation\">:</span> <span class=\"token constant\">DIC_URL</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">,</span> tokenizer<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token comment\">// 単語ごとの出現回数を出力</span>\n      <span class=\"token keyword\">const</span> words <span class=\"token operator\">=</span> tokenizer<span class=\"token punctuation\">.</span><span class=\"token function\">tokenize</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">=></span> <span class=\"token constant\">TARGET_POS</span><span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">.</span>pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">=></span> t<span class=\"token punctuation\">.</span>basic_form <span class=\"token operator\">===</span> <span class=\"token constant\">NO_CONTENT</span> <span class=\"token operator\">?</span> t<span class=\"token punctuation\">.</span>surface_form <span class=\"token punctuation\">:</span> t<span class=\"token punctuation\">.</span>basic_form<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> text<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// 大文字と小文字を区別せず出現回数をカウントする</span>\n          <span class=\"token keyword\">const</span> upperText <span class=\"token operator\">=</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">toUpperCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>excludeWords<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>upperText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> data\n          <span class=\"token punctuation\">}</span>\n\n          <span class=\"token keyword\">const</span> target <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>c <span class=\"token operator\">=></span> c<span class=\"token punctuation\">.</span>text <span class=\"token operator\">===</span> upperText<span class=\"token punctuation\">)</span>\n\n          <span class=\"token comment\">// 出現回数は大文字小文字を区別しないが、実際の生の単語は後の処理で使うためとっておく</span>\n          <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            target<span class=\"token punctuation\">.</span>size <span class=\"token operator\">=</span> target<span class=\"token punctuation\">.</span>size <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>target<span class=\"token punctuation\">.</span>rawTexts<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              target<span class=\"token punctuation\">.</span>rawTexts<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            data<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n              text<span class=\"token punctuation\">:</span> upperText<span class=\"token punctuation\">,</span>\n              rawTexts<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> text <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n              size<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span>\n          <span class=\"token keyword\">return</span> data\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>data <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n          <span class=\"token comment\">// 上記処理で保持しておいた生の単語をもとに、一番大文字が多い単語をWordCloudの単語として採用する</span>\n          <span class=\"token comment\">// 例えばGatsbyとgatsbyであればGatsbyを採用</span>\n          <span class=\"token keyword\">const</span> almostSameText <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>rawTexts<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>text <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n                text<span class=\"token punctuation\">,</span>\n                diff<span class=\"token punctuation\">:</span> <span class=\"token function\">countDiff</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> a<span class=\"token punctuation\">.</span>diff <span class=\"token operator\">&lt;=</span> b<span class=\"token punctuation\">.</span>diff <span class=\"token operator\">?</span> a <span class=\"token punctuation\">:</span> b<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 大文字に近いほうを採用する</span>\n            <span class=\"token punctuation\">.</span>text\n          \n          <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n            text<span class=\"token punctuation\">:</span> almostSameText<span class=\"token punctuation\">,</span>\n            size<span class=\"token punctuation\">:</span> data<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n      <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>words<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/**\n * 単語出現回数をもとにWordCloudのSVG文字列を返す\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">createWordCloud</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  words<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 単語出現回数</span>\n  w<span class=\"token punctuation\">,</span> <span class=\"token comment\">// SVGの幅(単位px)</span>\n  h<span class=\"token punctuation\">,</span> <span class=\"token comment\">// SVGの高さ(単位px)</span>\n  fontSizePow<span class=\"token punctuation\">,</span> <span class=\"token comment\">// WordCloudの文字の大きさの比率調整用係数</span>\n  fontSizeZoom<span class=\"token punctuation\">,</span> <span class=\"token comment\">// WordCloudの文字の大きさの係数</span>\n  padding<span class=\"token punctuation\">,</span> <span class=\"token comment\">// WordCloudの文字間の隙間</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token comment\">// D3-Cloudによる解析</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">cloud</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>w<span class=\"token punctuation\">,</span> h<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">canvas</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span>w<span class=\"token punctuation\">,</span> h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">words</span><span class=\"token punctuation\">(</span>words<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">rotate</span><span class=\"token punctuation\">(</span>word <span class=\"token operator\">=></span> word<span class=\"token punctuation\">.</span>size <span class=\"token operator\">%</span> <span class=\"token number\">2</span> <span class=\"token operator\">===</span> <span class=\"token number\">1</span> <span class=\"token operator\">?</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">:</span> <span class=\"token number\">90</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 出現回数に応じて縦か横向きに表示</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">fontWeight</span><span class=\"token punctuation\">(</span>word <span class=\"token operator\">=></span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">pow</span><span class=\"token punctuation\">(</span>word<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">,</span> fontSizePow<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> fontSizeZoom<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">fontSize</span><span class=\"token punctuation\">(</span>word <span class=\"token operator\">=></span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">pow</span><span class=\"token punctuation\">(</span>word<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">,</span> fontSizePow<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> fontSizeZoom<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">font</span><span class=\"token punctuation\">(</span><span class=\"token string\">'meiryo'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">padding</span><span class=\"token punctuation\">(</span>padding<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'end'</span><span class=\"token punctuation\">,</span> wordsForCloud <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>wordsForCloud<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// d3.jsによる解析</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>wordsForCloud <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">/** 仮想DOM */</span>\n      <span class=\"token keyword\">const</span> document <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JSDOM</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`&lt;body>&lt;/body>`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>window<span class=\"token punctuation\">.</span>document\n\n      d3<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">'svg'</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'class'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ui fluid image'</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'viewBox'</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token string\">`0 0 </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>w<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>h<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'width'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'100%'</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'height'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'100%'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">'g'</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'transform'</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token string\">`translate(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>w<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">,</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>h<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)`</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">selectAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'text'</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span>wordsForCloud<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">enter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">'text'</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">'font-size'</span><span class=\"token punctuation\">,</span> d <span class=\"token operator\">=></span> <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>d<span class=\"token punctuation\">.</span>size<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px`</span></span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">'font-family'</span><span class=\"token punctuation\">,</span> d <span class=\"token operator\">=></span> d<span class=\"token punctuation\">.</span>font<span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'transform'</span><span class=\"token punctuation\">,</span> d <span class=\"token operator\">=></span> <span class=\"token template-string\"><span class=\"token string\">`translate(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>d<span class=\"token punctuation\">.</span>x<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>d<span class=\"token punctuation\">.</span>y<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)rotate(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>d<span class=\"token punctuation\">.</span>rotate<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)`</span></span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fill'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>d<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> d3<span class=\"token punctuation\">.</span>schemeCategory10<span class=\"token punctuation\">[</span>i <span class=\"token operator\">%</span> <span class=\"token number\">10</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'text-anchor'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'middle'</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span>d <span class=\"token operator\">=></span> d<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">)</span>\n      \n      <span class=\"token comment\">// 最終的にSVGの文字列を返す</span>\n      <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>innerHTML<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<h2 id=\"まとめ\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>自分のブログにWordCloudを導入したいと思い立ち、WordCloudについて3回にわたりブログを書いてきましたが、各種ライブラリのおかげで、すんなりと導入できました。\n人に自分のブログを紹介するときのネタとしてはとても効果的だと思います。<br/>\nなお形態素解析やWordCloud生成は重い処理なので、ビルドに時間がかかるようになってしまいますが、画面表示に関してはパフォーマンスに影響はありません。<br/>\nあと本来であればプラグイン化して配布したいところですが、プラグイン化のためには、まだまだ汎用性を高る必要があって、それは今後の課題です🍅</p>","fields":{"slug":"/wordcloud-in-gatsby-blog","title":"Gatsby製ブログにWordCloudを導入","date":"2019-05-11T17:00:00.000+09:00","excerpt":"なにこれ前回記事ではNode.jsでWordCloudを出力しました。今回は、前回のサンプルをベースに自分のブログ（Gatsby製のブログ）にWordCloudを取り入れてみたので、その時の実装方法のメモです。※ソースコードは以下です。ht...","tags":["Gatsby","kuromoji.js","d3.js","d3Cloud","形態素解析","データ可視化","WordCloud"],"keywords":["Gatsby"],"thumbnail":"thumbnail/2019/05/wordcloud-in-gatsby-blog.png"}}],"latestPosts":[{"html":"<h2 id=\"なにこれ\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p>一時期いろんな勉強会に行きましたが、「勉強会に参加すると勉強している気になるだけで実際そうじゃない」ので最近はモクモク会にしか顔を出さなくなりました。\nその中でも<a href=\"https://shinjuku-moku.connpass.com/\">Shinjuku Mokumoku Programming</a>(通称「新宿もくもく」)にはほぼ毎週参加していた覚えがあります。\n僕は2019年6月に転勤で東京を離れてしまって行けなくなりましたが、一番お気に入りの勉強会だったので、この記事で紹介したいと思います。</p>\n<h2 id=\"必ず毎週開催される\"><a href=\"#%E5%BF%85%E3%81%9A%E6%AF%8E%E9%80%B1%E9%96%8B%E5%82%AC%E3%81%95%E3%82%8C%E3%82%8B\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>必ず毎週開催される</h2>\n<p><a href=\"https://shinjuku-moku.connpass.com/\">コンパスイベントページ</a></p>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 612px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 122.22222222222221%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAA7DAAAOwwHHb6hkAAADyklEQVQ4y41V224iRxTkb5I/QELyu73A7n7g5iFaozxF+YLkD9aOBOZuC3Mzc78yt4Y+qWoYkxVRtCOVeobuOXNOVZ1DYzQa/S64qqqS9+sYiRRr+ZHreDxKWZbm/vX19Y/GZDL5lQ+B7xeOY6uiVMpe9NVq8Jd6XSwUDqn1eq2Wy6XabDbKti2121nqcDgoXlEUqTCMCsbAma+N4Wh0z4eHb9/UcDiUJInF9UJZby2ZTqcynU3Ftm1J01TiOJb9fi9ZlonWuk6SN4o3+HCvMR6PTcAkSRTLriolcRKK59kmUBgGEgEJgqVpYqjR+ihIsIZWqjIBV6tVr/Hy8nJ/5kKRj+NRS1GEkkSW7NNYyiKTOAqkKnMEK8wzUeR7ybOU0FmWngMuew2UZQKCWJXnOFgdJd4MJJz9Ka7riOf7EkaROI6LkhNTMgEOJc9z8X1fY0+dOew1RmcOB/2+Gj49Ga7e3rby8jwX0CHjyZgHxbIs2W63Zt3tdgI9apU1q7vicAk1Pc9DuYUh38aLOIDgbwIlze/M6Dt7/ZcodYZQTvGFWkWCQYhsn1E0g3qfZwnsa6zq7MNe4+/Hx3tmRK8xGyobBAG5MSsRhqHJmgG5EqyG5wENdU0ys9n8IkqBr/DrtI3rurJCuY7jvINBGYQrQUewfDSE9jz/Ypu65MeHB9Xv900WJH6xWAi6SCbTiaBDTMa27WD1jPJU+X85tHY7RfOyL01JsAwDWbYlIcomb6ygLIpTFHTKybdU+XAJ+Pz8/L2xD0fZ5ygrcoyhaeDAdyFMckF2gjF2vtf5v409n89NQHXqdcMLy6YYJxOnJjvuvQNn+PHa2OD22tjz2UwBJghLhWLAzAwH8klTwxZYN7LGPgOzbCSg2WVXokzGY7VCRzBgFMXiwD4MxC6hquT2h4yNLE4l49LYI4dJSh9ahrsUA8J1LDNxotDH1AnJm+HWDIoy12WRX0+bA0ShFVhKlnP2QVnwV5ZsueycCKApHLkuwe0ewoUaI+7CYd3LMLNyYWC2Gpt/sXg1vUyQP3bQdstOsuBT24jCj0NAzan9niGm9NezsaunwUDzAFTTCKRn06lGJ2kEM7+DS41phPmXa30a2TWqM4f3/E/p8SHFCzXLGJgQwmNbmSnNvwXah6VzWl+0OOGgKn0O+BsDfmH6KDWAinFZlHGUuLHn7WLfc2KIELu2ZVYCZr9CFAUBhYIevzRardbP7Xa7dXt727y7uzPotD82u93PwMfmhw/t5qdPn81KtNudZqfTbbY7HaB7An/rdls3Nzc//QP9oeBaZ857xgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"connpass event list\"\n        title=\"\"\n        src=\"/static/d4852b01a57efa0adb0f463d7654684b/15f98/connpass-event-list.png\"\n        srcset=\"/static/d4852b01a57efa0adb0f463d7654684b/e6bc1/connpass-event-list.png 200w,\n/static/d4852b01a57efa0adb0f463d7654684b/f4555/connpass-event-list.png 400w,\n/static/d4852b01a57efa0adb0f463d7654684b/15f98/connpass-event-list.png 612w\"\n        sizes=\"(max-width: 612px) 100vw, 612px\"\n      />\n    </span>\n  </span>\n  を見るとわかりますが、週次で開催されています。\n勉強会のなかには開催が不定期で開催予定日を常にウォッチしておく必要がありますが、\n新宿もくもくはほぼ毎週欠かさず開催されるのでウォッチ不要です。\n自分の生活の一部として週一モクモク会参加を習慣化できます。</p>\n<h2 id=\"1回の時間が長い\"><a href=\"#1%E5%9B%9E%E3%81%AE%E6%99%82%E9%96%93%E3%81%8C%E9%95%B7%E3%81%84\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1回の時間が長い</h2>\n<p>朝11:00から夕方6:00と比較的長めです。\n途中にランチ、最後に成果発表がありますが、実質<strong>5時間</strong>は作業できます。\nせっかく来たならガッツリもくもくしたい！という人にピッタリです。</p>\n<h2 id=\"最初にやること宣言、最後に成果発表\"><a href=\"#%E6%9C%80%E5%88%9D%E3%81%AB%E3%82%84%E3%82%8B%E3%81%93%E3%81%A8%E5%AE%A3%E8%A8%80%E3%80%81%E6%9C%80%E5%BE%8C%E3%81%AB%E6%88%90%E6%9E%9C%E7%99%BA%E8%A1%A8\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>最初にやること宣言、最後に成果発表</h2>\n<p>まず勉強会の最初に、以下リポジトリに本日やることをプッシュして自己紹介を兼ねて各自宣言します。\nそして最後に、成果をプッシュして成果発表をします。\n成果発表では<a href=\"https://gitpitch.com/\">GitPitch</a>を使って2～3分程度みんなの前で発表します。\nこのような仕組みによって自分に適度なプレッシャーを与え、効率的に作業を進められます。</p>\n<div class=\"iframely-embed\"><div class=\"iframely-responsive\" style=\"height: 140px; padding-bottom: 0;\"><a href=\"https://github.com/shinjuku-mokumoku/shinjuku-mokumoku/tree/master/meetups\" data-iframely-url=\"//cdn.iframe.ly/WUoeQH0\"></a></div></div>\n<h2 id=\"ランチのお店がおいしい\"><a href=\"#%E3%83%A9%E3%83%B3%E3%83%81%E3%81%AE%E3%81%8A%E5%BA%97%E3%81%8C%E3%81%8A%E3%81%84%E3%81%97%E3%81%84\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ランチのお店がおいしい</h2>\n<p>午前中に勉強会Slackにて、ランチのお店の候補が提示されるので各自行きたいお店を選んで昼1:00になったらランチに行きます。\n候補は、寿司、和食、パスタ、カレー、中華などいろんなお店があって、どのお店もめっちゃおいしい料理が出てきます。</p>\n<p>午前中2時間もくもくして、おいしいランチを食べて、午後また集中してもくもくするといった流れです。\n立て込んでいる場合はランチに行かずに会場に残って作業することもできます。</p>\n<h2 id=\"おいしいコーヒ\"><a href=\"#%E3%81%8A%E3%81%84%E3%81%97%E3%81%84%E3%82%B3%E3%83%BC%E3%83%92\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>おいしいコーヒ</h2>\n<p>電源、Wifiはもちろん用意されているのですが、ウォーターサーバーとコーヒーサーバーもあります。\nコーヒーサーバーはちょっと高級なものらしく、とてもおいしいコーヒーが飲めます。</p>\n<h2 id=\"会場は代々木駅から徒歩１分、最近できた素敵なフロア\"><a href=\"#%E4%BC%9A%E5%A0%B4%E3%81%AF%E4%BB%A3%E3%80%85%E6%9C%A8%E9%A7%85%E3%81%8B%E3%82%89%E5%BE%92%E6%AD%A9%EF%BC%91%E5%88%86%E3%80%81%E6%9C%80%E8%BF%91%E3%81%A7%E3%81%8D%E3%81%9F%E7%B4%A0%E6%95%B5%E3%81%AA%E3%83%95%E3%83%AD%E3%82%A2\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>会場は代々木駅から徒歩１分、最近できた素敵なフロア</h2>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 63.142857142857146%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAADJElEQVQozwEZA+b8AIt9b5SGeXxuYo19b31wYmRZTF1QQ3luYXBkWF1PQmteUllPRWBVS25iV2ddUmRbUWtjW3BtanFubW1qaQCVh3eZjX+RhXmjlIihkoeRgXWXiHqEd2twYlZ3aFluX1JhU0hmWU5rYFZoXlRoYFlmX1hsZV9wa2dvbW4Ajn9xiXpqiXxujX9xin9yj4R6loyCjYJ4h351joZ+h393g3pyfXVtd3BneHBod3Brb2pla2Vgc3JycHF0AIp9cIl8boZ3aIl7bYZ6boV5bYh+coZ+c4J6cYJ7c4B7dYF9e35+fHt4dImLj4+TnYeLkIKFiX2Bhnd7gADAvbjIxsOPg3iFdmiXjoWel5GFem+Ee3GOh4B/e3h8foJ+fXx9fHp6dnKDgoOPl6KPl6OIkJp/hYx6f4YA8fHv////sKujin5y29rX9Pb3koqBkYqC7evprLvJib3sh6XEe3l3eHVxe3d1j5eikpyoiZKcgIaNeX+GAODf2e/w67y5sZSNhcnIxfj5+KGemKCdmP/+/MDS4JXR+4uqzIiHhHx5dX99e5Ocp5KeqomSm3+GjXl+hgBcUEhiVk9fU0siHRwUEhRsZF0gHiA9ODZtZ2M0OUFfcoM0PEeNjIuLiISGhIGXoKyUn6yIkZt9hIx3fYQAQTQqPzEoOSwkKSAcKyEcMCQdIxsXKR8aJRsVJBsWLBwSNC4sn56el5WPkpCNn6i0lqO0iJCbe4GIdHp/AEc4L0c5L0AyKkE0LEAzKzktJ0Q2LTktJTwwKEA1KzQoIWNeW6yrp5qWj5eUjqexvp2vyIuWpXqDinF3ewBGNi1FNy0+MSk7Lyg8MCg4LSU8MSg1KiM4LiY9Myo6LiRfWleopqehm5aYkY2VmJ+Jlad8go9tcXhmZ2oAXEs8Yk9BXUxAXk9CW0tATkE4W0xBSjw0TD81TD40TT40Wk1FaWBecWhmc2tpb2dlamNhZl5cYVdVXFFQAHFeTmxZSmJOQlJANFI/NU49M1E+NU08Mkw7Mks6MEg4L08/NlVGPFZHPVhKQVxPSFxQSVtNSFhMRVZKRcheVnT1bph/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image\"\n        title=\"\"\n        src=\"/static/7d91e83cc1cee4e7c723289ed8f39057/42603/image.png\"\n        srcset=\"/static/7d91e83cc1cee4e7c723289ed8f39057/f931c/image.png 200w,\n/static/7d91e83cc1cee4e7c723289ed8f39057/e8031/image.png 400w,\n/static/7d91e83cc1cee4e7c723289ed8f39057/42603/image.png 800w,\n/static/7d91e83cc1cee4e7c723289ed8f39057/5b8b9/image.png 1200w,\n/static/7d91e83cc1cee4e7c723289ed8f39057/1443f/image.png 1400w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  </p>\n<p>勉強会の名前自体は「新宿もくもく」なんですが、開催場所は代々木です。\n会場提供は<a href=\"https://www.wantedly.com/companies/repro?aql=gaFxpXJlcHJv\">Repro</a>さん。\n2019年6月からは、オフィス拡張に伴い新設したフロアでやっているらしいです。\n僕は6月に転勤になって東京を離れてしまったのでフロア移動後の勉強会には参加していませんが、\n5月に工事中のフロアを見せてもらった時は、こんなに素敵な空間でもくもく会できるなんて！と思いました。</p>\n<h2 id=\"まとめ\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>みなさん是非、<a href=\"https://shinjuku-moku.connpass.com/\">新宿もくもく</a>に参加してみてください🍅</p>","fields":{"slug":"/shinjuku-mokumoku-programming","title":"もくもく会ならShinjuku Mokumoku Programmingがオススメ","date":"2019-06-23T09:00:00.000-07:00","excerpt":"なにこれ一時期いろんな勉強会に行きましたが、「勉強会に参加すると勉強している気になるだけで実際そうじゃない」ので最近はモクモク会にしか顔を出さなくなりました。その中でもShinjuku Mokumoku Programming(通称「新宿も...","tags":["勉強会"],"keywords":["勉強会"],"thumbnail":"thumbnail/2019/06/shinjuku-mokumoku-programming.png"}},{"html":"<h2 id=\"なにこれ\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p>自分専用のRSSリーダーを<a href=\"https://gatsbyjs.org\">Gatsby</a> + <a href=\"https://netlify.com\">Netlify</a> + <a href=\"https://zapier.com/\">Zapier</a>を使って作りました。Gatsbyビルド時にRSSとOGPを取得して、Webサイトに表示しています。\n今回はこのWebサイトのビルドの仕組みと、GatsbyビルドでRSS+OGPを取得する方法をご紹介します。</p>\n<p>サイトはコチラ↓</p>\n<div class=\"iframely-embed\"><div class=\"iframely-responsive\" style=\"height: 140px; padding-bottom: 0;\"><a href=\"https://favorite-blogs.netlify.com//\" data-iframely-url=\"//cdn.iframe.ly/api/iframe?url=https%3A%2F%2Ffavorite-blogs.netlify.com&key=0658bf78be97cafcf2b0b9f96c1270ee\"></a></div></div>\n<br/>\n<p>ソースはコチラ↓</p>\n<div class=\"iframely-embed\"><div class=\"iframely-responsive\" style=\"height: 140px; padding-bottom: 0;\"><a href=\"https://github.com/Takumon/blog-rss\" data-iframely-url=\"//cdn.iframe.ly/B8twzEh\"></a></div></div>\n<br/>\n<h2 id=\"ビルドの仕組み\"><a href=\"#%E3%83%93%E3%83%AB%E3%83%89%E3%81%AE%E4%BB%95%E7%B5%84%E3%81%BF\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ビルドの仕組み</h2>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 105.86881472957421%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAABcRAAAXEQHKJvM/AAADJElEQVQ4y6WVW3PTRhiG/dt70avedmhpO0Og0EIChCQOYAcfZNmSZVmWLB8U2zlgwKFTEgewSdI0+/TTyk5CJ1DaXnyzHu3q1fN+h3WKZoWrQgVlCC3eWhuMcmuMy1k+uEV5Zus9FZ+Lz/ztvdQnBX0TOg57dh7zl5/IL1zjlZmFrZCzeO8T76U+S9iymEQ9jF+zBGmb/fAlDELZMxPCfy3YsfjdjzBuuriLIVFuC3Y6mv6/CbYqTHs7mA+rrP6wzsvaSCy3/5/g22hANvOMhesL7FpD2P5SwlhgVjV1SfCwOyAMIqKwz7C6pwn5xxzOxS6Lxmvb5mgwoF3y2LV9oX0hRWl9JKhb6BJIKhZQbQfVqoqAc0EnceyVGHsW07AOu6GI+ahO7Xx/3glceielmvIgfw9Ky6icrF4hEd90mdaK9J6s0kk/4o35lH1pbuT8eWPLuUPrGUd1Q2CqM8LNBkoLPgTjPqpbg9W7qFvfg/x+H9aoLC3Sz6wwNDLQ80VUaDY9/XtnY4V9Oyf0TaF3RbAfcNxrspVd5TRqwLCHSi+iblwDITqql2gu/azJ4pS896siss5pp55QSp61ZRlToroIivLILfPozi2sOz/qKv7p5Dmr5UGsbKfvk/72G04kn9O6ySRwmDhFjtt1TgProihiX2lBIRx6Ntuj1+xUCsmsBhU9XrHlSdNhkHks+TR4XcqwXdzgg3zwpF3Tl4ee+Tjk0kgIRWDcDXjuuxw05VBfZrU5O9iymUiFh0aRUdlgr5znhSXUmTX262K364pVWwdSfSJPqiyJjCnpSf4GgbSQbAiBzonEgVeVvDn85li88+MPNpJWicVEIKZKwtO2U7pJGwZnckg9XoKb36GePkBJm9CpclDJMxG7Y6vAGyGcOIau8tnMqpqFth334fmkSB9RXIcHUtHl26jsMrh5Dqsmpw2TQ7vESaMiogVNwrwXPzvLkrO4EKrrJAkX668Ka9reQTXH2M5y0qoxKqxIaq4WvSCcr7GF+dr3mRpfy+rxh3+XY+eGvg8nxa90i3yZ4EeXg5B2hVQIiZLQhZCx1HN/xX/KX27fz4YdRTNFAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"build flow\"\n        title=\"\"\n        src=\"/static/d3807cd064fa752ebfead37f471691c0/42603/build-flow.png\"\n        srcset=\"/static/d3807cd064fa752ebfead37f471691c0/f931c/build-flow.png 200w,\n/static/d3807cd064fa752ebfead37f471691c0/e8031/build-flow.png 400w,\n/static/d3807cd064fa752ebfead37f471691c0/42603/build-flow.png 800w,\n/static/d3807cd064fa752ebfead37f471691c0/5b8b9/build-flow.png 1200w,\n/static/d3807cd064fa752ebfead37f471691c0/c7ea5/build-flow.png 1600w,\n/static/d3807cd064fa752ebfead37f471691c0/bc63a/build-flow.png 2400w,\n/static/d3807cd064fa752ebfead37f471691c0/81c80/build-flow.png 2607w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n    </span>\n  </span>\n  </p>\n<p>以下時系列で説明します。</p>\n<ul>\n<li>\n<p>Zapier</p>\n<ul>\n<li>ジョブで定義したRSSを監視</li>\n<li>RSSに更新があったらNetlifyビルドをトリガー</li>\n</ul>\n</li>\n<li>\n<p>Netlify</p>\n<ul>\n<li>ビルドでGitHubからGatsbyプロジェクトのリポジトリをフェッチ</li>\n<li>Gatsbyプロジェクトのビルドを実行</li>\n<li>Gatsbyプロジェクトのビルドの中で、設定ファイルに定義したRSSをフェッチ</li>\n<li>ビルドが終わったらCDNにホスティング</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"netlifyとgithubの連携\"><a href=\"#netlify%E3%81%A8github%E3%81%AE%E9%80%A3%E6%90%BA\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NetlifyとGitHubの連携</h3>\n<p>Netlify上でGitHubリポジトリをビルド＆ホストできるようにしておきます。\n連携はNelityのGUIで簡単にできます。</p>\n<h3 id=\"zapierとnetlifyの連携\"><a href=\"#zapier%E3%81%A8netlify%E3%81%AE%E9%80%A3%E6%90%BA\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ZapierとNetlifyの連携</h3>\n<p>RSSリーダーは「RSSが更新されたらビルドをトリガーする」ような仕組みが必要です。この仕組みはNetlifyとZapierで実現できます。\nZapierはいろんなサービスやアプリを連携させて自動化できるWebサービスで、Netlifyにも対応しています。\nZapierの画面上で、監視したいRSSをポチポチ登録すると「RSSが更新されたらNetlifyのビルドをトリガーする」が簡単に実現できます。</p>\n<h2 id=\"rss--ogp取得\"><a href=\"#rss--ogp%E5%8F%96%E5%BE%97\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RSS + OGP取得</h2>\n<p>さてビルドの仕組みを整えたので、次はGatsbyのビルドでRSSを取得する方法について説明します。</p>\n<p>どのRSSを引っ張ってくるかは、GitHubリポジトリに設定ファイルにて定義します（<a href=\"https://github.com/Takumon/blog-rss/blob/master/favorite-blog-rss.js\">実際の設定ファイル</a>）。\nただコレ、ZapierのジョブのRSS定義と二重管理になるのが難点です。Zapierのタスクがyamlで書けるようになったら一元管理できるかもですが...</p>\n<div class=\"gatsby-code-title\">gatsby-node.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> striptags <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'striptags'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> axios <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'axios'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> cheerio <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cheerio'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> crypto <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"crypto\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> Parser <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'rss-parser'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> parser <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Parser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  headers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'User-Agent'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'something different'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">INTERNAL_TYPE_BLOG</span> <span class=\"token operator\">=</span> <span class=\"token string\">'blog'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">INTERNAL_TYPE_BLOG_POST</span> <span class=\"token operator\">=</span> <span class=\"token string\">'blogPost'</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token comment\">// RSSのような外部リソースを</span>\n<span class=\"token comment\">// GatsbyでGraphQLのデータとして扱うためには</span>\n<span class=\"token comment\">// sorceNodeで処理する</span>\nexports<span class=\"token punctuation\">.</span>sourceNodes <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> actions<span class=\"token punctuation\">,</span> createNodeId<span class=\"token punctuation\">,</span> store<span class=\"token punctuation\">,</span> cache <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> feeds <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  \n  <span class=\"token comment\">// 設定ファイルかなにかしらの方法でRSSのURLを読み込む</span>\n  <span class=\"token keyword\">const</span> blogUrls <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'rss-url-1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'rss-url-2'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> blogUrl <span class=\"token keyword\">of</span> blogUrls<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  \n    <span class=\"token comment\">// rss-parserでRSS情報を取得する</span>\n    <span class=\"token keyword\">const</span> feed <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> parser<span class=\"token punctuation\">.</span><span class=\"token function\">parseURL</span><span class=\"token punctuation\">(</span>blogUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>feed <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>feed<span class=\"token punctuation\">,</span>\n        items<span class=\"token punctuation\">:</span> feed<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>item <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          title<span class=\"token punctuation\">:</span> item<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">,</span>\n          excerpt<span class=\"token punctuation\">:</span> <span class=\"token function\">excerpt</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">,</span> <span class=\"token number\">120</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          content<span class=\"token punctuation\">:</span> item<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">,</span>\n          pubDate<span class=\"token punctuation\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span>pubDate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toISOString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          link <span class=\"token punctuation\">:</span> item<span class=\"token punctuation\">.</span>link<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    feeds<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>feed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n\n  <span class=\"token comment\">// ブログごとにノード生成</span>\n  feeds\n    <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>feed <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      title<span class=\"token punctuation\">:</span> feed<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">,</span>\n      description<span class=\"token punctuation\">:</span> feed<span class=\"token punctuation\">.</span>description<span class=\"token punctuation\">,</span>\n      link<span class=\"token punctuation\">:</span> feed<span class=\"token punctuation\">.</span>link<span class=\"token punctuation\">,</span>\n      lastBuildDate<span class=\"token punctuation\">:</span> feed<span class=\"token punctuation\">.</span>lastBuildDate<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>b <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> contentDigest <span class=\"token operator\">=</span> crypto<span class=\"token punctuation\">.</span><span class=\"token function\">createHash</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`md5`</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">digest</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      \n      actions<span class=\"token punctuation\">.</span><span class=\"token function\">createNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>b<span class=\"token punctuation\">,</span>\n        id<span class=\"token punctuation\">:</span> <span class=\"token function\">createNodeId</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">INTERNAL_TYPE_BLOG</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>b<span class=\"token punctuation\">.</span>link<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        children<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        parent<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`__SOURCE__`</span></span><span class=\"token punctuation\">,</span>\n        internal<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n          type<span class=\"token punctuation\">:</span> <span class=\"token constant\">INTERNAL_TYPE_BLOG</span><span class=\"token punctuation\">,</span>\n          contentDigest<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// RSSに加えて、OGPを取得</span>\n  <span class=\"token keyword\">const</span> rssPosts <span class=\"token operator\">=</span> feeds<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>feed <span class=\"token operator\">=></span> feed<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span>b<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>a<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>b<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> rssPostsWithImageUrl <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// Promise.allでやると503になるのでfor文を使う</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> p <span class=\"token keyword\">of</span> rssPosts<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> pWithImageUrl <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">.</span>link<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      headers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'User-Agent'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'something different'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>res <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n      <span class=\"token comment\">// 取得したHTMLからOGPを取得</span>\n      <span class=\"token keyword\">const</span> $ <span class=\"token operator\">=</span> cheerio<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">let</span> imageUrl<span class=\"token punctuation\">;</span>\n      <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'head meta'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">each</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> el<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> property <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'property'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">const</span> content <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'content'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>property <span class=\"token operator\">===</span> <span class=\"token string\">'og:image'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          imageUrl <span class=\"token operator\">=</span> content\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// 記事情報にOGPのURLを追加</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>p<span class=\"token punctuation\">,</span>\n        imageUrl<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    rssPostsWithImageUrl<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>pWithImageUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n\n  <span class=\"token comment\">// OGP画像のノードを生成</span>\n  <span class=\"token comment\">// 重複を考慮してユニークにしてから処理する</span>\n  <span class=\"token keyword\">const</span> imageUrls <span class=\"token operator\">=</span> <span class=\"token function\">_uniq</span><span class=\"token punctuation\">(</span>rssPostsWithImageUrl<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=></span> p<span class=\"token punctuation\">.</span>imageUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=></span> p<span class=\"token punctuation\">.</span>imageUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">await</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>imageUrls<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> imageUrl <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> fileNode <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">createRemoteFileNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      url<span class=\"token punctuation\">:</span> imageUrl<span class=\"token punctuation\">,</span>\n      cache<span class=\"token punctuation\">,</span>\n      store<span class=\"token punctuation\">,</span>\n      createNode<span class=\"token punctuation\">:</span> actions<span class=\"token punctuation\">.</span>createNode<span class=\"token punctuation\">,</span>\n      createNodeId<span class=\"token punctuation\">:</span> createNodeId<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">await</span> actions<span class=\"token punctuation\">.</span><span class=\"token function\">createNodeField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      node<span class=\"token punctuation\">:</span> fileNode<span class=\"token punctuation\">,</span>\n      name<span class=\"token punctuation\">:</span> <span class=\"token string\">'ThumbnailImage'</span><span class=\"token punctuation\">,</span>\n      value<span class=\"token punctuation\">:</span> <span class=\"token string\">'true'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">await</span> actions<span class=\"token punctuation\">.</span><span class=\"token function\">createNodeField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      node<span class=\"token punctuation\">:</span> fileNode<span class=\"token punctuation\">,</span>\n      name<span class=\"token punctuation\">:</span> <span class=\"token string\">'link'</span><span class=\"token punctuation\">,</span>\n      value<span class=\"token punctuation\">:</span> imageUrl<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> fileNode<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n  <span class=\"token comment\">// ブログ記事ごとのノード生成</span>\n  rssPostsWithImageUrl<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> contentDigest <span class=\"token operator\">=</span> crypto<span class=\"token punctuation\">.</span><span class=\"token function\">createHash</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`md5`</span></span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">digest</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">const</span> excerpt <span class=\"token operator\">=</span> \n    actions<span class=\"token punctuation\">.</span><span class=\"token function\">createNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token operator\">...</span>p<span class=\"token punctuation\">,</span>\n      id<span class=\"token punctuation\">:</span> <span class=\"token function\">createNodeId</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">INTERNAL_TYPE_BLOG_POST</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>p<span class=\"token punctuation\">.</span>link<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      children<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      parent<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`__SOURCE__`</span></span><span class=\"token punctuation\">,</span>\n      internal<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        type<span class=\"token punctuation\">:</span> <span class=\"token constant\">INTERNAL_TYPE_BLOG_POST</span><span class=\"token punctuation\">,</span>\n        contentDigest<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token comment\">// 記事要約は記事本文から抽出</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">excerpt</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">,</span> maxLength<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> rowText <span class=\"token operator\">=</span> <span class=\"token function\">striptags</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">,</span> <span class=\"token string\">'&lt;pre>'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/&lt;pre[\\s\\S]+?>[\\s\\S]+?&lt;\\/pre>/g</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/\\n/g</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/ /g</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> rowText<span class=\"token punctuation\">.</span>length <span class=\"token operator\">>=</span> maxLength\n    <span class=\"token operator\">?</span> rowText<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> maxLength<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'...'</span>\n    <span class=\"token punctuation\">:</span> rowText<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>OGP画像をGatsbyで扱う処理は今も参考にしてみてください。</p>\n<div class=\"iframely-embed\"><div class=\"iframely-responsive\" style=\"padding-bottom: 52.5%; padding-top: 120px;\"><a href=\"https://takumon.com/gatsby-image-of-remote-in-building-by-using-create-remote-file-node\" data-iframely-url=\"//cdn.iframe.ly/r1GTW3Y\"></a></div></div>\n<h3 id=\"リソース取得は間隔を置かないと503になる\"><a href=\"#%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E5%8F%96%E5%BE%97%E3%81%AF%E9%96%93%E9%9A%94%E3%82%92%E7%BD%AE%E3%81%8B%E3%81%AA%E3%81%84%E3%81%A8503%E3%81%AB%E3%81%AA%E3%82%8B\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>リソース取得は間隔を置かないと503になる</h3>\n<p>ビルド時にRSSやらOGPやらを引っ張ってくるために、大量のリクエストを発行しますが、サイトによっては時間当たりのリクエスト上限に引っかかって503エラーになることがあります。\n対処法としては、<code class=\"language-text\">Promise.all</code>で一度にリクエストを投げずに、for文でリクエスト1つずつawaitしながら投げて、適度に間隔を開けるのが良いと思います。</p>\n<h2 id=\"まとめ\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>RSSリーダーのようなものをSPAだけで作ろうとすると、フロント側の高負荷処理で画面描画が遅くなってしまいますが、\nGatsbyを使えばビルド時に重い処理を流せるので、パフォーマンスの向上が期待できます。\nまた今回のように、NetlifyやZapierなど他サービスと連携することで、作れる静的サイトの幅も広がります。\nSPA(Single Page Application)でこのような静的サイトを作っている方は一度Gatsbyを導入してみてはいかがでしょうか🍅</p>","fields":{"slug":"/gatsby-rss-reader-with-netlify-and-zapier","title":"Gatsby + Netlify + ZapierでRSSリーダーを作る","date":"2019-06-18T10:00:00.000-07:00","excerpt":"なにこれ自分専用のRSSリーダーをGatsby + Netlify + Zapierを使って作りました。Gatsbyビルド時にRSSとOGPを取得して、Webサイトに表示しています。今回はこのWebサイトのビルドの仕組みと、Gatsbyビル...","tags":["Gatsby","Netlify","Zapier","RSS","gatsby-plugin-feed"],"keywords":["Gatsby"],"thumbnail":"thumbnail/2019/06/gatsby-rss-reader-with-netlify-zapier.png"}},{"html":"<h2 id=\"なにこれ\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p><a href=\"https://www.netlify.com/docs/form-handling/\">Netlify Forms</a>はNetlifyにホストしている静的サイトでお問い合わせフォームを作れる機能です。DBを用意しなくても、お問い合わせフォーム送信結果はNetlify側で保持しれくれます。Netlifyの管理画面からCSVダウンロードなども可能です。\nさらに<a href=\"https://zapier.com/\">Zapier</a>と連携すると、お問い合わフォームで入力したメールアドレス宛てに定型フォーマットのメールを送信できたりもします。\nそんな便利なNetlify Formsですが、ググっても、お問い合わせフォームを同期的に送信する簡単な方法しか実装サンプルを見つけられませんでした。そこで今回は以下のような実用的サンプルの実装方法をご紹介します。</p>\n<ul>\n<li>お問い合わせフォームにファイルアップロードを含む</li>\n<li>Reactを使う</li>\n<li>入力チェックに<a href=\"https://jaredpalmer.com/formik/\">Formik</a>を使う</li>\n<li><a href=\"https://github.com/axios/axios\">axios</a>で非同期にお問い合わせフォームを送信する</li>\n</ul>\n<h2 id=\"step1-ファイルアップロード--単純なhmlt--同期送信\"><a href=\"#step1-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%A2%E3%83%83%E3%83%97%E3%83%AD%E3%83%BC%E3%83%89--%E5%8D%98%E7%B4%94%E3%81%AAhmlt--%E5%90%8C%E6%9C%9F%E9%80%81%E4%BF%A1\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step.1 ファイルアップロード + 単純なHMLT + 同期送信</h2>\n<p>もっとも単純なパターン、こちら<a href=\"https://www.netlify.com/docs/form-handling/\">Netlifyの公式サイト</a>に書いてある情報を参考に実装します。</p>\n<div class=\"gatsby-code-title\">index.html</div>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&lt;!-- (中略) --></span>\n  <span class=\"token comment\">&lt;!-- name：Formの名前NetlifyのおけるFormの識別子となる --></span>\n  <span class=\"token comment\">&lt;!-- novalidate：Formikで入力チェックするためブラウザの入力チェックはオフ --></span>\n  <span class=\"token comment\">&lt;!-- data-netlify：NetlifyでFormを認識させるための属性 --></span>\n  <span class=\"token comment\">&lt;!-- netlify-honeypot：NetlifyでFormを認識させるための属性 --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span>\n    <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>POST<span class=\"token punctuation\">\"</span></span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>contact<span class=\"token punctuation\">\"</span></span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token attr-name\">novalidate</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token attr-name\">data-netlify</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token attr-name\">netlify-honeypot</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>bot-field<span class=\"token punctuation\">\"</span></span>\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">></span></span>\n</span>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>sampleText<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>sampleFile<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n    \n    <span class=\"token comment\">&lt;!-- 送信ボタン --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">></span></span>\n      SUBMIT\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span>\n<span class=\"token comment\">&lt;!-- (中略) --></span></code></pre></div>\n<br/>\n<h2 id=\"step2-ファイルアップロード--react--同期送信\"><a href=\"#step2-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%A2%E3%83%83%E3%83%97%E3%83%AD%E3%83%BC%E3%83%89--react--%E5%90%8C%E6%9C%9F%E9%80%81%E4%BF%A1\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step.2 ファイルアップロード + React + 同期送信</h2>\n<p>次にReactの場合です。Reactの場合はフォーム情報に<code class=\"language-text\">bot-field</code>と<code class=\"language-text\">form-name</code>を付与する必要があります。\nこれらは<code class=\"language-text\">&lt;input type=&quot;hidden&quot;&gt;</code>で実装します。</p>\n<div class=\"gatsby-code-title\">SampleForm.jsx</div>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>  <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>form\n    name<span class=\"token operator\">=</span><span class=\"token string\">\"contact\"</span> <span class=\"token punctuation\">{</span><span class=\"token comment\">/* Formの名前NetlifyのおけるFormの識別子となる */</span><span class=\"token punctuation\">}</span>\n    method<span class=\"token operator\">=</span><span class=\"token string\">\"POST\"</span>\n    novalidate<span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span> <span class=\"token punctuation\">{</span><span class=\"token comment\">/* Formikで入力チェックするためブラウザの入力チェックはオフ */</span><span class=\"token punctuation\">}</span>\n    data<span class=\"token operator\">-</span>netlify<span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>  <span class=\"token punctuation\">{</span><span class=\"token comment\">/* NetlifyでFormを認識させるための属性 */</span><span class=\"token punctuation\">}</span>\n    netlify<span class=\"token operator\">-</span>honeypot<span class=\"token operator\">=</span><span class=\"token string\">\"bot-field\"</span> <span class=\"token punctuation\">{</span><span class=\"token comment\">/* NetlifyでFormを認識させるための属性 */</span><span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">></span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">{</span><span class=\"token comment\">/* NetlifyFormで必要な値 */</span><span class=\"token punctuation\">}</span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>bot-field<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">{</span><span class=\"token comment\">/* NetlifyFormで必要な値 */</span><span class=\"token punctuation\">}</span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>form-name<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n</span><span class=\"gatsby-highlight-code-line\">\n</span>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>sampleText<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>sampleFile<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n    \n    <span class=\"token punctuation\">{</span><span class=\"token comment\">/* 送信ボタン */</span><span class=\"token punctuation\">}</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      SUBMIT</span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">);</span></code></pre></div>\n<br/>\n<h2 id=\"step3-ファイルアップロード--react--formik--同期送信\"><a href=\"#step3-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%A2%E3%83%83%E3%83%97%E3%83%AD%E3%83%BC%E3%83%89--react--formik--%E5%90%8C%E6%9C%9F%E9%80%81%E4%BF%A1\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step.3 ファイルアップロード + React + Formik + 同期送信</h2>\n<p>Netlify Formsはサーバー側のバリデーション機能はないので、\n実際使うときはフロント側のバリデーションが必要です。\nここでは、Reactのバリデーションライブラリ<a href=\"https://jaredpalmer.com/formik/\">Fromik</a>を使ってバリデーションを追加します。</p>\n<p>入力チェックエラーメッセージ表示はコンポーネント化します。そのほうがすっきりするので。</p>\n<div class=\"gatsby-code-title\">ErrorMessage.jsx</div>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Field<span class=\"token punctuation\">,</span> getIn <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'formik'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Formikエラーメッセージ表示用コンポーネント</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> name <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Field</span>\n    <span class=\"token attr-name\">name</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>name<span class=\"token punctuation\">}</span></span>\n    <span class=\"token attr-name\">render</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> form <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> error <span class=\"token operator\">=</span> <span class=\"token function\">getIn</span><span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">.</span>errors<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> touch <span class=\"token operator\">=</span> <span class=\"token function\">getIn</span><span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">.</span>touched<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      cosnt isShowError <span class=\"token operator\">=</span> touch <span class=\"token operator\">&amp;&amp;</span> error<span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">return</span> isShowError\n        <span class=\"token operator\">?</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>error<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n  <span class=\"token punctuation\">/></span></span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br/>\n<p>入力フォームのコンポーネントはFormikの作法にしたがって以下を実装します。<br/></p>\n<ul>\n<li><code class=\"language-text\">initialValues</code>:入力フォーム初期値設定処理</li>\n<li><code class=\"language-text\">validate</code>: 入力チェック処理</li>\n<li><code class=\"language-text\">render</code>: 入力フォーム描画処理</li>\n</ul>\n<p>ただしファイルについてはFormikが用意している<code class=\"language-text\">Field</code>タグは<code class=\"language-text\">type=file</code>をサポートしていないので、HTMLの<code class=\"language-text\">input</code>タグでファイル変更時に手動でFormikにファイルを追加します。</p>\n<div class=\"gatsby-code-title\">SampleForm.jsx</div>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> navigate <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"gatsby\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Formik<span class=\"token punctuation\">,</span> Field <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'formik'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> ErrorMessage <span class=\"token keyword\">from</span> <span class=\"token string\">'./ErrorMessage'</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token comment\">// フォームの値を初期化</span>\n<span class=\"token keyword\">const</span> initialValues <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">'form-name'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'contact'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// NetlifyFormで必要な値</span>\n  <span class=\"token string\">'bot-field'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// NetlifyFormで必要な値</span>\n  sampleText<span class=\"token punctuation\">]</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n  sampleFile<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token comment\">// 入力チェック</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleValidate</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>values<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> errors <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// sampleText</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>values<span class=\"token punctuation\">.</span>sampleText<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    errors<span class=\"token punctuation\">.</span>sampleText <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`テキストを記入してください`</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// sampleFile</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>values<span class=\"token punctuation\">.</span>sampleFile<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    errors<span class=\"token punctuation\">.</span>sampleFile <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`ファイルを添付してください`</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>values<span class=\"token punctuation\">.</span>sampleFile<span class=\"token punctuation\">.</span>size <span class=\"token operator\">></span> <span class=\"token number\">100000000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    errors<span class=\"token punctuation\">.</span>sampleFile <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`100MB以下のファイルを添付してください`</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> errors<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n\n<span class=\"token comment\">// Form描画処理</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">renderForm</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  dirty<span class=\"token punctuation\">,</span>\n  isSubmitting<span class=\"token punctuation\">,</span>\n  setFieldValue<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>form\n    name<span class=\"token operator\">=</span><span class=\"token string\">\"contact\"</span> <span class=\"token punctuation\">{</span><span class=\"token comment\">/* Formの名前NetlifyのおけるFormの識別子となる */</span><span class=\"token punctuation\">}</span>\n    method<span class=\"token operator\">=</span><span class=\"token string\">\"POST\"</span>\n    novalidate<span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span> <span class=\"token punctuation\">{</span><span class=\"token comment\">/* Formikで入力チェックするためブラウザの入力チェックはオフ */</span><span class=\"token punctuation\">}</span>\n    data<span class=\"token operator\">-</span>netlify<span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>  <span class=\"token punctuation\">{</span><span class=\"token comment\">/* NetlifyでFormを認識させるための属性 */</span><span class=\"token punctuation\">}</span>\n    netlify<span class=\"token operator\">-</span>honeypot<span class=\"token operator\">=</span><span class=\"token string\">\"bot-field\"</span> <span class=\"token punctuation\">{</span><span class=\"token comment\">/* NetlifyでFormを認識させるための属性 */</span><span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Field</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>bot-field<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span> <span class=\"token punctuation\">{</span><span class=\"token comment\">/* NetlifyFormで必要な値 */</span><span class=\"token punctuation\">}</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Field</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>form-name<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span> <span class=\"token punctuation\">{</span><span class=\"token comment\">/* NetlifyFormで必要な値 */</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Field</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>sampleText<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ErrorMessage</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>sampleText<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n    <span class=\"token punctuation\">{</span><span class=\"token comment\">/* FormikのFieldタグではなくHTMLのinputタグを使う */</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span>input\n      id<span class=\"token operator\">=</span><span class=\"token string\">\"sampleFile\"</span>\n      name<span class=\"token operator\">=</span><span class=\"token string\">\"sampleFile\"</span>\n      type<span class=\"token operator\">=</span><span class=\"token string\">\"file\"</span>\n      <span class=\"token punctuation\">{</span><span class=\"token comment\">/* ファイル変更時に、手動でFormikの値に設定 */</span><span class=\"token punctuation\">}</span>\n      onChange<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>event <span class=\"token operator\">=></span> <span class=\"token function\">setFieldValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sampleFile\"</span><span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">.</span>currentTarget<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ErrorMessage</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>sampleFile<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    \n    <span class=\"token punctuation\">{</span><span class=\"token comment\">/* 送信ボタン */</span><span class=\"token punctuation\">}</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">disabled</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>isSubmitting<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span> isSubmitting <span class=\"token operator\">?</span> <span class=\"token string\">'SUBMITTING...'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">'SUBMIT'</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n);\n\n\n// Form用Reactコンポーネント\nexport default () =>  (\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Formik</span>\n    <span class=\"token attr-name\">initialValues</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>initialValues<span class=\"token punctuation\">}</span></span>\n    <span class=\"token attr-name\">validate</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleValidate<span class=\"token punctuation\">}</span></span>\n    <span class=\"token attr-name\">render</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>renderForm<span class=\"token punctuation\">}</span></span>\n  <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n);</span></code></pre></div>\n<br />\n<h2 id=\"step5-ファイルアップロード--react--formik--非同期送信axios\"><a href=\"#step5-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%A2%E3%83%83%E3%83%97%E3%83%AD%E3%83%BC%E3%83%89--react--formik--%E9%9D%9E%E5%90%8C%E6%9C%9F%E9%80%81%E4%BF%A1axios\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step.5 ファイルアップロード + React + Formik + 非同期送信(Axios)</h2>\n<p>Reactを使っている場合、SPAなので同期通信は極力控えたほうが良いです。\nそのため入力フォームの送信も非同期でやるのが現実的でしょう。\nここでは、<code class=\"language-text\">Formik</code>の<code class=\"language-text\">onSubmit</code>でAxiosを使ってお問い合わせフォームを非同期送信する例を示します。<br/>\n<code class=\"language-text\">Formik</code>タグは<code class=\"language-text\">onSubmit</code>プロパティでサブミット処理を自分で定義できます。\nこの<code class=\"language-text\">onSubmit</code>にて、axiosを使うことで非同期処理が可能です。<br/></p>\n<p><small>大半は前セクションと同じなので差分にフォーカスして説明します</small></p>\n<p>エラーメッセージ用コンポーネントは前回と同じなので割愛します。</p>\n<p>以下フォーム用コンポーネントです。</p>\n<div class=\"gatsby-code-title\">SampleForm.jsx</div>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> navigate <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"gatsby\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Formik<span class=\"token punctuation\">,</span> Field <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'formik'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> ErrorMessage <span class=\"token keyword\">from</span> <span class=\"token string\">'./ErrorMessage'</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">import</span> axios <span class=\"token keyword\">from</span> <span class=\"token string\">\"axios\"</span><span class=\"token punctuation\">;</span>\n</span>\n<span class=\"token comment\">// フォームの値を初期化</span>\n<span class=\"token comment\">/* (略) */</span>\n\n<span class=\"token comment\">// 入力チェック</span>\n<span class=\"token comment\">/* (略) */</span>\n\n<span class=\"token comment\">// サブミット処理</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleSubmit</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>values<span class=\"token punctuation\">,</span> actions<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n</span><span class=\"gatsby-highlight-code-line\">\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// FormData作成</span>\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span>  params <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"gatsby-highlight-code-line\">\n</span><span class=\"gatsby-highlight-code-line\">  params<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">'form-name'</span><span class=\"token punctuation\">,</span> values<span class=\"token punctuation\">[</span><span class=\"token string\">'form-name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// for Netlify Forms</span>\n</span><span class=\"gatsby-highlight-code-line\">  params<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bot-field'</span><span class=\"token punctuation\">,</span> values<span class=\"token punctuation\">[</span><span class=\"token string\">'bot-field'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// for Netlify Forms</span>\n</span><span class=\"gatsby-highlight-code-line\">  params<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sampleText'</span><span class=\"token punctuation\">,</span> values<span class=\"token punctuation\">[</span><span class=\"token string\">'sampleText'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"gatsby-highlight-code-line\">  params<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sampleFile'</span><span class=\"token punctuation\">,</span> values<span class=\"token punctuation\">[</span><span class=\"token string\">'sampleFile'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"gatsby-highlight-code-line\">\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// Formikの送信中フラグをオンにする</span>\n</span><span class=\"gatsby-highlight-code-line\">  actions<span class=\"token punctuation\">.</span><span class=\"token function\">setSubmitting</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// axiosで非同期にお問い合わせフォームを送信</span>\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">axios</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n</span><span class=\"gatsby-highlight-code-line\">    method<span class=\"token punctuation\">:</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">,</span>\n</span><span class=\"gatsby-highlight-code-line\">    headers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token string\">\"Content-Type\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"application/x-www-form-urlencoded\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n</span><span class=\"gatsby-highlight-code-line\">    data<span class=\"token punctuation\">:</span> params<span class=\"token punctuation\">,</span>\n</span><span class=\"gatsby-highlight-code-line\">    url<span class=\"token punctuation\">:</span> <span class=\"token string\">\"/\"</span>\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>res <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">// フォーム送信完了後</span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">// 他画面に遷移（同期遷移ではなくSPAとしての遷移）</span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token function\">navigate</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/application-complete'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">// フォーム内容初期化</span>\n</span><span class=\"gatsby-highlight-code-line\">    actions<span class=\"token punctuation\">.</span><span class=\"token function\">resetForm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"gatsby-highlight-code-line\">\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">// 最後にFormikの送信中フラグをオフにする</span>\n</span><span class=\"gatsby-highlight-code-line\">    actions<span class=\"token punctuation\">.</span><span class=\"token function\">setSubmitting</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>err <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">// なにかしらエラーハンドリング</span>\n</span><span class=\"gatsby-highlight-code-line\">    actions<span class=\"token punctuation\">.</span><span class=\"token function\">setSubmitting</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"gatsby-highlight-code-line\">\n</span>    <span class=\"token comment\">/* (中略) */</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n\n<span class=\"token comment\">// Form描画処理</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">renderForm</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  handleSubmit<span class=\"token punctuation\">,</span>\n  dirty<span class=\"token punctuation\">,</span>\n  isSubmitting<span class=\"token punctuation\">,</span>\n  setFieldValue<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>form\n    name<span class=\"token operator\">=</span><span class=\"token string\">\"contact\"</span> <span class=\"token punctuation\">{</span><span class=\"token comment\">/* Formの名前NetlifyのおけるFormの識別子となる */</span><span class=\"token punctuation\">}</span>\n    method<span class=\"token operator\">=</span><span class=\"token string\">\"POST\"</span>\n    novalidate<span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span> <span class=\"token punctuation\">{</span><span class=\"token comment\">/* Formikで入力チェックするためブラウザの入力チェックはオフ */</span><span class=\"token punctuation\">}</span>\n    data<span class=\"token operator\">-</span>netlify<span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>  <span class=\"token punctuation\">{</span><span class=\"token comment\">/* NetlifyでFormを認識させるための属性 */</span><span class=\"token punctuation\">}</span>\n    netlify<span class=\"token operator\">-</span>honeypot<span class=\"token operator\">=</span><span class=\"token string\">\"bot-field\"</span> <span class=\"token punctuation\">{</span><span class=\"token comment\">/* NetlifyでFormを認識させるための属性 */</span><span class=\"token punctuation\">}</span>\n    onSubmit<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>handleSubmit<span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">></span>\n    <span class=\"token punctuation\">{</span><span class=\"token comment\">/* (中略) */</span><span class=\"token punctuation\">}</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token comment\">// Form用Reactコンポーネント</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>  <span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Formik</span>\n    <span class=\"token attr-name\">initialValues</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>initialValues<span class=\"token punctuation\">}</span></span>\n    <span class=\"token attr-name\">validate</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleValidate<span class=\"token punctuation\">}</span></span>\n    <span class=\"token attr-name\">render</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>renderForm<span class=\"token punctuation\">}</span></span>\n    <span class=\"token attr-name\">onSubmit</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleSubmit<span class=\"token punctuation\">}</span></span>\n  <span class=\"token punctuation\">/></span></span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br />\n<p>これでようやくNetlify FormsにおいてReactを使って非同期でファイルアップロードできるようになりました！</p>\n<h2 id=\"まとめ\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>自分の復習も兼ねてステップごとに実装方法をご紹介しました。\nAngularとVueで実装する場合も今回紹介した実装と似たような感じになると思います。\n参考にしてみてください🍅</p>","fields":{"slug":"/async-file-upload-in-netlify-forms-with-react-formik-axios","title":"Netlify Formsでファイルを非同期アップロード with React + Formik + Axios","date":"2019-06-01T22:00:00.000-07:00","excerpt":"なにこれNetlify FormsはNetlifyにホストしている静的サイトでお問い合わせフォームを作れる機能です。DBを用意しなくても、お問い合わせフォーム送信結果はNetlify側で保持しれくれます。Netlifyの管理画面からCSVダ...","tags":["Netlify","NetlifyForms","React","Fromik","Axios"],"keywords":["Netlify"],"thumbnail":"thumbnail/2019/06/async-file-upload-in-netlify-forms-with-react-formik-axios.png"}},{"html":"<h2 id=\"なにこれ\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p>Gatsbyで画像を扱う場合<a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-image\">gatsby-image</a>を使うとイイ感じに最適化してくれます。\nWebサイトのリポジトリ内の画像については<code class=\"language-text\">gatsby-config.js</code>で簡単に設定できますが、<strong>今回はビルド時に動的に取得する外部画像に対して設定する方法をご紹介します。</strong></p>\n<h2 id=\"実装方法\"><a href=\"#%E5%AE%9F%E8%A3%85%E6%96%B9%E6%B3%95\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>実装方法</h2>\n<h3 id=\"step1-外部画像ファイルノード生成\"><a href=\"#step1-%E5%A4%96%E9%83%A8%E7%94%BB%E5%83%8F%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%83%8E%E3%83%BC%E3%83%89%E7%94%9F%E6%88%90\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step1. 外部画像ファイルノード生成</h3>\n<p>Gatsbyの<a href=\"\">gatsby-source-filesystem</a>では、外部画像を扱うためのAPI(<code class=\"language-text\">createRemoteFileNode</code>)が用意されています。\nコチラを<code class=\"language-text\">gatsby-node.js</code>の<code class=\"language-text\">sourceNodes</code>で呼び出せば外部画像にgatsby-imageを適用できます。\nあと、ちょっとしたハックとして、Reactコンポーネント側で他ファイルノードと区別できるように、ノード生成時に識別子を付けましょう。これは後述する外部画像表示用コンポーネントで使うためのものです。</p>\n<div class=\"gatsby-code-title\">gatsby-node.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createRemoteFileNode <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`gatsby-source-filesystem`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// sourceNodesにて外部画像のファイルノードを作成する</span>\nexports<span class=\"token punctuation\">.</span>sourceNodes <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> actions<span class=\"token punctuation\">,</span> createNodeId<span class=\"token punctuation\">,</span> cache<span class=\"token punctuation\">,</span> store <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* (中略) */</span>\n\n  <span class=\"token comment\">// ここでは外部画像のURLの配列を処理するサンプルを示す</span>\n  <span class=\"token keyword\">await</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>sampleImageUrls<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> sampleImageUrl <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// createRemoteFileNodeで外部の画像のファイルノードを作成する</span>\n    <span class=\"token keyword\">const</span> fileNode <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">createRemoteFileNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      url<span class=\"token punctuation\">:</span> sampleImageUrl<span class=\"token punctuation\">,</span>\n      cache<span class=\"token punctuation\">,</span>\n      store<span class=\"token punctuation\">,</span>\n      createNode<span class=\"token punctuation\">:</span> actions<span class=\"token punctuation\">.</span>createNode<span class=\"token punctuation\">,</span>\n      createNodeId<span class=\"token punctuation\">:</span> createNodeId<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 他ファイルノードと区別するための識別子を付与</span>\n    <span class=\"token keyword\">await</span> actions<span class=\"token punctuation\">.</span><span class=\"token function\">createNodeField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      node<span class=\"token punctuation\">:</span> fileNode<span class=\"token punctuation\">,</span>\n      name<span class=\"token punctuation\">:</span> <span class=\"token string\">'SampleImage'</span><span class=\"token punctuation\">,</span>\n      value<span class=\"token punctuation\">:</span> <span class=\"token string\">'true'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// メタ情報として画像のURLを付与</span>\n    <span class=\"token keyword\">await</span> actions<span class=\"token punctuation\">.</span><span class=\"token function\">createNodeField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      node<span class=\"token punctuation\">:</span> fileNode<span class=\"token punctuation\">,</span>\n      name<span class=\"token punctuation\">:</span> <span class=\"token string\">'link'</span><span class=\"token punctuation\">,</span>\n      value<span class=\"token punctuation\">:</span> sampleImageUrl<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> fileNode<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/* (中略) */</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<h3 id=\"step2-外部画像表示用reactコンポーネント作成\"><a href=\"#step2-%E5%A4%96%E9%83%A8%E7%94%BB%E5%83%8F%E8%A1%A8%E7%A4%BA%E7%94%A8react%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E4%BD%9C%E6%88%90\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step2. 外部画像表示用Reactコンポーネント作成</h3>\n<p>外部画像のファイルノードを生成できたら、\n今度はReactコンポーネント側で、それに<code class=\"language-text\">gatsby-iamge</code>を適用して表示します。\nGraphQLのクエリで、ファイルノードを生成時に付与した識別子を使い、すべてのファイルノードから外部画像だけを抽出するようにしましょう。</p>\n<div class=\"gatsby-code-title\">sample-image.jsx</div>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> GatsbyImage <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby-image'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> StaticQuery<span class=\"token punctuation\">,</span> graphql <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// OGP画像のURLを引数に取る</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> url <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n</span>  <span class=\"token operator\">&lt;</span>StaticQuery\n    query<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>graphql<span class=\"token template-string\"><span class=\"token string\">`\n      query {\n        allFile(\n          # Gatsby Buildで付与した識別子をもとに\n          # 全ファイルからOPG画像のみ抽出\n          filter: {fields: {SampleImage: {eq: \"true\"}}}\n        ){\n          edges {\n            node {\n              childImageSharp {\n                resolutions {\n                  ...GatsbyImageSharpResolutions\n                }\n              }\n              id\n              fields {\n                # 一応メタ情報も取得する\n                SampleImage\n                link\n              }\n            }\n          }\n        }\n      }\n    `</span></span><span class=\"token punctuation\">}</span>\n    render<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>data <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token comment\">// OGP画像リストの中から、コンポーネント引数で指定したURLの画像を抽出する</span>\n</span><span class=\"gatsby-highlight-code-line\">      <span class=\"token keyword\">const</span> targetEdge <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>allFile<span class=\"token punctuation\">.</span>edges<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>edge <span class=\"token operator\">=></span> edge<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>fields<span class=\"token punctuation\">.</span>link <span class=\"token operator\">===</span> url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span>\n      <span class=\"token comment\">// 画像が取得できた場合のみgatsby-imageのコンポーネントを返す</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n        targetEdge <span class=\"token operator\">&amp;&amp;</span> targetEdge<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>childImageSharp\n          <span class=\"token operator\">&amp;&amp;</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>GatsbyImage</span> <span class=\"token attr-name\">resolutions</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>targetEdge<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>childImageSharp<span class=\"token punctuation\">.</span>resolutions<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n          <span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br/>\n<h3 id=\"step3-上記で作成したコンポーネントの呼び出し\"><a href=\"#step3-%E4%B8%8A%E8%A8%98%E3%81%A7%E4%BD%9C%E6%88%90%E3%81%97%E3%81%9F%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E3%81%AE%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step3. 上記で作成したコンポーネントの呼び出し</h3>\n<p>最後に上記コンポーネントの呼び出します。以下のように外部画像のURLを指定してあげましょう。</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>SampleImage</span> <span class=\"token attr-name\">url</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>SampleImageUrl<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span></code></pre></div>\n<br/>\n<p>これで外部画像に<code class=\"language-text\">gatsby-image</code>を適用してイイ感じに表示できます！</p>\n<h2 id=\"例：webサイトurlからogp画像を取得する場合\"><a href=\"#%E4%BE%8B%EF%BC%9Aweb%E3%82%B5%E3%82%A4%E3%83%88url%E3%81%8B%E3%82%89ogp%E7%94%BB%E5%83%8F%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>例：WEBサイトURLからOGP画像を取得する場合</h2>\n<p>実用的な例として、複数のWebサイトのOGP画像を<code class=\"language-text\">gatsby-image</code>として扱う方法をご紹介します。</p>\n<div class=\"gatsby-code-title\">gatsby-node.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> axios <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'axios'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> cheerio <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cheerio'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createRemoteFileNode <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`gatsby-source-filesystem`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// sourceNodesにて外部画像のファイルノードを作成する</span>\nexports<span class=\"token punctuation\">.</span>sourceNodes <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> actions<span class=\"token punctuation\">,</span> createNodeId<span class=\"token punctuation\">,</span> cache<span class=\"token punctuation\">,</span> store <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* (中略) */</span>\n\n\n  <span class=\"token comment\">// WEBサイトURLからHTMLを取得してOGPを抽出</span>\n  <span class=\"token keyword\">const</span> ogpImageUrls <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// Promise.allで処理するとリクエスト多可で503になるのでfor文で一件ずつ処理する</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> postUrl <span class=\"token keyword\">of</span> postUrls<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span>postUrl<span class=\"token punctuation\">.</span>link<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      headers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'User-Agent'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'something different'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// cheerioを使ってHMTLからOGP画像URLを抽出</span>\n    <span class=\"token keyword\">let</span> ogpImageUrl<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> $ <span class=\"token operator\">=</span> cheerio<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'head meta'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">each</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> el<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> property <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'property'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">const</span> content <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'content'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>property <span class=\"token operator\">===</span> <span class=\"token string\">'og:image'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        ogpImageUrls<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>ogpImageUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// 取得したOGP画像URLをもとにファイルノードを生成</span>\n  <span class=\"token keyword\">await</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>ogpImageUrls<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> imageUrl <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> fileNode <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">createRemoteFileNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      url<span class=\"token punctuation\">:</span> imageUrl<span class=\"token punctuation\">,</span>\n      cache<span class=\"token punctuation\">,</span>\n      store<span class=\"token punctuation\">,</span>\n      createNode<span class=\"token punctuation\">:</span> actions<span class=\"token punctuation\">.</span>createNode<span class=\"token punctuation\">,</span>\n      createNodeId<span class=\"token punctuation\">:</span> createNodeId<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 他ファイルノードと区別するための識別子を付与</span>\n    <span class=\"token keyword\">await</span> actions<span class=\"token punctuation\">.</span><span class=\"token function\">createNodeField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      node<span class=\"token punctuation\">:</span> fileNode<span class=\"token punctuation\">,</span>\n      name<span class=\"token punctuation\">:</span> <span class=\"token string\">'OgpImage'</span><span class=\"token punctuation\">,</span>\n      value<span class=\"token punctuation\">:</span> <span class=\"token string\">'true'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// メタ情報として画像のURLを付与</span>\n    <span class=\"token keyword\">await</span> actions<span class=\"token punctuation\">.</span><span class=\"token function\">createNodeField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      node<span class=\"token punctuation\">:</span> fileNode<span class=\"token punctuation\">,</span>\n      name<span class=\"token punctuation\">:</span> <span class=\"token string\">'link'</span><span class=\"token punctuation\">,</span>\n      value<span class=\"token punctuation\">:</span> imageUrl<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> fileNode<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br/>\n<p>Reactのコンポーネントの定義、呼び出し側定義は<a href=\"#%E5%AE%9F%E8%A3%85%E6%96%B9%E6%B3%95\">実装方法</a>で紹介した内容とほぼ同じなので割愛します。</p>\n<h2 id=\"まとめ\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>今回の方法を使えば、外部から画像をかき集めてリッチなWebサイトを構築する場合でも、Gatsby側でブラウザ表示を最適化してくれて、画面表示が遅くなる心配もありません。\n是非参考にしてみてください🍅</p>\n<h2 id=\"参考\"><a href=\"#%E5%8F%82%E8%80%83\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"https://www.wildsmithstudio.com/blog/remote-images-with-gatsby/\">Wrangling remote images with Gatsby</a></li>\n<li><a href=\"https://stackoverflow.com/questions/52612936/gatsby-fetching-remote-images-with-createremotefilenode\">graphql - Gatsby - fetching remote images with createRemoteFileNode - Stack Overflow</a></li>\n</ul>","fields":{"slug":"/gatsby-image-of-remote-in-building-by-using-create-remote-file-node","title":"Gatsbyにおける外部取得画像へのgatsby-image適用方法","date":"2019-06-01T21:30:00.000-07:00","excerpt":"なにこれGatsbyで画像を扱う場合gatsby-imageを使うとイイ感じに最適化してくれます。Webサイトのリポジトリ内の画像についてはgatsby-config.jsで簡単に設定できますが、今回はビルド時に動的に取得する外部画像に対し...","tags":["Gatsby","gatsby-image"],"keywords":["Gatsby"],"thumbnail":"thumbnail/2019/06/gatsby-image-of-remote-in-building-by-using-create-remote-file-node.png"}},{"html":"<h2 id=\"なにこれ\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p>GatsbyでWebサイトを作るときに、ブログや職種紹介など2種類以上のマークダウンファイルを管理する場合があると思います。通常だとMarkdownRemarkNodeの<code class=\"language-text\">fileAbsolutePath</code>でしか両者のマークダウンファイルを見分ける術がありませんが、ここではもっとスマートなやり方を紹介します。簡単に言うとFileNodeの<code class=\"language-text\">sourceInstanceName</code>をMarkdownRemarkNodeに引き継ぐことにより、GraphQLのfilterで簡単に区別できるという方法です。</p>\n<h2 id=\"実装方法\"><a href=\"#%E5%AE%9F%E8%A3%85%E6%96%B9%E6%B3%95\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>実装方法</h2>\n<h3 id=\"step1-マークダウンファイルのflenodeでsourceinstancenameを定義\"><a href=\"#step1-%E3%83%9E%E3%83%BC%E3%82%AF%E3%83%80%E3%82%A6%E3%83%B3%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AEflenode%E3%81%A7sourceinstancename%E3%82%92%E5%AE%9A%E7%BE%A9\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step1. マークダウンファイルのFleNodeでsourceInstanceNameを定義</h3>\n<p>マークダウンファイルの読み込み設定はgatsby-config.jsで以下のようにします。\n<code class=\"language-text\">name</code>を付けることでマークダウンファイルのFileNodeにおいて<code class=\"language-text\">sourceInstanceName</code>が設定できます。</p>\n<div class=\"gatsby-code-title\">gatsby-config.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* (中略) */</span>\n\n  plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token comment\">/* (中略) */</span>\n\n    <span class=\"token punctuation\">{</span>\n      resolve<span class=\"token punctuation\">:</span> <span class=\"token string\">'gatsby-source-filesystem'</span><span class=\"token punctuation\">,</span>\n      options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token comment\">// オプションでname(FileNodeにおけるsourceInstanceName)を指定</span>\n</span><span class=\"gatsby-highlight-code-line\">        name<span class=\"token punctuation\">:</span> <span class=\"token string\">'posts'</span><span class=\"token punctuation\">,</span>\n</span>        path<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>__dirname<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/content/posts`</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      resolve<span class=\"token punctuation\">:</span> <span class=\"token string\">'gatsby-source-filesystem'</span><span class=\"token punctuation\">,</span>\n      options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token comment\">// オプションでname(FileNodeにおけるsourceInstanceName)を指定</span>\n</span><span class=\"gatsby-highlight-code-line\">        name<span class=\"token punctuation\">:</span> <span class=\"token string\">'jobs'</span><span class=\"token punctuation\">,</span>\n</span>        path<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>__dirname<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/content/jobs`</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'gatsby-transformer-remark'</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">/* (中略) */</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token comment\">/* (中略) */</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br/>\n<h3 id=\"step2-filenodeのnameをmarkdownfilenodeに引継ぐ\"><a href=\"#step2-filenode%E3%81%AEname%E3%82%92markdownfilenode%E3%81%AB%E5%BC%95%E7%B6%99%E3%81%90\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step2. FileNodeのnameをMarkdownFileNodeに引継ぐ</h3>\n<p>何もしないとFileNodeの<code class=\"language-text\">sourceInstanceName</code>はMarkdownRemarkNodeに引き継がれません。\nそのため<code class=\"language-text\">gatsby-node.js</code>で引継ぎ処理を実装します。</p>\n<div class=\"gatsby-code-title\">gatsby-node.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onCreateNode</span>  <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> node<span class=\"token punctuation\">,</span> boundActionCreators<span class=\"token punctuation\">,</span> getNode <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createNodeField <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> boundActionCreators\n\n  <span class=\"token comment\">// MarkdownRemarkNodeの場合のみ処処</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>node <span class=\"token operator\">&amp;&amp;</span> node<span class=\"token punctuation\">.</span>internal <span class=\"token operator\">&amp;&amp;</span> node<span class=\"token punctuation\">.</span>internal<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'MarkdownRemark'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// 親のFileNodeを取得して</span>\n    <span class=\"token keyword\">const</span> parent <span class=\"token operator\">=</span> <span class=\"token function\">getNode</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>parent<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// gatsby-config.jsで設定したFileNodeのsourceInstanceNameを</span>\n    <span class=\"token comment\">// MarkdownRemarkのフィールドに引き継ぐ</span>\n    <span class=\"token comment\">// 名前はMarkdownRemarkの他プロパティとかぶらないようにcollectionとしている</span>\n    <span class=\"token function\">createNodeField</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      node<span class=\"token punctuation\">,</span>\n      name<span class=\"token punctuation\">:</span> <span class=\"token string\">'collection'</span><span class=\"token punctuation\">,</span>\n      value<span class=\"token punctuation\">:</span> parent<span class=\"token punctuation\">.</span>sourceInstanceName<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br/>\n<h3 id=\"step3-graphqlでnameをもとにマークダウンを区別\"><a href=\"#step3-graphql%E3%81%A7name%E3%82%92%E3%82%82%E3%81%A8%E3%81%AB%E3%83%9E%E3%83%BC%E3%82%AF%E3%83%80%E3%82%A6%E3%83%B3%E3%82%92%E5%8C%BA%E5%88%A5\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step3. GraphQLでnameをもとにマークダウンを区別</h3>\n<p>GraphQLではcollectionフィールドで、それぞれを区別します。</p>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> <span class=\"token punctuation\">{</span>\n  allMarkdownRemark<span class=\"token punctuation\">(</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\"># collectionにて記事のNodeのみ抽出</span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token attr-name\">filter</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">fields</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">collection</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">eq</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"posts\"</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span>\n</span>  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    edges <span class=\"token punctuation\">{</span>\n      node <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\"># (中略)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<h2 id=\"まとめ\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>簡単ですがGatsbyで良く困る事例の1つを紹介しました。\nGatsbyは多くのフックポイントを設けているので、今回のよう、やろうと思えば結構いろんなことができます🍅</p>\n<h2 id=\"参考\"><a href=\"#%E5%8F%82%E8%80%83\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"https://github.com/gatsbyjs/gatsby/issues/1634\">Question: How do I query based on gatsby-source-filesystem name? · Issue #1634 · gatsbyjs/gatsby</a></li>\n</ul>","fields":{"slug":"/how-to-distinct-2-kinds-of-markdown-in-gatsby","title":"Gatsbyで2種類のマークダウンファイルの区別する方法","date":"2019-06-01T21:00:00.000-07:00","excerpt":"なにこれGatsbyでWebサイトを作るときに、ブログや職種紹介など2種類以上のマークダウンファイルを管理する場合があると思います。通常だとMarkdownRemarkNodeのfileAbsolutePathでしか両者のマークダウンファイ...","tags":["Gatsby"],"keywords":["Gatsby"],"thumbnail":"thumbnail/2019/06/how-to-distinct-2-kinds-of-markdown-in-gatsby.png"}}],"previous":{"html":"<h2 id=\"なにこれ\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p><a href=\"https://www.gatsbyjs.org/\">Gatsby</a>（React製の静的サイトジェネレーター）が2018年9月に2系にアップデートしたそうです。\n2系の新機能について、公式ブログ(<a href=\"https://www.gatsbyjs.org/blog/2018-09-17-gatsby-v2/\">Announcing Gatsby 2.0.0</a>)を参考に、主要な部分をピックアップして紹介します。</p>\n<h2 id=\"gatsby採用事例\"><a href=\"#gatsby%E6%8E%A1%E7%94%A8%E4%BA%8B%E4%BE%8B\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gatsby採用事例</h2>\n<p>Gatsbyは、多くのデベロッパーが、ブログ、アプリ、マーケッティングサイト、ECサイト、ドキュメントなどを作る際に採用しています。<br>\n例をあげると、</p>\n<ul>\n<li>Reactの<a href=\"https://reactjs.org/\">公式ドキュメントとブログ</a></li>\n<li>Nikeの<a href=\"https://justdoit.nike.com/\">Just Do It</a></li>\n<li>Airbnbの<a href=\"https://airbnb.io/\">公式サイト</a></li>\n</ul>\n<p>などなど。\n他にもまだまだあるそうで、それらは<a href=\"https://www.gatsbyjs.org/showcase/\">Shwcase | Gatsby</a>で確認できます。</p>\n<h2 id=\"gatsbyの動向\"><a href=\"#gatsby%E3%81%AE%E5%8B%95%E5%90%91\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gatsbyの動向</h2>\n<p>1系をリリースしてから直近1年で、かなり大きなエコシステムに成長しています。</p>\n<ul>\n<li>コントリビューターが198人から1100人に</li>\n<li>90プルリク/週ほどをマージ中（1年前は50ほど）</li>\n<li>400万ダウンロード達成</li>\n<li>457個のプラグインがnpmで公開されている</li>\n<li>55万人がGastbyのWebサイトを訪れている</li>\n<li>GitHubのスター数が10kから22.5kに</li>\n<li>コントリビューターが<a href=\"https://www.gatsbyjs.org/blog/2018-05-24-launching-new-gatsby-company/\">会社を設立</a>。OSSサポートのため370万ドルを調達し、GatsbyでWebサイトを構築・公開するのを支援するクラウドツールを公開</li>\n</ul>\n<h2 id=\"gatsby2系の新機能・改善点\"><a href=\"#gatsby2%E7%B3%BB%E3%81%AE%E6%96%B0%E6%A9%9F%E8%83%BD%E3%83%BB%E6%94%B9%E5%96%84%E7%82%B9\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gatsby2系の新機能・改善点</h2>\n<h3 id=\"1-ビルドの高速化\"><a href=\"#1-%E3%83%93%E3%83%AB%E3%83%89%E3%81%AE%E9%AB%98%E9%80%9F%E5%8C%96\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. ビルドの高速化</h3>\n<p>ビルド時間が75%に短縮されています。</p>\n<ul>\n<li><a href=\"https://github.com/gatsbyjs/gatsby/pull/4912#issuecomment-381407967\">開発環境時のページレンダリングにおけるメモリ使用量削減</a></li>\n<li>webpack 4系アップデートによりJavaScriptとCSSのバンドルの速度向上</li>\n<li>React 16系アップデートによりサーバーサイドレンダリングのパフォーマンスが3〜4倍に向上</li>\n<li>低速アルゴリズムを数多くリファクタリング（<a href=\"https://github.com/gatsbyjs/gatsby/pull/6226\">参考プルリク</a>）</li>\n<li>サーバーサイドレンダリングをマルチプロセス化（<a href=\"https://github.com/gatsbyjs/gatsby/pull/6417\">参考プルリク</a>）</li>\n</ul>\n<h3 id=\"2-クライアント側のjavascriptランタイムを31削減\"><a href=\"#2-%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E5%81%B4%E3%81%AEjavascript%E3%83%A9%E3%83%B3%E3%82%BF%E3%82%A4%E3%83%A0%E3%82%9231%E5%89%8A%E6%B8%9B\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. クライアント側のJavaScriptランタイムを31%削減</h3>\n<p>Gatsby製Webサイトに必ず含まれるJavaScriptのランタイムを31%削減（78.5kbから53.9kb）しています。\nこれはGatsbyが依存しているライブラリの改善が要因としては大きく、その中でも下記2つは大きな削減ポイントです。</p>\n<ul>\n<li>React16へのバージョンアップによるファイルサイズ30%削減（49.8kbから34.8kb）</li>\n<li>ルーター機能 react-routerから@reach/router移行ともなうルータ部分ファイルサイズ70%削減（18.4kbから6kb）</li>\n</ul>\n<h3 id=\"3-react-16\"><a href=\"#3-react-16\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. React 16</h3>\n<p>15から16へアップデートしています。\n16ではReactエコシステムが大きく変更されていて、例えば、<br></p>\n<ul>\n<li>Fragment</li>\n<li>Error Boundary</li>\n<li>Portals機能の追加</li>\n<li>カスタムDOM属性のサポート</li>\n<li>サーバーサイドレンダリングの改善</li>\n<li>フィアルファイルサイズ削減</li>\n</ul>\n<p>などです。詳細はReact公式サイトのブログ <a href=\"https://reactjs.org/blog/2017/09/26/react-v16.0.html\">React v16.0 Released</a>を参照してください。</p>\n<h3 id=\"4-webpack-4\"><a href=\"#4-webpack-4\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. Webpack 4</h3>\n<p>3から4へのアップデートに伴い下記改善がされています。</p>\n<ul>\n<li>ビルド時間の短縮　　※詳細：<a href=\"https://medium.com/webpack/webpack-4-released-today-6cdb994702d4\">webpack 4 release blog post</a></li>\n<li>新しいコード分割アルゴリズム　　※詳細：<a href=\"https://medium.com/webpack/webpack-4-code-splitting-chunk-graph-and-the-splitchunks-optimization-be739a861366\">Code Splitting optimizations</a></li>\n<li>CSS遅延ロードの第一級サポート　　※詳細：<a href=\"https://github.com/webpack-contrib/mini-css-extract-plugin\">mini-css-extract-plugin</a></li>\n</ul>\n<h3 id=\"5-babel-7\"><a href=\"#5-babel-7\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. Babel 7</h3>\n<p>6から7へのアップデートに伴い下記改善がされています。</p>\n<ul>\n<li><a href=\"https://babeljs.io/blog/2018/08/27/7.0.0#speed\">ビルド時間短縮</a></li>\n<li><a href=\"https://babeljs.io/blog/2018/08/27/7.0.0#automatic-polyfilling-experimental\">自動ポリフィルの実験的サポート</a></li>\n<li>対応シンタックスの拡大(TypeScriptとJSXなど)</li>\n</ul>\n<p>詳細はBabel公式サイトのブログ <a href=\"https://babeljs.io/blog/2018/08/27/7.0.0\">Babel 7 Released</a>を参照してください。</p>\n<h3 id=\"6-reachrouter導入によるアクセシビリティ改善\"><a href=\"#6-reachrouter%E5%B0%8E%E5%85%A5%E3%81%AB%E3%82%88%E3%82%8B%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B7%E3%83%93%E3%83%AA%E3%83%86%E3%82%A3%E6%94%B9%E5%96%84\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. @reach/router導入によるアクセシビリティ改善</h3>\n<p>ルーター機能を<a href=\"https://reacttraining.com/react-router/core/guides/philosophy\">react-router</a>から<a href=\"https://reach.tech/router\">@reach/router</a>に切り替えています。\nそれによってスクリーンリーダーに対応しアクセシビリティが向上しています。\nちなみに@reach/routerの作者はreact-routerと同じ<code class=\"language-text\">Ryan Florence</code>なので、自分のGatsby製のWebサイトを2系に移行するときも手間なく簡単です。</p>\n<h3 id=\"7-graphql-stitching\"><a href=\"#7-graphql-stitching\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>7. GraphQL stitching</h3>\n<p>GraphQL stitchingを実験的にサポートしています。\nGraphQL APIとGraphQLステッチングを提供するサービスがますます増えているなかで、\nGatsbyではソースプラグインでラップすることなく直接APIを使用できます。</p>\n<ul>\n<li><a href=\"https://github.com/gatsbyjs/rfcs/blob/master/text/0000-native-graphql-source.md\">RFC</a></li>\n<li><a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby-source-graphql/README.md\">gatsby-source-graphql</a></li>\n</ul>\n<h3 id=\"8-ludicrous-mode（爆速ホットリローディング）\"><a href=\"#8-ludicrous-mode%EF%BC%88%E7%88%86%E9%80%9F%E3%83%9B%E3%83%83%E3%83%88%E3%83%AA%E3%83%AD%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%EF%BC%89\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>8. Ludicrous Mode（爆速ホットリローディング）</h3>\n<p>ホットリローディングが爆速になっています。\nそのためマークダウン編集がほぼリアルタイムでブラウザに反映されるようになっています。</p>\n<blockquote class=\"twitter-tweet\" data-lang=\"ja\"><p lang=\"en\" dir=\"ltr\">Coming soon to Gatsby v2: Ludicrous mode data hot reloading ;-)<a href=\"https://t.co/by1PyOYXc0\">https://t.co/by1PyOYXc0</a><br><br>(note, this gif is not sped up at all) <a href=\"https://t.co/hFIYMbpalN\">pic.twitter.com/hFIYMbpalN</a></p>&mdash; Gatsby (@gatsbyjs) <a href=\"https://twitter.com/gatsbyjs/status/974507205121617920?ref_src=twsrc%5Etfw\">2018年3月16日</a></blockquote>\n<h3 id=\"9-layoutの廃止\"><a href=\"#9-layout%E3%81%AE%E5%BB%83%E6%AD%A2\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>9. Layoutの廃止</h3>\n<p>Gatsby1系のLayout機能は便利な反面、Reactのコンポーネント構成の規則を破るもので混乱を招く要因だったので2系では廃止されています。\nただ廃止はされていますが、プラグイン<a href=\"https://www.gatsbyjs.org/packages/gatsby-plugin-layout/\">gatsby-plugin-layout</a>\nを使うことで2系でもLayout機能を使うことが可能です。</p>\n<ul>\n<li><a href=\"https://github.com/gatsbyjs/rfcs/blob/master/text/0002-remove-special-layout-components.md\">RFC</a></li>\n<li><a href=\"https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#remove-or-refactor-layout-components\">1系から2系への移行方法</a></li>\n<li><a href=\"https://www.gatsbyjs.org/blog/2018-06-08-life-after-layouts/\">Jason Lengstorfの記事</a></li>\n</ul>\n<h3 id=\"10-staticqueryタグ\"><a href=\"#10-staticquery%E3%82%BF%E3%82%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>10. StaticQueryタグ</h3>\n<p>「コンポーネントでデータを取得するにはどうすればいいの？」\nという質問が非常に多かったらしく、任意のコンポーネントでデータをGraphQLで取得できるStaticQueryというタグが追加されています。</p>\n<ul>\n<li><a href=\"https://github.com/gatsbyjs/rfcs/blob/master/text/0002-remove-special-layout-components.md#detailed-design\">RFC</a></li>\n<li><a href=\"https://www.gatsbyjs.org/docs/static-query/\">Gatsbyドキュメント</a></li>\n</ul>\n<h3 id=\"11-gatsby-plugin-offline改善\"><a href=\"#11-gatsby-plugin-offline%E6%94%B9%E5%96%84\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>11. gatsby-plugin-offline改善</h3>\n<p>多くのバグフィックスと機能拡張が施されたようです。</p>\n<h3 id=\"12-トレース機能\"><a href=\"#12-%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B9%E6%A9%9F%E8%83%BD\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>12. トレース機能</h3>\n<p>どのプラグインやパーツのビルドに時間がかかっているかを可視化する機能が追加されており、ビルドのボトルネックをデバッグする際にとても便利です。</p>\n<ul>\n<li><a href=\"https://www.gatsbyjs.org/docs/performance-tracing/\">Gatsbyドキュメント</a></li>\n</ul>\n<h2 id=\"まとめ\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>記事を読んでみて、Gatsby2系はビルド速度が向上して開発環境周りのサポートが充実したなぁという印象です。<br>\n特にLudicrous Mode（爆速ホットリローディング）は、実際に試してみて感動しました。\nほんとにマークダウンの編集がリアルタイムにブラウザに反映されるので、今後ますますGatsbyでのWebサイト構築が簡単になるのではないでしょうか。<br>\nちなみに、<a href=\"https://store.gatsbyjs.org/\">store.gatsbyjs.org</a>でステッカー、Tシャツ、靴下を販売しているそうです。コレ結構ほしい。</p>","fields":{"slug":"/2018/10/12/","title":"Gatsby2系の新機能","date":"2018-10-12T12:00:00.000Z","excerpt":"なにこれGatsby（React製の静的サイトジェネレーター）が2018年9月に2系にアップデートしたそうです。2系の新機能について、公式ブログ(Announcing Gatsby 2.0.0)を参考に、主要な部分をピックアップして紹介しま...","tags":["Gatsby"],"keywords":["Gatsby"],"thumbnail":"thumbnail/2018/gatsby-v2.png"}},"next":{"html":"<h2 id=\"なにこれ\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p>Gatsby公式サイトの<a href=\"https://www.gatsbyjs.org/docs/plugins/\">プラグイン</a>の章のまとめ。</p>\n<h2 id=\"プラグイン概要\"><a href=\"#%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E6%A6%82%E8%A6%81\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>プラグイン概要</h2>\n<p>Gatsbyプラグインは、Gatsbyの全処理を拡張および修正可能です。\n例えば下記のようなことができます。</p>\n<ul>\n<li>外部コンテンツ（CMS、ファイル、REST APIなど）を追加してGraphQLで扱えるようにする</li>\n<li>ファイル（Markdown、YAML、CSVなど）データをJSON形式にフォーマットする</li>\n<li>サードパーティーの機能（Google Analytics, Instagram）をGatsbyで作ったWebサイトに追加する</li>\n</ul>\n<p>またnpmパッケージでモジュール化されているため、巨大で複雑なWebサイトでも簡潔に機能追加･管理が可能です。</p>\n<h3 id=\"公開プラグインを検索する\"><a href=\"#%E5%85%AC%E9%96%8B%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%82%92%E6%A4%9C%E7%B4%A2%E3%81%99%E3%82%8B\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>公開プラグインを検索する</h3>\n<p>プラグイン一覧と個別仕様は <a href=\"https://www.gatsbyjs.org/plugins/\">GatsbyのPlugins</a>で確認できます。\n<a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages\">公式プラグイン</a>とコミュニティ提供のものをあわせると、なんと502個もあるようです。（2018/10/20現在）</p>\n<h2 id=\"プラグインの使い方\"><a href=\"#%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>プラグインの使い方</h2>\n<p>プラグインはnpmパッケージで公開されています。\nまずはnpmインストールしましょう。</p>\n<p><small>下記はgatsby-transformer-jsonの例</small></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install --save gatsby-transformer-json</code></pre></div>\n<br>\n<p>次に<code class=\"language-text\">gatsby-config.js</code>の<code class=\"language-text\">plugins</code>配列に追加してください。</p>\n<div class=\"gatsby-code-title\">gatsby-config.jsの一部</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token template-string\"><span class=\"token string\">`gatsby-transformer-json`</span></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>オプションも指定できます。\n下記のように<code class=\"language-text\">gatsby-config.js</code>を書き換えましょう。</p>\n<div class=\"gatsby-code-title\">gatsby-config.jsの一部</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token comment\">// オプションなしで指定する場合は下記のようにプラグイン名を文字列で指定しましょう。</span>\n    <span class=\"token string\">\"gatsby-plugin-react-helmet\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// オプションありの場合は、オブジェクトで指定します。</span>\n    <span class=\"token punctuation\">{</span>\n      resolve<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`gatsby-source-filesystem`</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// オプションはさらにオブジェクトで指定します。</span>\n      options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        path<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>__dirname<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/src/data/`</span></span><span class=\"token punctuation\">,</span>\n        name<span class=\"token punctuation\">:</span> <span class=\"token string\">\"data\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      resolve<span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token string\">`gatsby-transformer-remark`</span></span><span class=\"token punctuation\">,</span>\n      options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// プラグイン自体を拡張するプラグインを指定できます。</span>\n        <span class=\"token comment\">// その場合はオプションのpluginsにプラグインを定義しましょう。</span>\n        plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token template-string\"><span class=\"token string\">`gatsby-remark-smartypants`</span></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      resolve<span class=\"token punctuation\">:</span> <span class=\"token string\">\"gatsby-plugin-offline\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// 下記のように空オプションの場合は、プラグイン名を文字列で指定した場合と同じです。</span>\n      options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"ローカルのプラグインを使う場合\"><a href=\"#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%81%AE%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%82%92%E4%BD%BF%E3%81%86%E5%A0%B4%E5%90%88\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ローカルのプラグインを使う場合</h3>\n<p>自作プラグインなどは、npm公開せずとも<code class=\"language-text\">plugins</code>フォルダに配置すると使えます。</p>\n<div class=\"gatsby-code-title\">gatsby-config.jsの一部</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token template-string\"><span class=\"token string\">`gatsby-local-plugin`</span></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p>他フォルダに起きたいならフォルダパスを指定しましょう。</p>\n<div class=\"gatsby-code-title\">gatsby-config.jsの一部</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">{</span>\n</span><span class=\"gatsby-highlight-code-line\">      resolve<span class=\"token punctuation\">:</span> require<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`/path/to/gatsby-local-plugin`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n</span>  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"プラグインの作り方\"><a href=\"#%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%AE%E4%BD%9C%E3%82%8A%E6%96%B9\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>プラグインの作り方</h2>\n<ul>\n<li>npmパッケージ、ローカルプラグインどちらの形式もOKです。</li>\n<li><code class=\"language-text\">package.json</code>と<code class=\"language-text\">gatsby-config.js</code>が必要です。</li>\n<li>Gatsby API(<a href=\"https://www.gatsbyjs.org/docs/node-apis/\">Node</a>、<a href=\"https://www.gatsbyjs.org/docs/ssr-apis/\">サーバーサイドレンダリング</a>、<a href=\"https://www.gatsbyjs.org/docs/browser-apis/\">ブラウザ</a>の3種類)を必要に応じて実装しましょう。</li>\n</ul>\n<h3 id=\"作成するファイル\"><a href=\"#%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>作成するファイル</h3>\n<p><small>※[必須]と記載がないものについては任意です。</small></p>\n<ul>\n<li>\n<p><strong>package.json</strong> --- [必須]ローカルプラグインの場合は空オブジェクトでも可。</p>\n<ul>\n<li><strong>name</strong>  GraphQLのデータ構造におけるプラグインの識別子です。未指定の時はプラグインのフォルダ名になります。</li>\n<li><strong>version</strong>  キャッシュ管理用です。これが変わるとキャッシュがクリアされます。未指定の時は、gatsby- *ファイルの内容のMD5ハッシュになります。ローカルプラグインを開発中の場合は、不用意なキャッシュを避けるため指定しないほうが良いでしょう。</li>\n<li><strong>keywords</strong>  検索用に指定してください。ここで<code class=\"language-text\">gatsby</code>と<code class=\"language-text\">gatsby-plugin</code>の2つを指定してnpm公開すると、<a href=\"https://www.gatsbyjs.org/plugins/\">Plugins | Gatsby</a>のリストに追加できます。</li>\n</ul>\n</li>\n<li>\n<p>以下3ファイルはプラグインが拡張･修正したい機能に応じて作成してください。</p>\n<ul>\n<li><strong>gatsby-browser.js</strong> -- <a href=\"https://www.gatsbyjs.org/docs/browser-apis/\">ブラウザAPI</a>の実装を定義します。</li>\n<li><strong>gatsby-node.js</strong> -- <a href=\"https://www.gatsbyjs.org/docs/node-apis/\">ノードAPI</a>の実装を定義します。</li>\n<li><strong>gatsby-ssr.js</strong> -- <a href=\"https://www.gatsbyjs.org/docs/ssr-apis/\">サーバーサイドレンダリングAPI</a>の実装を定義します。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"命名規約\"><a href=\"#%E5%91%BD%E5%90%8D%E8%A6%8F%E7%B4%84\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>命名規約</h3>\n<p>タイプごとに推奨する命名規約があります。</p>\n<ul>\n<li>\n<p><code class=\"language-text\">gatsby-source-*</code> ---  外部コンテンツ（WordPress、MongoDB、ファイル）からデータをロードするタイプの場合</p>\n<ul>\n<li>例： <a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-source-contentful\">gatsby-source-contentful</a></li>\n<li>参考： <a href=\"https://www.gatsbyjs.org/docs/create-source-plugin/\">ソースプラグインを生成する</a></li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">gatsby-transformer-*</code> --- データをJSON形式に変換するタイプの場合</p>\n<ul>\n<li>例：　<a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-transformer-yaml\">gatsby-transformer-yaml</a></li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">gatsby-[plugin-name]-*</code> --- 特定のプラグインを拡張する場合</p>\n<ul>\n<li>例：　<a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-remark-images\">gatsby-remark-images</a>　※<a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-transformer-remark\">gatsby-transformer-remark</a>を拡張するプラグイン</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">gatsby-plugin-*</code> --- 上記以外の場合</p>\n<ul>\n<li>例：　<a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-plugin-sharp\">gatsby-plugin-sharp</a></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"ローカルプラグイン\"><a href=\"#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ローカルプラグイン</h3>\n<p><code class=\"language-text\">plugins</code>配下にプラグイン名のフォルダを作ります。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">plugins\n└── my-own-plugin\n    └── package.json</code></pre></div>\n<p>この状態ではプラグイン用の<code class=\"language-text\">gatsby-config.js</code>を定義していないので、プロジェクトはプラグインを自動認識できません。<br></p>\n<p>プロジェクトの<code class=\"language-text\">gatsby-config.js</code>にプラグイン名（フォルダ名）を指定しましょう。</p>\n<div class=\"gatsby-code-title\">gatsby-config.jsの一部</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'my-own-plugin'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>なおプラグインのソースコードはBabelでトランスコンパイルされないので注意してください。\n新しいJavaScript文法を使いたい場合はプラグインフォルダ配下に<code class=\"language-text\">src</code>フォルダを作って配下にコード格納し、Babelでビルドした資産をプラグインフォルダ配下に出力するなどの工夫が必要です。</p>\n<h3 id=\"どういう場合にプラグインを作るか\"><a href=\"#%E3%81%A9%E3%81%86%E3%81%84%E3%81%86%E5%A0%B4%E5%90%88%E3%81%AB%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%82%92%E4%BD%9C%E3%82%8B%E3%81%8B\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>どういう場合にプラグインを作るか</h3>\n<p>なんでもかんでもプラグイン化するわけではありません。<br>\nJavaScriptやReact.jsの機能（ライブラリ）を追加する場合などはプラグインを作らなくてよいのです。以下に例を示します。</p>\n<ul>\n<li>一般的な機能を提供するJavaScriptパッケージ（<a href=\"https://github.com/lodash/lodash\">lodash</a>や<a href=\"https://github.com/axios/axios\">axios</a>など）を使う場合</li>\n<li>React.jsのUIライブラリ（<a href=\"https://ant.design/\">Ant Design</a>や<a href=\"https://material-ui.com/\">Material UI</a>など）を使う場合</li>\n<li>統合可視化ライブラリ（<a href=\"https://www.highcharts.com/\">Highcharts</a>や<a href=\"https://d3js.org/\">D3.js</a>など）を使う場合</li>\n</ul>\n<p>プラグインはGatsby APIをパッケージ化して最低限の設定で済むようにするのが目的です。\n例えば<code class=\"language-text\">Styled Components</code>を使う場合、自分でGatsby APIを使ってサーバーサイドレンダリング対応を組み込めますが、\nこの対応はプラグイン化すべきです。実際これは<code class=\"language-text\">Gatsby-plugin-styled-components</code>というプラグインがあります。</p>\n<h3 id=\"source-pluginとtransformer-plugin\"><a href=\"#source-plugin%E3%81%A8transformer-plugin\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Source PluginとTransformer Plugin</h3>\n<p>主要なプラグインのタイプの2つにSource PluginとTransformer Pluginがあり両者は連携して機能します。\n例えばマークダウンファイルの場合、\nSource Pluginの<a href=\"https://www.gatsbyjs.org/packages/gatsby-source-filesystem/\">gatsby-source-filesystem</a>がファイルからFileノードを供給し、Transformer Pluginの<a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-transformer-remark\">gatsby-transformer-remark</a>がFileノードをMarkdownRemarkノードに変換します。<br></p>\n<p>なおFileノードはファイルの生の内容と<strong>メディアタイプ</strong>を含みます。\nメディアタイプは必須項目ではありませんが、Source Pluginで生成したノードが生データ(Transformer Plugin未処理のデータ)であることを示す手段です。\nメディアタイプでSource PluginとTransformer Pluginの橋渡しを行い、データ読み込みと加工を分離することで、各プラグインを小さく保つことができるのです。</p>\n<h3 id=\"source-pluginの作り方\"><a href=\"#source-plugin%E3%81%AE%E4%BD%9C%E3%82%8A%E6%96%B9\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Source Pluginの作り方</h3>\n<p>npmパッケージとして作成します。<code class=\"language-text\">package.json</code>と<code class=\"language-text\">gatsby-node.js</code>を作りましょう。\n<code class=\"language-text\">gatsby-node.js</code>は下記のような感じです。</p>\n<div class=\"gatsby-code-title\">gatsby-config.jsの一部</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">exports<span class=\"token punctuation\">.</span>sourceNodes <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> actions <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createNode <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> actions\n  <span class=\"token comment\">// データを生成（ここではデータを外部から取得する例を示す）</span>\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token constant\">REMOTE_API</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// データからノードを生成</span>\n  data<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>datum <span class=\"token operator\">=></span> <span class=\"token function\">createNode</span><span class=\"token punctuation\">(</span><span class=\"token function\">processDatum</span><span class=\"token punctuation\">(</span>datum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// 生成したノードをリターン</span>\n  <span class=\"token keyword\">return</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><em>NOTE:</em> Gatby APIの実装詳細は、<a href=\"https://www.gatsbyjs.org/docs/node-apis/#sourceNodes\">sourceNodes</a>、<a href=\"https://www.gatsbyjs.org/docs/actions/#createNode\">createNode</a>を参照してください。\nここでは例示していませんが、<a href=\"https://github.com/angeloashmore/gatsby-node-helpers\">gatsby-node-helpers</a>を使うとAPIの実装が簡単になるので記述量が大きくなるようなら、使ってみることをお勧めします。</p>\n<h4 id=\"ノード間参照を定義する\"><a href=\"#%E3%83%8E%E3%83%BC%E3%83%89%E9%96%93%E5%8F%82%E7%85%A7%E3%82%92%E5%AE%9A%E7%BE%A9%E3%81%99%E3%82%8B\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ノード間参照を定義する</h4>\n<p>プラグインが出力するノートにおいて、ノード間の参照を定義することでより複雑な構造を定義します。\nこれらの実現方法は2つあります。</p>\n<p><strong>(1) Transformation relationships</strong><br>\n<code class=\"language-text\">gatsby-transformer-remark</code>では、Fileノードが親、MarkdownRemarkノードが子という関係を定義し、\n親ノードのマークダウン文字列、子ノードでHTMLに変換しています。\nこれらの関係は<code class=\"language-text\">createParentChildLink</code>を使って定義します。具体的な実装方法については<a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby-transformer-remark/src/on-node-create.js#L65\">gatsby-transformer-remark</a>を参照してください。<br>\nなお子ノードは親ノードからの派生なので、親ノードが削除時は全ての子ノードが削除されます。</p>\n<p><strong>(2) Foreign-key relationships</strong><br>\n別々のオブジェクト(型定義も全く別々)を紐付ける方法です。\nこの場合Transformation relationshipsと異なり、片方のオブジェクトが削除されても関係するオブジェクトは削除されません。</p>\n<h3 id=\"transformer-plugin\"><a href=\"#transformer-plugin\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Transformer Plugin</h3>\n<p>通常のNPMパッケージとして作成します。<code class=\"language-text\">package.json</code>と<code class=\"language-text\">gatsby-node.js</code>を作りましょう。</p>\n<h4 id=\"変換後ノードの型定義\"><a href=\"#%E5%A4%89%E6%8F%9B%E5%BE%8C%E3%83%8E%E3%83%BC%E3%83%89%E3%81%AE%E5%9E%8B%E5%AE%9A%E7%BE%A9\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>変換後ノードの型定義</h4>\n<p><code class=\"language-text\">gatsby-node.js</code>で変換後ノードの型定義をsetFieldsOnGraphQLNodeTypeに指定します。</p>\n<div class=\"gatsby-code-title\">gatsby-config.jsの一部</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">exports<span class=\"token punctuation\">.</span>setFieldsOnGraphQLNodeType <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`./extend-node-type`</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><em>NOTE:</em> setFieldsOnGraphQLNodeTypeの詳細は<a href=\"https://www.gatsbyjs.org/docs/node-apis/#setFieldsOnGraphQLNodeType\">APIリファレンス</a>参照</p>\n<h4 id=\"キャッシュの取り扱い\"><a href=\"#%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%81%AE%E5%8F%96%E3%82%8A%E6%89%B1%E3%81%84\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>キャッシュの取り扱い</h4>\n<p>変換処理はコストがかかるため、ビルドするたびに作り直さずにすむようにGatsbyのグローバルキャッシュ機能を使います。\nキャッシュキーには少なくとも関連リソースのcontentDigestが必要です。\nたとえば、gatsby-transformer-remarkは、HTMLノードに下記のようにキャッシュキーを指定しています。</p>\n<div class=\"gatsby-code-title\">extend-node-type.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">htmlCacheKey</span> <span class=\"token operator\">=</span> node <span class=\"token operator\">=></span>\n  <span class=\"token template-string\"><span class=\"token string\">`transformer-remark-markdown-html-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>\n    node<span class=\"token punctuation\">.</span>internal<span class=\"token punctuation\">.</span>contentDigest\n  <span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>pluginsCacheStr<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>pathPrefixCacheStr<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span></code></pre></div>\n<br>\n<p>キャッシュへのアクセスは下記のようにします。</p>\n<div class=\"gatsby-code-title\">extend-node-type.js</div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> cachedHTML <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> cache<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token function\">htmlCacheKey</span><span class=\"token punctuation\">(</span>markdownNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\ncache<span class=\"token punctuation\">.</span><span class=\"token keyword\">set</span><span class=\"token punctuation\">(</span><span class=\"token function\">htmlCacheKey</span><span class=\"token punctuation\">(</span>markdownNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> html<span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"プラグインの公開方法\"><a href=\"#%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%AE%E5%85%AC%E9%96%8B%E6%96%B9%E6%B3%95\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>プラグインの公開方法</h2>\n<p>プラグインのpackage.jsonのkeywordに<code class=\"language-text\">gatsby</code>と<code class=\"language-text\">gatsby-plugin</code>をつけてnpm公開すれば、\n最大12時間後にライブラリ一覧のインデックスにいったん追加されます。\nその後<a href=\"https://gatsbyjs.org\">公式サイト</a>のデイリービルドが走ると、ようやくプラグインが一覧に追加され、\n<a href=\"https://www.gatsbyjs.org/plugins/\">GatsbyのPlugins</a>で見れるようになります。</p>\n<p><em>NOTE:</em> せっかく公開するなら検索しやすいように<code class=\"language-text\">gatsby</code>と<code class=\"language-text\">gatsby-plugin</code>以外にもキーワードを指定しましょう。例えばMarkdown MathJax transformerは下記のように指定しています。</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"keywords\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">\"gatsby\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"gatsby-plugin\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"gatsby-transformer-plugin\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"mathjax\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"markdown\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<h2 id=\"まとめ\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>Gatsbyはプラグイン機構が非常に考えぬかれたスマートな形をしていますね。<br>\n機能追加時もnpmインストールして<code class=\"language-text\">gatsby-config.js</code>に設定を追加するだけなのでコードがとてもスッキリするなぁという印象でした。<br>\nプラグイン公開時も、npmパッケージでkeywordに<code class=\"language-text\">gatsby</code>と<code class=\"language-text\">gatsby-plugin</code>をつけるだけというシンプルさも見逃せません。<br>\nなお今回<a href=\"https://www.gatsbyjs.org/docs/source-plugin-tutorial/\">Source Plugin Tutorial</a>のページは見ていませんが、\n自作プラグインを公開する時はこのページを参考にしたいと思います🍅</p>","fields":{"slug":"/2018/10/20/","title":"Gatsbyプラグインの使い方･作り方･公開方法","date":"2018-10-20T21:00:00.000Z","excerpt":"なにこれGatsby公式サイトのプラグインの章のまとめ。プラグイン概要Gatsbyプラグインは、Gatsbyの全処理を拡張および修正可能です。例えば下記のようなことができます。外部コンテンツ（CMS、ファイル、REST APIなど）を追加し...","tags":["Gatsby","GatsbyPlugin"],"keywords":["GatsbyPlugin"],"thumbnail":"thumbnail/2018/gatsby-plugin.png"}}}}