{"data":{"site":{"siteMetadata":{"title":"Takumon Blog","author":"Takuto Inoue"}},"markdownRemark":{"html":"<p><img src=\"/thumbnail/2019/04/how-to-get-user-custom-attributes-in-resolver-with-amplify-appsync-cognito.png\" alt=\"vee-validate-custom-validation-locale-message\"></p>\n<h2 id=\"なにこれ\"><a href=\"#%E3%81%AA%E3%81%AB%E3%81%93%E3%82%8C\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>なにこれ</h2>\n<p>AppSync + Cognitoにおける認可制御について<a href=\"https://takumon.com/aws-appsync-auth-with-cognito\">以前の記事</a>で説明しました。\n今回は、ユーザーのカスタム属性を使った認可制御（AppSyncのリゾルバーでカスタム属性を取得する方法）についてご紹介します。</p>\n<h2 id=\"tldr\"><a href=\"#tldr\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TL;DR</h2>\n<p>AppSyncとCognitoを連携済みであれば、3ステップで実現できます。</p>\n<ol>\n<li><a href=\"#1-cognito%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%81%A7%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E5%B1%9E%E6%80%A7%E3%82%92readable%E3%81%AB%E8%A8%AD%E5%AE%9A\">サーバー側：Cognitoの設定でカスタム属性をReadableに設定</a></li>\n<li><a href=\"#2-appsync%E3%81%AE%E3%83%AA%E3%82%BE%E3%83%AB%E3%83%90%E3%83%BC%E3%81%AB%E3%81%A6ctxidentityclaimsgetcustomsamplecustomattr%E3%82%92%E8%A8%98%E8%BF%B0\">サーバー側：AppSyncのリゾルバーにて<code class=\"language-text\">$ctx.identity.claims.get(&quot;custom:sampleCustomAttr&quot;)</code>を記述</a></li>\n<li><a href=\"#3-amplify%E3%81%AE%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E4%B8%AD%E8%BA%AB%E3%81%AEgetaccesstoken%E3%81%AE%E9%83%A8%E5%88%86%E3%82%92getidtoken%E3%81%AB%E7%BD%AE%E6%8F%9B\">クライアント側：Amplifyのライブラリの中身の<code class=\"language-text\">getAccessToken</code>の部分を<code class=\"language-text\">getIdToken</code>に置換</a></li>\n</ol>\n<p>以下で詳しく説明します。</p>\n<h2 id=\"1-cognitoの設定でカスタム属性をreadableに設定\"><a href=\"#1-cognito%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%81%A7%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E5%B1%9E%E6%80%A7%E3%82%92readable%E3%81%AB%E8%A8%AD%E5%AE%9A\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Cognitoの設定でカスタム属性をReadableに設定</h2>\n<p>この方法は認証時にIDトークンを使うことが前提です。<br/>\nIDトークンを使えば、ユーザー情報がAppSyncのリゾルバー取得できます。<br/>\nただしカスタム属性はデフォルトだと取得できないので、AWSコンソールにて以下のように設定しましょう。</p>\n<ul>\n<li><code class=\"language-text\">AWSコンソール</code> > <code class=\"language-text\">Cognitoのユーザープール</code> > <code class=\"language-text\">全般設定</code> > <code class=\"language-text\">アプリクライアント</code> > <code class=\"language-text\">詳細を表示</code> を選択</li>\n</ul>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2fd3da2252daf17902b1c3691ab5a197/0e42e/how-to-setting-in-cognito-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 41.743400859422955%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABcRAAAXEQHKJvM/AAABsklEQVQoz42Rz2/TMBTH8y9y4LKxaWKjRROF9oIQfwnSTlyQOAxYkcqvSBMTIKhgsoR2KDRrm1/rjyyN49iJk9iP50jjwAHtSR89+2v7a79n68bm7kG792i03e6e7rS7ZLvVJa3OQ7Jzt0e27jwgG7sdsrnXIbf27pON2/fIfu8xeX7YJy9fvyGHRwPyoj8g/cH704Onz8Y3t1pPrB9fhieQMmDrBEQhkQLSLEMpAy5yoJjjhCIJLKNLiCkFnud/YVxAkqZgwplMjq1v9skH5c6ALRYll1LliOf7auZ5KpzPlR+Gauq66nwyUT/PztRvx1Hn02mje0HQjFErGeeA+99ajjO2pZTmljoTAsyCwJtlWQKaNxQ4NpRVBYXRsAqTi6s1KSvzwpnnv7N+jcd2pRSsoqhOM9aUbMyajAcqNPmXuq4xX9FojaHrB8bQsc3sMmVVzLgWUmqRppquVjrnXNdK6bIsdVEU/6MxxBag4Wh0jAdhHoaQxGuoBId86kHizkEvlnCd0FihCT8IbGs0/Nqnw49V/Nles++fKEsSyi4WNLlYUhFFFPtzHWJsk8bPe/UHbaI/rXRpOa4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"how to setting in cognito 1\"\n        title=\"\"\n        src=\"/static/2fd3da2252daf17902b1c3691ab5a197/fb8a0/how-to-setting-in-cognito-1.png\"\n        srcset=\"/static/2fd3da2252daf17902b1c3691ab5a197/1a291/how-to-setting-in-cognito-1.png 148w,\n/static/2fd3da2252daf17902b1c3691ab5a197/2bc4a/how-to-setting-in-cognito-1.png 295w,\n/static/2fd3da2252daf17902b1c3691ab5a197/fb8a0/how-to-setting-in-cognito-1.png 590w,\n/static/2fd3da2252daf17902b1c3691ab5a197/526de/how-to-setting-in-cognito-1.png 885w,\n/static/2fd3da2252daf17902b1c3691ab5a197/fa2eb/how-to-setting-in-cognito-1.png 1180w,\n/static/2fd3da2252daf17902b1c3691ab5a197/0e42e/how-to-setting-in-cognito-1.png 1629w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    \n<br/></p>\n<ul>\n<li><code class=\"language-text\">属性の読み込みおよび書き込みアクセス権限を設定する</code> > <code class=\"language-text\">読み取り可能な属性</code>　にて取得したいカスタム属性にチェックを入れて<code class=\"language-text\">アプリクライアントの変更を保存</code></li>\n</ul>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8ea7852e2cfc9a34840408ac5eabf86f/9b368/how-to-setting-in-cognito-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 119.22604422604424%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAABcRAAAXEQHKJvM/AAAD6klEQVQ4y41V247bVBTN//AERWpVqGYQ6oUiBPwQL32ooIJWoBF9QbzxAVUqI0bpAwWkgaqlnUxnEjt2kplJ4viSxNfY3vZm7ZNkko5UDZaWzsXnrLP23svHtXcuXfvmo5ufP7m89cnjK9u3tctbt7WtG19oV7Y/1d6/dkt79+p17b0PbmiXPryp+lc//kz76s7X2v0fHmr37u9o9x7saN99/+PjO3e/fbJ968uHtT/2nv2ZEbPt+uxNpsBMwfEmajz2fB6OXYWB7ah186Jgqiouykq1GcbytDumUdtrtndlkM7nGV5QURLZzphGtk2e79PYceh0OKTj0xNq6W3q9vvUPzmh3vGxmpdxx7JybzLh6Wz2b62l642ciCezGYVxwmEcQ50nY54FIU+D4Awy508lisnifRiu5imnkseu+6rWNgxFCBIKooiT+ZwLhJDnOecSGt4plCWXG6A3QRLlGWGFgYvw5FQhTNOUA6hLkkRtlgOyLF8cAmz2F+NMEUIUCPUFYZgkFCWpIoxBNJGcILwIqrHhIqwJOx29QbHN3qBFkdcDYaoU2rbNg8GAZ1C9uXmp6A3M5/M14YvXrUZR5CjAlOIkOlOIirHruhyG0RkJNipkGVqEneWFSgewJvx7/0gVxUelpGox1OWyGW2MikseQ8wHqGYIBFGMNSBFVcWHy2dN2LU6DTEn7EBiGVGYFCVHII0lfKhL0E/zjINk+R6EcqA6DDlO042Q/2ki5HJhmwgLEmzK+ifsty2eGV2gx0Gnp8aZ1VdyKggQlAK4AP014fPX7YYMcBJJuJK/0vc5GzuAu2wdzh2Px602wg8WMa68uSDdqLLZUYSRsk2iQsqwKEQrkNADySvWJAhb8ilFEiesqoy+InQ976Uy9iahqCzRInaejUY8Mk22LYsJBYEspU5IxuMxD4dDlceNopwjlJCR5BIL/W6X/V6Pp/0+hyCuQFDB7FIkqb5ATJ8vbpq3EIoHoURyKH2pvhhDUlCAAC5nOVTClkfUiS8vJKxAKMVZ+dGBwQsJGYQBiD3cRlJlx3E4APlGld9OKNeSmFny5SDUOcgWhAmPkBKp8gDtUu3FIduOCyW4naHo1LS4wJwQSg7l+xa7SBtepDASJVMoyhLkUP4NQw4MnefNJnwBX8J7K+XF8uo/T/ibIozjTEhTYNq2SH92QNZLnbp7++Q936dK16kKAnzBTEWeE7xIuBNIyIBsSfiiZpjmX3zu0Q+H/NOvBv/SMPnnXZNbBwP+Pw/+QUbt96dP71q93q7R6TwCed2wrHq/dVQfHTbrw6MD1R63Dusm5q1ut26ew3LuEX5Wu6+azZ3/AJ0c9RMhpwoOAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"how to setting in cognito 2\"\n        title=\"\"\n        src=\"/static/8ea7852e2cfc9a34840408ac5eabf86f/fb8a0/how-to-setting-in-cognito-2.png\"\n        srcset=\"/static/8ea7852e2cfc9a34840408ac5eabf86f/1a291/how-to-setting-in-cognito-2.png 148w,\n/static/8ea7852e2cfc9a34840408ac5eabf86f/2bc4a/how-to-setting-in-cognito-2.png 295w,\n/static/8ea7852e2cfc9a34840408ac5eabf86f/fb8a0/how-to-setting-in-cognito-2.png 590w,\n/static/8ea7852e2cfc9a34840408ac5eabf86f/526de/how-to-setting-in-cognito-2.png 885w,\n/static/8ea7852e2cfc9a34840408ac5eabf86f/fa2eb/how-to-setting-in-cognito-2.png 1180w,\n/static/8ea7852e2cfc9a34840408ac5eabf86f/9b368/how-to-setting-in-cognito-2.png 1628w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    \n<br/></p>\n<h2 id=\"2-appsyncのリゾルバーにてctxidentityclaimsgetcustomsamplecustomattrを記述\"><a href=\"#2-appsync%E3%81%AE%E3%83%AA%E3%82%BE%E3%83%AB%E3%83%90%E3%83%BC%E3%81%AB%E3%81%A6ctxidentityclaimsgetcustomsamplecustomattr%E3%82%92%E8%A8%98%E8%BF%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. AppSyncのリゾルバーにて$ctx.identity.claims.get(\"custom:sampleCustomAttr\")を記述</h2>\n<p>以下のようにして取得します。</p>\n<div class=\"gatsby-highlight\" data-language=\"verocity:appsyncのリゾルバー\"><pre class=\"language-verocity:appsyncのリゾルバー\"><code class=\"language-verocity:appsyncのリゾルバー\">  #set($sampleCustomAttr = $ctx.identity.claims.get(&quot;custom:sampleCustomAttr&quot;))</code></pre></div>\n<br/>\n<h2 id=\"3-amplifyのライブラリの中身のgetaccesstokenの部分をgetidtokenに置換\"><a href=\"#3-amplify%E3%81%AE%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E4%B8%AD%E8%BA%AB%E3%81%AEgetaccesstoken%E3%81%AE%E9%83%A8%E5%88%86%E3%82%92getidtoken%E3%81%AB%E7%BD%AE%E6%8F%9B\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Amplifyのライブラリの中身のgetAccessTokenの部分をgetIdTokenに置換</h2>\n<p>手順2までを実施した場合、、AppSyncのQueryコンソール上では正常動作しますが、\nクライアント側からAmplify経由でクエリをたたいた場合は正常動作しません。</p>\n<p>なぜならAppSyncのQueryコンソールは認証時にIDトークンを使いますが、\nAmplify経由の場合はアクセストークンを使うからです。</p>\n<p>そのため、Amplify側の認証をIDトークンに切り替える必要があります。\n少し無理やりですが以下のようにAmplifyのライブラリを直接書き換えます。<br/>\nプロジェクトのnode_modules配下にて、以下のように修正します。</p>\n<div class=\"gatsby-code-title\">node_modules/@aws-amplify/api/dist/aws-amplify-api.js</div>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token deleted\">- Authorization: session.getAccessToken().getJwtToken() </span>\n<span class=\"token inserted\">+ Authorization: session.getIdToken().getJwtToken() </span></code></pre></div>\n<br/>\nこれでクエリが正常動作するようになります。<br/>\nただ直接依存ライブラリを書き換えるので、本番環境デプロイ時は、CIに忘れずに書き換え処理を追加しましょう。<br/>\n<p>※この方法は、Amplipy側のGraphQLスキーマ定義で<code class=\"language-text\">@auth</code>を使っている場合に一部機能が正常動作しなくなるので注意してください。</p>\n<h2 id=\"まとめ\"><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>まとめ</h2>\n<p>今回はAppSync + Cognitoにおいて、AppSyncのリゾルバーでユーザーのカスタム情報を取得する方法をご紹介しました。\nAmplify側は直接ライブラリを書き換えるので、多少無理やりな対応ですが、一応これでできます。\nユーザーごとの認可情報をカスタム属性に持たせる場合は、この方法を試してみてください🍅</p>\n<h2 id=\"参考\"><a href=\"#%E5%8F%82%E8%80%83\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"https://docs.aws.amazon.com/ja_jp/appsync/latest/devguide/resolver-context-reference.html#aws-appsync-resolver-context-reference-identity\">リゾルバーのマッピングテンプレートのコンテキストリファレンス - AWS AppSync</a></li>\n<li><a href=\"https://maketips.net/tip/175/include-custom-attributes-in-cognito-claims\">Include custom attributes in cognito claims</a></li>\n<li><a href=\"https://github.com/aws-amplify/amplify-js/issues/1772\">Aws Amplify appsync API graphql cognito custom attribute · Issue #1772 · aws-amplify/amplify-js</a></li>\n<li><a href=\"https://github.com/aws-amplify/amplify-cli/issues/456\">Clarify security implications of using ID Token vs. Access Token for AppSync authorization · Issue #456 · aws-amplify/amplify-cli</a></li>\n</ul>","headingsDetail":[{"id":"なにこれ","value":"なにこれ","depth":2,"parents":[]},{"id":"tldr","value":"TL;DR","depth":2,"parents":[]},{"id":"1-cognitoの設定でカスタム属性をreadableに設定","value":"1. Cognitoの設定でカスタム属性をReadableに設定","depth":2,"parents":[]},{"id":"2-appsyncのリゾルバーにてctxidentityclaimsgetcustomsamplecustomattrを記述","value":"2. AppSyncのリゾルバーにて$ctx.identity.claims.get(\"custom:sampleCustomAttr\")を記述","depth":2,"parents":[]},{"id":"3-amplifyのライブラリの中身のgetaccesstokenの部分をgetidtokenに置換","value":"3. Amplifyのライブラリの中身のgetAccessTokenの部分をgetIdTokenに置換","depth":2,"parents":[]},{"id":"まとめ","value":"まとめ","depth":2,"parents":[]},{"id":"参考","value":"参考","depth":2,"parents":[]}],"fields":{"title":"Amplify + Cognito + AppSyncにおいてリゾルバーでユーザのカスタム属性を取得する方法","excerpt":"なにこれAppSync + Cognitoにおける認可制御について以前の記事で説明しました。今回は、ユーザーのカスタム属性を使った認可制御（AppSyncのリゾルバーでカスタム属性を取得する方法）についてご紹介します。TL;DRAppSyn...","date":"2019-04-13T07:14:40.000+09:00","tags":["Amplify","AppSync","AWS","Cognito"],"thumbnail":"/thumbnail/2019/04/how-to-get-user-custom-attributes-in-resolver-with-amplify-appsync-cognito.png"}}},"pageContext":{"slug":"/how-to-get-user-custom-attributes-in-resolver-with-amplify-appsync-cognito","relatedPosts":[{"fields":{"slug":"/aws-appsync-auth-with-cognito","title":"AppSync + Cognitoによる認可制御","date":"2019-03-17T17:45:00.000+09:00","excerpt":"なにこれAppSyncはCognitoと連携して認可制御ができます。今回はそのやり方についてご紹介します。ざっくりいうと以下のようなことが実現可能です。✨スキーマ定義におけるQueryやMutationごとの認可制御（ユーザーグループ）💎...","tags":["AppSync","AWS","Cognito"],"keywords":["AWS"],"thumbnail":"/thumbnail/2019/03/aws-appsync-auth-with-cognito.png"}},{"fields":{"slug":"/aws-appsync-and-serverless-framework","title":"AppSync + Serverless Frameworkによるソースコードの構成管理","date":"2019-03-04T07:50:00.000+09:00","excerpt":"なにこれAWSのGraphQLマネージドサービス「AppSync」はGUIで簡単に設定ができて便利ですが、本格的に開発を進めていくとGUIポチポチでソースコードを管理するのはつらくなってきます。Serverless Frameworkという...","tags":["AppSync","serverless","AWS","GraphQL"],"keywords":["AppSync"],"thumbnail":"/thumbnail/2019/03/aws-appsync-and-serverless-framework.png"}},{"fields":{"slug":"/mutliple-validation-errors-in-aws-appsync","title":"AWS AppSyncで入力チェックエラーを複数返す方法","date":"2019-02-26T07:30:00.000+09:00","excerpt":"なにこれAppSyncのリゾルバーでDynamoDBのデータを更新する場合、更新処理の前に入力チェックは必ず実施すると思います。この時、入力チェックエラーを見つけた時点で1つのエラーメッセージを返すより、すべてのチェック実施後にまとめてエラ...","tags":["AppSync","AWS","GraphQL"],"keywords":["AppSync"],"thumbnail":"/thumbnail/2019/02/mutliple-validation-errors-in-aws-appsync.png"}},{"fields":{"slug":"/aws-appsync-pipeline-resolver-with-multiple-dynamodb-tables","title":"AWS AppSyncのPipeline Resolverで複数データリソースを扱う場合のVTLの書き方","date":"2019-02-19T07:30:00.000+09:00","excerpt":"なにこれAWSのGraphQLフルマネージドサービス「AppSync」で複数のデータリソースを扱う場合は「Pipeline Resolver」という機能を使います。これは、1つのデータリソースを扱うファンクションを定義し、それらを組み合わせ...","tags":["AppSync","AWS","GraphQL","DynamoDB"],"keywords":["GraphQL"],"thumbnail":"/thumbnail/2019/02/aws-appsync-pipeline-resolver-with-multiple-dynamodb-tables.png"}}],"latestPosts":[{"fields":{"slug":"/posts-relation-map-with-cytoscape-in-gatsby","title":"GatsbyでCytoscape.jsを使って記事関連マップを作った","date":"2019-05-01T18:00:00.000+09:00","excerpt":"なにこれ以前の記事で紹介したタグとキーワードから関連記事を算出するロジックと、Cytoscape.jsを用いて記事の関連情報を視覚的に確認できるマップを作りました。今回はそのマップの紹介とCytoscape.jsを使ってみた感想です。記事関...","tags":["Gatsby","Cytoscape.js"],"keywords":["Gatsby"],"thumbnail":"/thumbnail/2019/05/posts-relation-map-with-cytoscape-in-gatsby.png"}},{"fields":{"slug":"/vuetify-datatable-and-pagination-with-vuex","title":"VuetifyのDataTableとPaginationの状態をVuexで管理する","date":"2019-04-28T20:30:00.000+09:00","excerpt":"なにこれVuetifyのDataTableとPaginationを使った検索一覧画面でページングの状態を、ルーティングをまたいで保存しておきたい。という要望を満たすため、ページングの状態をVuexで管理する方法をメモします。DataTabl...","tags":["Vue.js","Vuetify","Vuex"],"keywords":["Vue.js"],"thumbnail":"/thumbnail/2019/04/vuetify-datatable-and-pagination-with-vuex.png"}},{"fields":{"slug":"/multi-message-snackbar-in-vuetify","title":"VuetifyのSnackbarで複数メッセージ表示する方法","date":"2019-04-21T21:30:00.000+09:00","excerpt":"なにこれVuetifyのSnackbarはメッセージを1つしか表示できません。こちらGitHubでもissueになっています。ただUIとしてはメッセージを複数表示できたほうが便利なので、今回はVuetifyのSnackbarをベースにメッセ...","tags":["Vuetify","Vue.js"],"keywords":["Vue.js"],"thumbnail":"/thumbnail/2019/04/multi-message-snackbar-in-vuetify.png"}},{"fields":{"slug":"/how-to-get-user-custom-attributes-in-resolver-with-amplify-appsync-cognito","title":"Amplify + Cognito + AppSyncにおいてリゾルバーでユーザのカスタム属性を取得する方法","date":"2019-04-13T07:14:40.000+09:00","excerpt":"なにこれAppSync + Cognitoにおける認可制御について以前の記事で説明しました。今回は、ユーザーのカスタム属性を使った認可制御（AppSyncのリゾルバーでカスタム属性を取得する方法）についてご紹介します。TL;DRAppSyn...","tags":["Amplify","AppSync","AWS","Cognito"],"keywords":["AWS"],"thumbnail":"/thumbnail/2019/04/how-to-get-user-custom-attributes-in-resolver-with-amplify-appsync-cognito.png"}},{"fields":{"slug":"/vee-validate-custom-validation-locale-message","title":"Vuetify + VeeValidate + VueI18nでカスタムバリデーション作成時にロケールごとのエラーメッセージを設定する方法","date":"2019-04-07T14:10:00.000+09:00","excerpt":"なにこれVuetify + VeeValidateで入力チェックする際に、VueI18nを使ってエラーメッセージを多言語対応・共通化する場合に、カスタムバリデーションのエラーメッセージをロケールごとに設定する方法について紹介します。実装方法...","tags":["Vue.js","Vuetify","VeeValidate","VueI18n"],"keywords":["Vue.js"],"thumbnail":"/thumbnail/2019/04/vee-validate-custom-validation-locale-message.png"}}],"previous":{"fields":{"slug":"/vee-validate-custom-validation-locale-message","title":"Vuetify + VeeValidate + VueI18nでカスタムバリデーション作成時にロケールごとのエラーメッセージを設定する方法","date":"2019-04-07T14:10:00.000+09:00","excerpt":"なにこれVuetify + VeeValidateで入力チェックする際に、VueI18nを使ってエラーメッセージを多言語対応・共通化する場合に、カスタムバリデーションのエラーメッセージをロケールごとに設定する方法について紹介します。実装方法...","tags":["Vue.js","Vuetify","VeeValidate","VueI18n"],"keywords":["Vue.js"],"thumbnail":"/thumbnail/2019/04/vee-validate-custom-validation-locale-message.png"}},"next":{"fields":{"slug":"/multi-message-snackbar-in-vuetify","title":"VuetifyのSnackbarで複数メッセージ表示する方法","date":"2019-04-21T21:30:00.000+09:00","excerpt":"なにこれVuetifyのSnackbarはメッセージを1つしか表示できません。こちらGitHubでもissueになっています。ただUIとしてはメッセージを複数表示できたほうが便利なので、今回はVuetifyのSnackbarをベースにメッセ...","tags":["Vuetify","Vue.js"],"keywords":["Vue.js"],"thumbnail":"/thumbnail/2019/04/multi-message-snackbar-in-vuetify.png"}}}}