---
title: Gatsbyã§PWAå¯¾å¿œ
date: "2018-10-08T12:00:00.000Z"
tags:
  - Gatsby
  - PWA
keywords:
  - Gatsby
slug: /2018/10/08/
thumbnail: thumbnail/2018/gatsby-pwa.png
---

## ãªã«ã“ã‚Œ
ã‚¹ãƒãƒ›ã§ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ—ãƒªã£ã½ã„UXã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã€Gatsbyã§PWAå¯¾å¿œã—ãŸæ™‚ã®ãƒ¡ãƒ¢ã§ã™ã€‚
ä»¥ä¸‹ã®4ã¤ãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚

![ãƒ–ãƒ©ã‚¦ã‚¶ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã®è‰²ã¨ã‚¢ãƒ—ãƒªè¿½åŠ å‚¬ä¿ƒã®ãƒˆãƒ¼ã‚¹ãƒˆ](./pwa-page.png)
<br>

![ãƒ›ãƒ¼ãƒ ç”»é¢ã®ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒ](./pwa-icon.png)
<br>

![ãƒ›ãƒ¼ãƒ ç”»é¢ã‹ã‚‰èµ·å‹•ã—ãŸã¨ãã®ç”»åƒ](./pwa-initialpage.png)


## å‰æ
* ServiceWorkerã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã€SSLåŒ–ãŒå¿…é ˆã§ã™ã€‚ãã®ãŸã‚ãƒ–ãƒ­ã‚°ã¯httpsã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

## å¯¾å¿œæ¦‚è¦
Gatsbyã¯[ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼](https://github.com/gatsbyjs/gatsby-starter-default)ã®æ™‚ç‚¹ã§ã€PWAç”¨ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä¸‹è¨˜2ã¤ãŒå°å…¥æ¸ˆã¿ãªã®ã§ã€è¨­å®šã‚’å°‘ã€…ã„ã˜ã‚‹ã ã‘ã§ç´ æ•µãªPWAå¯¾å¿œãŒã§ãã¾ã™ã€‚
* [gatsby-plugin-manifest](https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-plugin-manifest)
* [gatsby-plugin-offline](https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-plugin-offline)

ä¸Šè¨˜ä¸¡æ–¹ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’`gatsby-config.js`ã«å®šç¾©ã™ã‚‹å ´åˆã€`gatsby-plugin-manifest`ã‚’å¿…ãšå…ˆã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚


## gatsby-plugin-manifestã®è¨­å®š
PWAã§å¿…é ˆã®`manifest.webmanifest`ã‚’ç”Ÿæˆã—ã¦ãã‚Œã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚<br>
ã‚µã‚¤ãƒˆã«`manifest.webmanifest`ã‚’é…ç½®ã™ã‚‹ã“ã¨ã§ã€ã‚¹ãƒãƒ›ã§ãƒ–ãƒ­ã‚°ã‚’è¦‹ãŸã¨ãã«ã€ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ—ãƒªã®ã‚ˆã†ãªUXã‚’å®Ÿç¾ã§ãã¾ã™ã€‚

### manifest.webmanifestã¨ã¯
ä¸‹è¨˜3ã‚µã‚¤ãƒˆã§æ¦‚è¦ã‚’ç†è§£ã—ã¾ã—ãŸã€‚
* [W3C ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆä»•æ§˜æ›¸](https://www.w3.org/TR/appmanifest/)
* [Google ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ](https://developers.google.com/web/fundamentals/engage-and-retain/web-app-manifest/?hl=ja)
* [MDN ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ](https://developer.mozilla.org/ja/docs/Web/Manifest)

ã¨ãã«Googleã®ã‚µã‚¤ãƒˆã§ã¯ã€è¨­å®šã”ã¨ã«ã©ã®ã‚ˆã†ãªUXã«ãªã‚‹ã‹ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§ç¤ºã—ã¦ã„ã‚‹ã®ã§ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã¤ã‹ã¿ã‚„ã™ã„ã§ã™ã€‚

### ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒã¯å…¨ã‚µã‚¤ã‚ºç”¨æ„ã—ãŸ
`manifest.webmanifest`ã§ã¯ã‚µã‚¤ã‚ºåˆ¥ã‚¢ã‚¤ã‚³ãƒ³ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã¯1ã¤å¤§ããªã‚¢ã‚¤ã‚³ãƒ³ã‚’ç”¨æ„ã™ã‚Œã°ã€å…¨ã‚µã‚¤ã‚ºè‡ªå‹•ç”Ÿæˆã—ã¦ãã‚Œã‚‹...ã¨ã‚ã‚Šã¾ã™ãŒã€åƒ•ã¯ãƒ“ãƒ«ãƒ‰æ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã®ã§ã€
ã‚„ã‚€ãªãå…¨ã‚µã‚¤ã‚ºã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚
ãŸã å…¨éƒ¨æ‰‹å‹•ã§ã¨ã„ã†ã‚ã‘ã§ã¯ãªãã€[Web App Manifest Generator](https://app-manifest.firebaseapp.com/)ã¨ã„ã†ä¾¿åˆ©ãªã‚µã‚¤ãƒˆã‚’ä½¿ã„ã¾ã—ãŸã€‚ã‚¢ã‚¤ã‚³ãƒ³ã‚’æ”¾ã‚Šè¾¼ã‚€ã¨å…¨ã‚µã‚¤ã‚ºã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä½œã£ã¦ãã‚Œã¾ã™ã€‚

å‚è€ƒï¼š[3åˆ†ã§PWAã®manifest.jsonã¨å„ã‚µã‚¤ã‚ºã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä½œã‚‹App Manifest Generatorã®ç´¹ä»‹ | Qiita](https://qiita.com/shisama/items/d4d0b24980beaea57231)

ä½œã£ãŸã‚¢ã‚¤ã‚³ãƒ³ã¯ã€`static/icons`é…ä¸‹ã«æ ¼ç´ã—ã¾ã™ã€‚

```
â”œâ”€â”€ static
    â”œâ”€â”€ icons
    â”‚   â”œâ”€â”€ app-sns.png
    â”‚   â”œâ”€â”€ icon-128x128.png
    â”‚   â”œâ”€â”€ icon-144x144.png
    â”‚   â”œâ”€â”€ icon-152x152.png
    â”‚   â”œâ”€â”€ icon-192x192.png
    â”‚   â”œâ”€â”€ icon-384x384.png
    â”‚   â”œâ”€â”€ icon-512x512.png
    â”‚   â”œâ”€â”€ icon-72x72.png
    â”‚   â””â”€â”€ icon-96x96.png
```


### gatsby-config.jsã®è¨­å®š
ä¸‹è¨˜ã®ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

```javascript:title=gatsby-config.js
  plugins: [
    // ãƒ»ãƒ»ãƒ»
    {
      resolve: 'gatsby-plugin-manifest',
      options: {
        name: 'Takumon blog',
        short_name: 'Takumon blog',
        start_url: '/?utm_source=homescreen',
        background_color: '#333', // ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã®èƒŒæ™¯è‰²
        theme_color: '#d23d29', // ãƒ–ãƒ©ã‚¦ã‚¶ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã®è‰²
        display: 'minimal-ui',ã€€// ã‚¢ãƒ—ãƒªã®ã‚¹ã‚¿ã‚¤ãƒ«
        "icons": [ // ã‚¢ã‚¤ã‚³ãƒ³è¨­å®š(ã‚µã‚¤ã‚ºåˆ¥ã‚¢ã‚¤ã‚³ãƒ³è‡ªå‹•ç”Ÿæˆæ©Ÿèƒ½ã‚’ä½¿ã‚ãªã„å ´åˆã¯ã€ã‚µã‚¤ã‚ºæ¯ã«è¨­å®šãŒå¿…è¦)
          {
            "src": "icons/icon-72x72.png",
            "sizes": "72x72",
            "type": "image/png"
          },
          {
            "src": "icons/icon-96x96.png",
            "sizes": "96x96",
            "type": "image/png"
          },
          // ã‚µã‚¤ã‚ºåˆ¥ã®ã‚¢ã‚¤ã‚³ãƒ³è¨­å®š
        ],
      },
    },
    // ãƒ»ãƒ»ãƒ»
  }
```

### è¨­å®šã®ãƒ†ã‚¹ãƒˆ
å®Ÿéš›ã‚¹ãƒãƒ›ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦è©¦ã™ã“ã¨ã‚‚ã§ãã¾ã™ãŒã€
æ­£ã—ããƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãŒãƒ–ãƒ©ã‚¦ã‚¶ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ã¯ã€PCã‹ã‚‰Chromeé–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã®`Application` > `Manifest`ã§ç¢ºèªã§ãã¾ã™ã€‚

![manifest-test](./manifest-test.png)



## gatsby-plugin-offlineã®è¨­å®š
ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ã¤ãªãŒã‚Šã«ãã„ç’°å¢ƒã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç’°å¢ƒã§ã‚‚Gatsbyã®ã‚µã‚¤ãƒˆãŒå‹•ãã‚ˆã†ã«ServiceWorkerã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚
`gatsby-plugin-manifest`ã¨ã‚ã›ã¦ä½¿ã†å ´åˆã¯ã€å¿…ãšã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’å¾Œã«å®šç¾©ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯[Workbox](https://developers.google.com/web/tools/workbox/modules/workbox-build)ã®è¨­å®šã‚’å¾“ã£ã¦ãŠã‚Šã€å¿…è¦ã«å¿œã˜ã¦`gatsby-config.js`ã§ä¸Šæ›¸ãã¨ã„ã†æ„Ÿã˜ã§ã™ã€‚
Workboxã¯å®£è¨€çš„ãªè¨˜è¿°ã ã‘ã§æœ€é©ãªServiceWorkerã®ã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã§ãã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã€ä¸‹è¨˜ã«ã‚ã‹ã‚Šã‚„ã™ãæ›¸ã‹ã‚Œã¦ã„ã¾ã—ãŸã€‚<br>
å‚è€ƒï¼š[ServiceWorkerã‚’ç°¡å˜ã«æ›¸ã‘ã‚‹workbox-swã®ä½¿ã„æ–¹ | Qiita](https://qiita.com/nazonohito51/items/32b61cabdac8b24769bd)


### gatsby-config.jsã®è¨­å®š
ã¨ãã«ä½•ã‚‚ã„ã˜ã£ã¦ã¾ã›ã‚“ã€‚<br>
è¤‡é›‘ãªã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‡¦ç†ã‚’ã™ã‚‹ãªã‚‰ä¿®æ­£ã™ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€åŸºæœ¬çš„ã«Workboxã«å¾“ã£ã¦ãŠã‘ã°å•é¡Œãªã•ãã†ã§ã—ãŸã€‚

```javascript:title=gatsby-config.js
  plugins: [
    // ãƒ»ãƒ»ãƒ»
    `gatsby-plugin-offline`,ã€€// å¿…ãšgatsby-plugin-manifestã®å¾Œã«å®šç¾©ã™ã‚‹
    // ãƒ»ãƒ»ãƒ»
  }
```

## ã¾ã¨ã‚
ã“ã‚Œã¾ãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ç°¡å˜ã«PWAå¯¾å¿œã§ãã¦ã—ã¾ã„ã¾ã—ãŸã€‚ï¼ˆã‚ã¾ã‚Šãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’ã—ã¦ã‚‹æ„Ÿã˜ãŒã‚ã‚Šã¾ã›ã‚“...ï¼‰<br>
æ¬¡ã‚ãŸã‚Šã¯ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã£ã½ã„è¨˜äº‹ã‚’æ›¸ããŸã„ã¨æ€ã„ã¾ã™ğŸ…